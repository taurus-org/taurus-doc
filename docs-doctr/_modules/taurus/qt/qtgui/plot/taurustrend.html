

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>taurus.qt.qtgui.plot.taurustrend &mdash; taurus 4.1.2-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="taurus 4.1.2-alpha documentation" href="../../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../../index.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> taurus
          

          
            
            <img src="../../../../../_static/taurus.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference external" href="http://www.taurus-scada.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/taurus-org/taurus">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/taurus">Download from PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../docs.html">Taurus 4.1 documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../index.html">taurus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
      
    <li>taurus.qt.qtgui.plot.taurustrend</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for taurus.qt.qtgui.plot.taurustrend</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1">#############################################################################</span>
<span class="c1">##</span>
<span class="c1"># This file is part of Taurus</span>
<span class="c1">##</span>
<span class="c1"># http://taurus-scada.org</span>
<span class="c1">##</span>
<span class="c1"># Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c1">##</span>
<span class="c1"># Taurus is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1"># Taurus is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with Taurus.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">##</span>
<span class="c1">#############################################################################</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">taurustrend.py: Generic trend widget for Taurus</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ScanTrendsSet&quot;</span><span class="p">,</span> <span class="s2">&quot;TaurusTrend&quot;</span><span class="p">,</span> <span class="s2">&quot;TaurusTrendsSet&quot;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="k">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">Qwt5</span>

<span class="kn">import</span> <span class="nn">taurus.core</span>
<span class="kn">from</span> <span class="nn">taurus.core.taurusattribute</span> <span class="k">import</span> <span class="n">TaurusAttribute</span>
<span class="kn">from</span> <span class="nn">taurus.core.util.containers</span> <span class="k">import</span> <span class="n">CaselessDict</span><span class="p">,</span> <span class="n">CaselessList</span><span class="p">,</span> <span class="n">ArrayBuffer</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.base</span> <span class="k">import</span> <span class="n">TaurusBaseComponent</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.plot</span> <span class="k">import</span> <span class="n">TaurusPlot</span>


<span class="k">def</span> <span class="nf">getArchivedTrendValues</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">PyTangoArchiving</span>
        <span class="k">return</span> <span class="n">PyTangoArchiving</span><span class="o">.</span><span class="n">getArchivedTrendValues</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>


<span class="k">def</span> <span class="nf">stripShape</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    returns a shape (a list) based on the given one. The returned shape will</span>
<span class="sd">    have all dimensions with length 1 removed, and it will be a list regardless</span>
<span class="sd">    of the input shape</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">s</span> <span class="k">if</span> <span class="n">e</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>


<div class="viewcode-block" id="TaurusTrendsSet"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet">[docs]</a><span class="k">class</span> <span class="nc">TaurusTrendsSet</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="p">,</span> <span class="n">TaurusBaseComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A collection of TaurusCurves generated from a Taurus Attribute.</span>

<span class="sd">    If the attribute is a scalar, The Trend Set consists of only one curve</span>
<span class="sd">    representing the evolution of the value of the attribute. If the attribute</span>
<span class="sd">    is a SPECTRUM, as many curves as the length of the spectrum are created,</span>
<span class="sd">    each representing the evolution of the value of a component of the array.</span>

<span class="sd">    When an event is received, all curves belonging to a TaurusTrendSet are updated.</span>

<span class="sd">    TaurusTrendSet objects can be considered as containers of (sorted) curves. As</span>
<span class="sd">    such, the curves contained by them can be accessed with item notation, as in</span>
<span class="sd">    the following example::</span>

<span class="sd">        attrname = &#39;a/b/c/d&#39;       #consider this attribute is a SPECTRUM of 3 elements</span>
<span class="sd">        ts=TaurusTrendSet(attrname)</span>
<span class="sd">        ...                        # wait for a Taurus Event arriving so that the curves are created</span>
<span class="sd">        ncurves = len(ts)          #ncurves will be 3 (assuming the event already arrived)</span>
<span class="sd">        curve0 = ts[0]             #you can access the curve by index</span>
<span class="sd">        curve1 = ts[&#39;a/b/c/d[1]&#39;]  #and also by name</span>


<span class="sd">    Note that internally each curve is treated as a RawData curve (i.e., it is</span>
<span class="sd">    not aware of events by itself, but it relies on the TaurusTrendSet object to</span>
<span class="sd">    update its values)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">consecutiveDroppedEventsWarning</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># number consecutive of dropped events before issuing a warning (-1 for disabling)</span>
    <span class="c1"># absolute number of dropped events before issuing a warning (-1 for</span>
    <span class="c1"># disabling)</span>
    <span class="n">droppedEventsWarning</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">dataChanged</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="s1">&#39;QString&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">curves</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call__init__</span><span class="p">(</span><span class="n">TaurusBaseComponent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">droppedEventsCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsCount</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiledTitle</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getMaxDataBufferSize</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span> <span class="o">=</span> <span class="n">TaurusTrend</span><span class="o">.</span><span class="n">DEFAULT_MAX_BUFFER_SIZE</span>
        <span class="k">if</span> <span class="n">curves</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span> <span class="o">=</span> <span class="n">curves</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span> <span class="o">=</span> <span class="n">curves</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_titleText</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

<div class="viewcode-block" id="TaurusTrendsSet.index"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curveName</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the index in the trend for the given curve name. It gives an</span>
<span class="sd">        exception if the curve is not in the set.</span>

<span class="sd">        :param curveName: (str) the curvename to find</span>

<span class="sd">        :return: (int) The index associated to the given curve in the TrendSet</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurveNames</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curveName</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.setTitleText"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.setTitleText">[docs]</a>    <span class="k">def</span> <span class="nf">setTitleText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basetitle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the title text of the trends this trendset. The name will be</span>
<span class="sd">        constructed by appending &quot;[%i]&quot; to the basetitle, where %i is the index</span>
<span class="sd">        position of the trend in the trendset. As a particular case, nothing is</span>
<span class="sd">        appended if the trendset consists of only one trend.</span>

<span class="sd">        :param basetitle: (str) The title text to use as a base for constructing</span>
<span class="sd">                          the title of each trend belonging to this trendset. It</span>
<span class="sd">                          may contain placeholders as those used in</span>
<span class="sd">                          :meth:`TaurusCurve.setTitleText`</span>

<span class="sd">        .. seealso:: :meth:`TaurusCurve.setTitleText`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_titleText</span> <span class="o">=</span> <span class="n">basetitle</span>
        <span class="n">titles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compileTitles</span><span class="p">(</span><span class="n">basetitle</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurves</span><span class="p">()):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">setTitleText</span><span class="p">(</span><span class="n">t</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.compileTitles"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.compileTitles">[docs]</a>    <span class="k">def</span> <span class="nf">compileTitles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basetitle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a list of titles. Each title corresponds to a trend of the</span>
<span class="sd">        trendset (ordered). Substitution of known placeholders is performed.</span>

<span class="sd">        :param basetitle: (str) A string to be used as base title. It may</span>
<span class="sd">                          contain any of the following placeholders (which will</span>
<span class="sd">                          be substituted by their corresponding value):</span>

<span class="sd">            - &lt;label&gt; the attribute label (default)</span>
<span class="sd">            - &lt;model&gt; the model name</span>
<span class="sd">            - &lt;attr_name&gt; attribute name</span>
<span class="sd">            - &lt;attr_fullname&gt; full attribute name (for backwards compatibility, &lt;attr_full_name&gt; is also accepted)</span>
<span class="sd">            - &lt;dev_alias&gt; device alias</span>
<span class="sd">            - &lt;dev_name&gt; device name</span>
<span class="sd">            - &lt;dev_fullname&gt; full device name (for backwards compatibility, &lt;dev_full_name&gt; is also accepted)</span>
<span class="sd">            - &lt;current_title&gt; The current title</span>
<span class="sd">            - &lt;trend_index&gt; The index of the trend in the trendset</span>
<span class="sd">            - &lt;[trend_index]&gt; Same as: `&quot;[&lt;trend_index&gt;]&quot; if Ntrends&gt;1 else &quot;&quot;`</span>

<span class="sd">        :return: (string_list) a list of title strings that correspond to the</span>
<span class="sd">                 list of trends in the set.</span>

<span class="sd">        .. seealso:: :meth:`compileBaseTitle`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">basetitle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compileBaseTitle</span><span class="p">(</span><span class="n">basetitle</span><span class="p">)</span>
        <span class="n">ntrends</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;&lt;trend_index&gt;&#39;</span> <span class="ow">in</span> <span class="n">basetitle</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;trend_index&gt;&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">i</span><span class="p">)</span>
                   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">ntrends</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">basetitle</span><span class="p">]</span> <span class="o">*</span> <span class="n">ntrends</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.compileBaseTitle"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.compileBaseTitle">[docs]</a>    <span class="k">def</span> <span class="nf">compileBaseTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basetitle</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Return a base tile for a trend in whichs substitution of known</span>
<span class="sd">        placeholders has been performed.</span>

<span class="sd">        :param basetitle: (str) String on which the substitutions will be</span>
<span class="sd">                          performed. The following placeholders are supported:</span>

<span class="sd">            - &lt;label&gt; the attribute label (default)</span>
<span class="sd">            - &lt;model&gt; the model name</span>
<span class="sd">            - &lt;attr_name&gt; attribute name</span>
<span class="sd">            - &lt;attr_fullname&gt; full attribute name (for backwards compatibility, &lt;attr_full_name&gt; is also accepted)</span>
<span class="sd">            - &lt;dev_alias&gt; device alias</span>
<span class="sd">            - &lt;dev_name&gt; device name</span>
<span class="sd">            - &lt;dev_fullname&gt; full device name (for backwards compatibility, &lt;dev_full_name&gt; is also accepted)</span>
<span class="sd">            - &lt;current_title&gt; The current title</span>
<span class="sd">            - &lt;[trend_index]&gt; Same as: `&quot;[&lt;trend_index&gt;]&quot; if Ntrends&gt;1 else &quot;&quot;`</span>

<span class="sd">        **Note** that &lt;trend_index&gt; itself is not substituted!</span>

<span class="sd">        :return: (str) the compiled base title.</span>

<span class="sd">        .. seealso:: :meth:`compileTitles`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModelObj</span><span class="p">()</span>
        <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;current_title&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_titleText</span><span class="p">)</span>
        <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;model&gt;&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attr</span><span class="p">,</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">taurusattribute</span><span class="o">.</span><span class="n">TaurusAttribute</span><span class="p">):</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;label&gt;&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;&lt;attr_name&gt;&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">getSimpleName</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;&lt;attr_fullname&gt;&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">getFullName</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;&lt;attr_full_name&gt;&#39;</span><span class="p">,</span> <span class="n">attr</span><span class="o">.</span><span class="n">getFullName</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>

        <span class="n">dev</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">getParentObj</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">dev</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;&lt;dev_alias&gt;&#39;</span><span class="p">,</span> <span class="n">dev</span><span class="o">.</span><span class="n">getSimpleName</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;&lt;dev_name&gt;&#39;</span><span class="p">,</span> <span class="n">dev</span><span class="o">.</span><span class="n">getNormalName</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;&lt;dev_fullname&gt;&#39;</span><span class="p">,</span> <span class="n">dev</span><span class="o">.</span><span class="n">getFullName</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                <span class="s1">&#39;&lt;dev_full_name&gt;&#39;</span><span class="p">,</span> <span class="n">dev</span><span class="o">.</span><span class="n">getFullName</span><span class="p">()</span> <span class="ow">or</span> <span class="s1">&#39;---&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;[trend_index]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basetitle</span> <span class="o">=</span> <span class="n">basetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;[trend_index]&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;[&lt;trend_index&gt;]&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">compiledTitle</span> <span class="o">=</span> <span class="n">basetitle</span>
        <span class="k">return</span> <span class="n">basetitle</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.addCurve"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.addCurve">[docs]</a>    <span class="k">def</span> <span class="nf">addCurve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">curve</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;add a curve (with the given name) to the internal curves dictionary of this TaurusTrendSet</span>

<span class="sd">        :param name: (str) the name of the curve</span>
<span class="sd">        :param curve: (TaurusCurve) the curve object to be added</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># provide the curve with a weakref to the trendset (the owner)</span>
        <span class="n">curve</span><span class="o">.</span><span class="n">owner</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.getCurves"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.getCurves">[docs]</a>    <span class="k">def</span> <span class="nf">getCurves</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns an iterator of (curveName,curveObject) tuples associated to</span>
<span class="sd">        this TaurusTrendSet. The curves will always be returned in the order they</span>
<span class="sd">        were added to the set</span>

<span class="sd">        :return: (iterator&lt;str,TaurusCurve&gt;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">([(</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span><span class="p">])</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.getCurveNames"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.getCurveNames">[docs]</a>    <span class="k">def</span> <span class="nf">getCurveNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns a list of the names of the curves associated to this</span>
<span class="sd">        TaurusTrendSet. The curve names will always be returned in the order they</span>
<span class="sd">        were added to the set</span>

<span class="sd">        :return: (list&lt;str&gt;) the names of the curves</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.getModelClass"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.getModelClass">[docs]</a>    <span class="k">def</span> <span class="nf">getModelClass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;see :meth:`TaurusBaseComponent.getModelClass`&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">TaurusAttribute</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.registerDataChanged"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.registerDataChanged">[docs]</a>    <span class="k">def</span> <span class="nf">registerDataChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="p">,</span> <span class="n">meth</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;see :meth:`TaurusBaseComponent.registerDataChanged`&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.unregisterDataChanged"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.unregisterDataChanged">[docs]</a>    <span class="k">def</span> <span class="nf">unregisterDataChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">listener</span><span class="p">,</span> <span class="n">meth</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;see :meth:`TaurusBaseComponent.unregisterDataChanged`&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">meth</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_updateHistory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Update the history data buffers using the latest value from the event</span>

<span class="sd">        :param model: (str) the source of the event (needed to retrieve data from archiving)</span>
<span class="sd">        :param value: (TaurusAttrValue) the value from the event</span>

<span class="sd">        :return: (tuple&lt;numpy.ndarray, numpy.ndarray&gt;) Tuple of two arrays</span>
<span class="sd">                 containing the X data and Y data, respectively, from the</span>
<span class="sd">                 history buffers:</span>
<span class="sd">                 - The dtype of both arrays is &quot;double&quot;.</span>
<span class="sd">                 - The X array will contain timestamps if the parent is in</span>
<span class="sd">                   XisTime mode, and a sequential event number otherwise.</span>
<span class="sd">                 - The Y array may be two-dimensional if the attribute value is</span>
<span class="sd">                   a spectrum</span>

<span class="sd">        **Example of return values:** Consider history of 10 events for a</span>
<span class="sd">        SPECTRUM attribute with dim_x=8. Then the return value will be (X,Y)</span>
<span class="sd">        where X.shape=(10,) and Y.shape=(10,8); X.dtype = Y.dtype = &lt;dtype(&#39;float64&#39;)&gt;</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModelObj</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">isNumeric</span><span class="p">():</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rvalue</span><span class="o">.</span><span class="n">magnitude</span>  <span class="c1"># TODO: check unit consistency</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rvalue</span>
            <span class="k">if</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                <span class="n">ntrends</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="n">ntrends</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Trying with spectrums</span>
                        <span class="n">ntrends</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="c1"># Simply unreadable</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="n">ntrends</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ntrends</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span> <span class="o">=</span> <span class="n">ArrayBuffer</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="nb">min</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">maxSize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span> <span class="o">=</span> <span class="n">ArrayBuffer</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span><span class="p">),</span> <span class="n">ntrends</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">maxSize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attr</span><span class="o">.</span><span class="n">isNumeric</span><span class="p">():</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rvalue</span><span class="o">.</span><span class="n">magnitude</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rvalue</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Problem updating history (</span><span class="si">%s</span><span class="s1">=</span><span class="si">%s</span><span class="s1">):</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                             <span class="n">model</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getXIsTime</span><span class="p">():</span>
            <span class="c1"># add the timestamp to the x buffer</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">totime</span><span class="p">())</span>
            <span class="c1"># Adding archiving values</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getUseArchiving</span><span class="p">():</span>
                <span class="c1"># open a mysql connection for online trends or any not</span>
                <span class="c1"># autoscaled plots</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getXDynScale</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">axisAutoScale</span><span class="p">(</span><span class="n">Qwt5</span><span class="o">.</span><span class="n">QwtPlot</span><span class="o">.</span><span class="n">xBottom</span><span class="p">):</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">getArchivedTrendValues</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">insert</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                        <span class="kn">import</span> <span class="nn">traceback</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">: reading from archiving failed: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">),</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span>
        <span class="k">elif</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># add the event number to the x buffer</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>  <span class="c1"># this will happen when the x buffer is empty</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="o">.</span><span class="n">contents</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span><span class="o">.</span><span class="n">contents</span><span class="p">()</span>

<div class="viewcode-block" id="TaurusTrendsSet.clearTrends"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.clearTrends">[docs]</a>    <span class="k">def</span> <span class="nf">clearTrends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;clears all stored data (buffers and copies of the curves data)</span>

<span class="sd">        :param replot: (bool) do a replot after clearing</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># clean previous curves</span>
        <span class="k">for</span> <span class="n">subname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurveNames</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">detachRawData</span><span class="p">(</span><span class="n">subname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_orderedCurveNames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># clean history Buffers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># clean x,ydata</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xValues</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_yValues</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># replot</span>
        <span class="k">if</span> <span class="n">replot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
        <span class="c1"># Force immediate garbage collection (otherwise the buffered data</span>
        <span class="c1"># remains in memory)</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.handleEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.handleEvent">[docs]</a>    <span class="k">def</span> <span class="nf">handleEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">evt_src</span><span class="p">,</span> <span class="n">evt_type</span><span class="p">,</span> <span class="n">evt_value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; processes Change (and Periodic) Taurus Events: updates the data of all</span>
<span class="sd">        curves in the set according to the value of the attribute.</span>

<span class="sd">        For documentation about the parameters of this method, see</span>
<span class="sd">        :meth:`TaurusBaseComponent.handleEvent`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">evt_type</span> <span class="o">==</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">taurusbasetypes</span><span class="o">.</span><span class="n">TaurusEventType</span><span class="o">.</span><span class="n">Config</span><span class="p">:</span>
            <span class="c1"># self.setTitleText(self._titleText or</span>
            <span class="c1"># self.parent().getDefaultCurvesTitle()) #this did not work well</span>
            <span class="c1"># (it overwrites custom titles!)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">evt_src</span><span class="p">,</span> <span class="n">TaurusAttribute</span><span class="p">):</span>
                <span class="n">model</span> <span class="o">=</span> <span class="n">evt_src</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModelObj</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">evt_type</span> <span class="o">==</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">taurusbasetypes</span><span class="o">.</span><span class="n">TaurusEventType</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_onDroppedEvent</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Error event&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getUseArchiving</span><span class="p">():</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_onDroppedEvent</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;unknown model&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getUseArchiving</span><span class="p">():</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">evt_value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">evt_value</span><span class="p">,</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">taurusbasetypes</span><span class="o">.</span><span class="n">TaurusAttrValue</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModelValueObj</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">value</span><span class="o">.</span><span class="n">rvalue</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_onDroppedEvent</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;invalid value&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getUseArchiving</span><span class="p">():</span>
                        <span class="k">return</span>
                <span class="k">elif</span> <span class="n">model</span><span class="o">.</span><span class="n">isNumeric</span><span class="p">():</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">rvalue</span><span class="p">,</span> <span class="s1">&#39;magnitude&#39;</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_onDroppedEvent</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="s1">&#39;rvalue has no .magnitude&#39;</span><span class="p">)</span>
                        <span class="k">return</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_checkDataDimensions</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">rvalue</span><span class="o">.</span><span class="n">magnitude</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_checkDataDimensions</span><span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">rvalue</span><span class="p">)</span>

        <span class="c1"># get the data from the event</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xValues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_updateHistory</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">(),</span> <span class="n">value</span><span class="o">=</span><span class="n">value</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_onDroppedEvent</span><span class="p">(</span><span class="n">reason</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">raise</span>

        <span class="c1"># this was a good event, so we reset the consecutive dropped events</span>
        <span class="c1"># count</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsCount</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># assign xvalues and yvalues to each of the curves in self._curves</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getCurves</span><span class="p">()):</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_xValues</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">_yValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xValues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yValues</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">c</span><span class="o">.</span><span class="n">_updateMarkers</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()))</span></div>

    <span class="k">def</span> <span class="nf">_checkDataDimensions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check that the data dimensions are consistent with what was plotted before</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="n">ntrends</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">ntrends</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ntrends</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="p">):</span>
            <span class="c1"># clean previous curves</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">(</span><span class="n">replot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># create as many curves as the dim_x of the given model and add</span>
            <span class="c1"># them to the TrendSet</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModelName</span><span class="p">()</span>
            <span class="n">rawdata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="n">ntrends</span><span class="p">):</span>
                <span class="n">subname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">[</span><span class="si">%i</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">attachRawData</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">subname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addCurve</span><span class="p">(</span><span class="n">subname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">curves</span><span class="p">[</span><span class="n">subname</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTitleText</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_titleText</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">getDefaultCurvesTitle</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">autoShowYAxes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ntrends</span>

    <span class="k">def</span> <span class="nf">_onDroppedEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="o">=</span><span class="s1">&#39;Unknown&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;inform the user about a dropped event</span>

<span class="sd">        :param reason: (str) The reason of the drop</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Dropping event. Reason </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">droppedEventsCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">mustwarn</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">droppedEventsCount</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">droppedEventsWarning</span><span class="p">:</span>
            <span class="n">mustwarn</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;At least </span><span class="si">%i</span><span class="s1"> events from model &quot;</span><span class="si">%s</span><span class="s1">&quot; have being dropped. This attribute may have problems</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;Future occurrences will be silently ignored&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">droppedEventsWarning</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">)</span>
            <span class="c1"># disable the consecutive Dropped events warning (we do not want it</span>
            <span class="c1"># if we got this one)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsWarning</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsCount</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsWarning</span><span class="p">:</span>
            <span class="n">mustwarn</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;At least </span><span class="si">%i</span><span class="s1"> consecutive events from model &quot;</span><span class="si">%s</span><span class="s1">&quot; have being dropped. This attribute may have problems</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>
                   <span class="s1">&#39;Future occurrences will be silently ignored&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsWarning</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">)</span>
            <span class="c1"># disable the consecutive Dropped events warning</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consecutiveDroppedEventsWarning</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">mustwarn</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">p</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">canvas</span><span class="p">()</span>
                <span class="n">msg2</span> <span class="o">=</span> <span class="s2">&quot;Errors reading </span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_titleText</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span><span class="p">)</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QToolTip</span><span class="o">.</span><span class="n">showText</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">pos</span><span class="p">()),</span> <span class="n">msg2</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>
                <span class="c1">#Qt.QMessageBox.warning(p, &quot;Errors in %s&quot;%self._titleText, msg, Qt.QMessageBox.Ok)</span>

<div class="viewcode-block" id="TaurusTrendsSet.isReadOnly"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.isReadOnly">[docs]</a>    <span class="k">def</span> <span class="nf">isReadOnly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.setMaxDataBufferSize"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.setMaxDataBufferSize">[docs]</a>    <span class="k">def</span> <span class="nf">setMaxDataBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxSize</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;sets the maximum number of events that are stored in the internal</span>
<span class="sd">        buffers of the trend. Note that this sets the maximum amount of memory</span>
<span class="sd">        used by the data in this trend set to:</span>

<span class="sd">            ~(1+ntrends)*2*8*maxSize bytes</span>

<span class="sd">        (the data is stored as float64, and two copies of it are kept: one at</span>
<span class="sd">        the x and y buffers and another at the QwtPlotCurve.data)</span>

<span class="sd">        :param maxSize: (int) the maximum limit</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="o">.</span><span class="n">setMaxSize</span><span class="p">(</span><span class="n">maxSize</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span><span class="o">.</span><span class="n">setMaxSize</span><span class="p">(</span><span class="n">maxSize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span> <span class="o">=</span> <span class="n">maxSize</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.maxDataBufferSize"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.maxDataBufferSize">[docs]</a>    <span class="k">def</span> <span class="nf">maxDataBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxBufferSize</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.setForcedReadingPeriod"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.setForcedReadingPeriod">[docs]</a>    <span class="k">def</span> <span class="nf">setForcedReadingPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msec</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Forces periodic reading of the subscribed attribute in order to show</span>
<span class="sd">        get new points even if no events are received. It will create fake events as</span>
<span class="sd">        needed with the read value. Note that setting a period may yield</span>
<span class="sd">        unwanted results when the x axis is set to show event numbers</span>
<span class="sd">        (xIsTime==False)since there is no way of distinguishing the real from</span>
<span class="sd">        the fake events.</span>

<span class="sd">        :param msec: (int) period in milliseconds. Use msec&lt;0 to stop the</span>
<span class="sd">                     forced periodic reading</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">forceReading</span><span class="p">)</span>

        <span class="c1"># stop the timer and remove the __ONLY_OWN_EVENTS filter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getEventFilters</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__ONLY_OWN_EVENTS</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
            <span class="n">filters</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ONLY_OWN_EVENTS</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setEventFilters</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>

        <span class="c1"># if msec is positive, set the filter and start</span>
        <span class="k">if</span> <span class="n">msec</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insertEventFilter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__ONLY_OWN_EVENTS</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">msec</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrendsSet.getForcedReadingPeriod"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.getForcedReadingPeriod">[docs]</a>    <span class="k">def</span> <span class="nf">getForcedReadingPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span><span class="o">.</span><span class="n">isActive</span><span class="p">():</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">forcedReadingTimer</span><span class="o">.</span><span class="n">interval</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__ONLY_OWN_EVENTS</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;An event filter that rejects all events except those that originate from this object&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="TaurusTrendsSet.forceReading"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrendsSet.html#taurus.qt.qtgui.plot.TaurusTrendsSet.forceReading">[docs]</a>    <span class="k">def</span> <span class="nf">forceReading</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Forces a read of the attribute and generates a fake event with it.</span>
<span class="sd">        By default it ignores the cache</span>

<span class="sd">        :param cache: (bool) set to True to do cache&#39;d reading (by default is False)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">vobj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModelValueObj</span><span class="p">(</span><span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fireEvent</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">taurusbasetypes</span><span class="o">.</span><span class="n">TaurusEventType</span><span class="o">.</span><span class="n">Periodic</span><span class="p">,</span> <span class="n">vobj</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="ScanTrendsSet"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet">[docs]</a><span class="k">class</span> <span class="nc">ScanTrendsSet</span><span class="p">(</span><span class="n">TaurusTrendsSet</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An specialized TaurusTrendSet that instead of being updated via events, it</span>
<span class="sd">    receives new data directly via a PyQt slot</span>

<span class="sd">    receives signal containing record data from a scan.</span>

<span class="sd">    When an event is received, all curves belonging to a TaurusTrendSet are updated.</span>

<span class="sd">    Note that internally each curve is treated as a RawData curve (i.e., it is</span>
<span class="sd">    not aware of events by itself, but it relies on the ScanTrendSet object to</span>
<span class="sd">    update its values)</span>

<span class="sd">    .. seealso:: :class:`TaurusTrendSet`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_X_DATA_KEY</span> <span class="o">=</span> <span class="s1">&#39;point_nb&#39;</span>

    <span class="n">dataChanged</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="s1">&#39;QString&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">autoClear</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xDataKey</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creator</span>

<span class="sd">        :param autoClear: (bool) If True, (default) :meth:`clearTrends` will be</span>
<span class="sd">                          called every time a &quot;data_desc&quot; packet is received</span>
<span class="sd">        :param xDataKey:  (str) a the name of the data to be used for the x value</span>
<span class="sd">                          in the scan curves (e.g., a motor name, a counter</span>
<span class="sd">                          name,...) By default, &quot;point_nb&quot; is used. The special key</span>
<span class="sd">                          &quot;__SCAN_TREND_INDEX__&quot; will associate an internal integer index</span>
<span class="sd">                          that starts in 0, increases on each record_data received</span>
<span class="sd">                          and is reset by :meth:`clearTrends`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">TaurusTrendsSet</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">curves</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xDataKey</span> <span class="o">=</span> <span class="n">xDataKey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span> <span class="o">=</span> <span class="n">xDataKey</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoClear</span> <span class="o">=</span> <span class="n">autoClear</span>
        <span class="c1">#self._usePointNumber = usePointNumber</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotablesFilter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__datadesc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endMarkers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endMacroMarkerEnabled</span> <span class="o">=</span> <span class="kc">True</span>

<div class="viewcode-block" id="ScanTrendsSet.setAutoClear"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.setAutoClear">[docs]</a>    <span class="k">def</span> <span class="nf">setAutoClear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoClear</span> <span class="o">=</span> <span class="n">enable</span></div>

<div class="viewcode-block" id="ScanTrendsSet.setXDataKey"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.setXDataKey">[docs]</a>    <span class="k">def</span> <span class="nf">setXDataKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xDataKey</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xDataKey</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">()</span></div>

<div class="viewcode-block" id="ScanTrendsSet.setEndMacroMarkerEnabled"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.setEndMacroMarkerEnabled">[docs]</a>    <span class="k">def</span> <span class="nf">setEndMacroMarkerEnabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets whether a marker should be put at the end of each macro or not</span>

<span class="sd">        :param enabled: (bool)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endMacroMarkerEnabled</span> <span class="o">=</span> <span class="n">enable</span></div>

<div class="viewcode-block" id="ScanTrendsSet.scanDataReceived"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.scanDataReceived">[docs]</a>    <span class="k">def</span> <span class="nf">scanDataReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">packet</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        packet is a dict with {type:str, &quot;data&quot;:object} and the accepted types are: data_desc, record_data, record_end</span>
<span class="sd">        and the data objects are: seq&lt;ColumnDesc.Todict()&gt;, record.data dict and dict , respectively</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">packet</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Ignoring empty scan data packet&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">pkgid</span><span class="p">,</span> <span class="n">packet</span> <span class="o">=</span> <span class="n">packet</span>
        <span class="n">pcktype</span> <span class="o">=</span> <span class="n">packet</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;__UNKNOWN_PCK_TYPE__&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">pcktype</span> <span class="o">==</span> <span class="s2">&quot;data_desc&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dataDescReceived</span><span class="p">(</span><span class="n">packet</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">pcktype</span> <span class="o">==</span> <span class="s2">&quot;record_data&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_scanLineReceived</span><span class="p">(</span><span class="n">packet</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
        <span class="k">elif</span> <span class="n">pcktype</span> <span class="o">==</span> <span class="s2">&quot;record_end&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addEndMarker</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Ignoring packet of type </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">pcktype</span><span class="p">))</span></div>

<div class="viewcode-block" id="ScanTrendsSet.clearTrends"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.clearTrends">[docs]</a>    <span class="k">def</span> <span class="nf">clearTrends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Reimplemented from :meth:`TaurusTrendsSet.clearTrends`.</span>

<span class="sd">        .. note:: If the autoClear property is True for this trend set, this method is</span>
<span class="sd">                  called automatically every time a data_desc package is received.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># clean the datadesc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__datadesc</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># clean markers</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endMarkers</span><span class="p">:</span>
            <span class="n">m</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_endMarkers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># reset current point counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># call the superclass</span>
        <span class="n">TaurusTrendsSet</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">replot</span><span class="o">=</span><span class="n">replot</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanTrendsSet.onPlotablesFilterChanged"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.onPlotablesFilterChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onPlotablesFilterChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flt</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        slot to be called whenever the plotables filter is changed. It will call</span>
<span class="sd">        :meth:`clearTrends` if flt is None</span>

<span class="sd">        :param flt:  (list&lt;method&gt;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">flt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setPlotablesFilter</span><span class="p">(</span><span class="n">flt</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanTrendsSet.setPlotablesFilter"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.setPlotablesFilter">[docs]</a>    <span class="k">def</span> <span class="nf">setPlotablesFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flt</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_plotablesFilter</span> <span class="o">=</span> <span class="n">flt</span></div>

    <span class="k">def</span> <span class="nf">_addEndMarker</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endMacroMarkerEnabled</span><span class="p">:</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">Qwt5</span><span class="o">.</span><span class="n">QwtPlotMarker</span><span class="p">()</span>
            <span class="n">m</span><span class="o">.</span><span class="n">setLineStyle</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">VLine</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">setXValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">attach</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">())</span>
            <span class="n">pen</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPen</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DashLine</span><span class="p">)</span>
            <span class="n">pen</span><span class="o">.</span><span class="n">setWidth</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">m</span><span class="o">.</span><span class="n">setLinePen</span><span class="p">(</span><span class="n">pen</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_endMarkers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>

<div class="viewcode-block" id="ScanTrendsSet.getDataDesc"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.getDataDesc">[docs]</a>    <span class="k">def</span> <span class="nf">getDataDesc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datadesc</span></div>

    <span class="k">def</span> <span class="nf">_dataDescReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadesc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;prepares the plot according to the info in the datadesc dictionary&#39;&#39;&#39;</span>
        <span class="c1"># backwards compatibility (datadesc was a list and now is a dict)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">datadesc</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">datadesc</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;column_desc&#39;</span><span class="p">:</span> <span class="n">datadesc</span><span class="p">}</span>
        <span class="c1"># clear existing curves if required</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoClear</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">()</span>
        <span class="c1"># decide which data to use for x</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xDataKey</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xDataKey</span> <span class="o">==</span> <span class="s2">&quot;&lt;mov&gt;&quot;</span><span class="p">:</span>  <span class="c1"># @todo use a standard key for &lt;mov&gt; and &lt;idx&gt;</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span> <span class="o">=</span> <span class="n">datadesc</span><span class="p">[</span><span class="s1">&#39;ref_moveables&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_X_DATA_KEY</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xDataKey</span> <span class="o">==</span> <span class="s2">&quot;&lt;idx&gt;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span> <span class="o">=</span> <span class="s1">&#39;point_nb&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xDataKey</span>
        <span class="c1"># set the x axis</span>
        <span class="n">columndesc</span> <span class="o">=</span> <span class="n">datadesc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;column_desc&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="n">xinfo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;min_value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;max_value&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">columndesc</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="s1">&#39;label&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span><span class="p">:</span>
                <span class="n">xinfo</span> <span class="o">=</span> <span class="n">e</span>
                <span class="k">break</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">setAxisTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span><span class="p">)</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">xinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_value&#39;</span><span class="p">),</span> <span class="n">xinfo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_value&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">setXDynScale</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xmin</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">xmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># autoscale if any limit is unknown</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">setAxisAutoScale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">xBottom</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">setAxisScale</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="c1"># create trends</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_createTrends</span><span class="p">(</span><span class="n">datadesc</span><span class="p">[</span><span class="s2">&quot;column_desc&quot;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_createTrends</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datadesc</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates the needed curves using the information from the DataDesc</span>

<span class="sd">        For now, it only creates trends for those &quot;columns&quot; containing scalar values</span>

<span class="sd">        :param datadesc: (seq&lt;dict&gt;) each dict is a ColumnDesc.toDict()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__datadesc</span> <span class="o">=</span> <span class="n">datadesc</span>
        <span class="c1"># create as many curves as columns containing scalars</span>
        <span class="n">rawdata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">0</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">_curvePens</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__datadesc</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stripShape</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># an scalar</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_plotablesFilter</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">and</span> <span class="n">name</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span><span class="p">:</span>
                    <span class="n">rawdata</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dd</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span>
                    <span class="n">curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">attachRawData</span><span class="p">(</span><span class="n">rawdata</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
                    <span class="n">prop</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">getAppearanceProperties</span><span class="p">()</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">sColor</span> <span class="o">=</span> <span class="n">prop</span><span class="o">.</span><span class="n">lColor</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">sStyle</span> <span class="o">=</span> <span class="n">Qwt5</span><span class="o">.</span><span class="n">QwtSymbol</span><span class="o">.</span><span class="n">Ellipse</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">sSize</span> <span class="o">=</span> <span class="mi">7</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">lWidth</span> <span class="o">=</span> <span class="mi">1</span>
                    <span class="n">prop</span><span class="o">.</span><span class="n">lStyle</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">DotLine</span>
                    <span class="n">curve</span><span class="o">.</span><span class="n">setAppearanceProperties</span><span class="p">(</span><span class="n">prop</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">addCurve</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">curve</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">autoShowYAxes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()))</span>

    <span class="k">def</span> <span class="nf">_scanLineReceived</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">recordData</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Receives a recordData dictionary and updates the curves associated to it</span>

<span class="sd">        .. seealso:: &lt;Sardana&gt;/MacroServer/scan/scandata.py:Record.data</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># obtain the x value</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span> <span class="o">==</span> <span class="s2">&quot;__SCAN_TREND_INDEX__&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span> <span class="o">=</span> <span class="n">recordData</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s1">&#39;Cannot find data &quot;</span><span class="si">%s</span><span class="s1">&quot; in the current scan record. Ignoring&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">numpy</span><span class="o">.</span><span class="n">isscalar</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Data for &quot;</span><span class="si">%s</span><span class="s1">&quot; is of type &quot;</span><span class="si">%s</span><span class="s1">&quot;. Cannot use it for the X values. Ignoring&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_autoXDataKey</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span><span class="p">)))</span>
                <span class="k">return</span>

        <span class="c1"># If autoclear is True, we use buffers</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoClear</span><span class="p">:</span>
            <span class="n">curvenames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurveNames</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span> <span class="o">=</span> <span class="n">ArrayBuffer</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="mi">128</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">maxSize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxDataBufferSize</span><span class="p">())</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span> <span class="o">=</span> <span class="n">ArrayBuffer</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                    <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">curvenames</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;d&#39;</span><span class="p">),</span> <span class="n">maxSize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxDataBufferSize</span><span class="p">())</span>
            <span class="c1"># x values</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span><span class="p">)</span>
            <span class="c1"># y values</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">recordData</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">NaN</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">curvenames</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_xValues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xBuffer</span><span class="o">.</span><span class="n">contents</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yBuffer</span><span class="o">.</span><span class="n">contents</span><span class="p">()</span>

            <span class="c1"># assign xvalues and yvalues to each of the curves in self._curves</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getCurves</span><span class="p">()):</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_xValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xValues</span>
                <span class="c1"># this is an assigment by reference</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_yValues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_yValues</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_updateMarkers</span><span class="p">()</span>

        <span class="c1"># if autoclear is False we have to work directly with each curve (and</span>
        <span class="c1"># cannot buffer)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">recordData</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_curves</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_xValues</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_xValues</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentpoint</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_yValues</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">_yValues</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">c</span><span class="o">.</span><span class="n">_updateMarkers</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()))</span>

<div class="viewcode-block" id="ScanTrendsSet.connectWithQDoor"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.connectWithQDoor">[docs]</a>    <span class="k">def</span> <span class="nf">connectWithQDoor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qdoor</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;connects this ScanTrendsSet to a QDoor</span>

<span class="sd">        :param qdoor: (QDoor or str) either a QDoor instance or the QDoor name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">sardana.taurus.qt.qtcore.tango.sardana.macroserver</span> <span class="k">import</span> <span class="n">QDoor</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qdoor</span><span class="p">,</span> <span class="n">QDoor</span><span class="p">):</span>
            <span class="n">qdoor</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="n">qdoor</span><span class="p">)</span>
        <span class="n">qdoor</span><span class="o">.</span><span class="n">recordDataUpdated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scanDataReceived</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanTrendsSet.disconnectQDoor"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.disconnectQDoor">[docs]</a>    <span class="k">def</span> <span class="nf">disconnectQDoor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qdoor</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;connects this ScanTrendsSet to a QDoor</span>

<span class="sd">        :param qdoor: (QDoor or str) either a QDoor instance or the QDoor name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="kn">from</span> <span class="nn">sardana.taurus.qt.qtcore.tango.sardana.macroserver</span> <span class="k">import</span> <span class="n">QDoor</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">qdoor</span><span class="p">,</span> <span class="n">QDoor</span><span class="p">):</span>
            <span class="n">qdoor</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="n">qdoor</span><span class="p">)</span>
        <span class="n">qdoor</span><span class="o">.</span><span class="n">recordDataUpdated</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scanDataReceived</span><span class="p">)</span></div>

<div class="viewcode-block" id="ScanTrendsSet.getModel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.getModel">[docs]</a>    <span class="k">def</span> <span class="nf">getModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__model</span></div>

<div class="viewcode-block" id="ScanTrendsSet.setModel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_ScanTrendsSet.html#taurus.qt.qtgui.plot.ScanTrendsSet.setModel">[docs]</a>    <span class="k">def</span> <span class="nf">setModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__model</span> <span class="o">=</span> <span class="n">model</span></div></div>


<div class="viewcode-block" id="TaurusTrend"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend">[docs]</a><span class="k">class</span> <span class="nc">TaurusTrend</span><span class="p">(</span><span class="n">TaurusPlot</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A :class:`TaurusPlot` -derived widget specialised in plotting trends (i.e.,</span>
<span class="sd">    evolution of parameters).</span>

<span class="sd">    .. image:: /_static/taurustrend01.png</span>
<span class="sd">       :align: center</span>

<span class="sd">    TaurusTrend inherits all the features from TaurusPlot (zooming,</span>
<span class="sd">    exporting/importing, data inspection,...) and also provides some specific</span>
<span class="sd">    features (e.g. fixed-range X scale mode and Archiving support).</span>

<span class="sd">    For an overview of the features from an user point of view, see the</span>
<span class="sd">    :ref:`TaurusTrend User&#39;s Interface Guide &lt;trend_ui&gt;`.</span>

<span class="sd">    You can also see some code that exemplifies the use of TaurusTrend in :ref:`the</span>
<span class="sd">    TaurusTrend coding examples &lt;examples_taurustrend&gt;`</span>

<span class="sd">    Note: if you pass a model that is a 1D attribute (instead of a</span>
<span class="sd">    scalar), TaurusTrend will interpret it as a collection of scalar values and</span>
<span class="sd">    will plot a separate trend line for each.</span>

<span class="sd">    Note 2: As an special case, you can pass a model of the type</span>
<span class="sd">    scan://doorname. This will link the TaurusTrend to the given Taurus door and will</span>
<span class="sd">    listen to it for scan record events, which will be plotted.</span>



<span class="sd">    .. seealso:: :class:`TaurusPlot`,</span>
<span class="sd">                 :ref:`TaurusTrend User&#39;s Interface Guide &lt;trend_ui&gt;`,</span>
<span class="sd">                 :ref:`The TaurusTrend coding examples &lt;examples_taurustrend&gt;`</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">DEFAULT_MAX_BUFFER_SIZE</span> <span class="o">=</span> <span class="mi">65536</span>  <span class="c1"># (=2**16, i.e., 64K events))</span>

    <span class="n">dataChanged</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="s1">&#39;QString&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">designMode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">TaurusPlot</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">,</span> <span class="n">designMode</span><span class="o">=</span><span class="n">designMode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_supportedConfigVersions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ttc-1&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_xDynScaleSupported</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchiving</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBuffer</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultCurvesTitle</span><span class="p">(</span><span class="s1">&#39;&lt;label&gt;&lt;[trend_index]&gt;&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxDataBufferSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_MAX_BUFFER_SIZE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scansXDataKey</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initActions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_startingTime</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_archivingWarningLocked</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_forcedReadingPeriod</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setXIsTime</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Use a rotated labels x timescale by default</span>
        <span class="n">rotation</span> <span class="o">=</span> <span class="o">-</span><span class="mi">45</span>
        <span class="n">alignment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getDefaultAxisLabelsAlignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAxisLabelRotation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">rotation</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAxisLabelAlignment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">alignment</span><span class="p">)</span>
        <span class="c1"># use dynamic scale by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setXDynScale</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scrollStep</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="k">def</span> <span class="nf">__initActions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create TaurusTrend actions&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchivingAction</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Use Archiver&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchivingAction</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchivingAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUseArchiving</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchivingAction</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onUseArchivingAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBufferAction</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Use Polling Buffer&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBufferAction</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBufferAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getUsePollingBuffer</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBufferAction</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setUsePollingBuffer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setForcedReadingPeriodAction</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Set forced reading period...&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setForcedReadingPeriodAction</span><span class="o">.</span><span class="n">triggered</span><span class="p">[()]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setForcedReadingPeriod</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clearBuffersAction</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="s2">&quot;Clear Buffers&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_clearBuffersAction</span><span class="o">.</span><span class="n">triggered</span><span class="p">[()]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">clearBuffers</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setMaxBufferSizeAction</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Change buffers size...&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setMaxBufferSizeAction</span><span class="o">.</span><span class="n">triggered</span><span class="p">[()]</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setMaxDataBufferSize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoClearOnScanAction</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span>
            <span class="s2">&quot;Auto-clear on new scans&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoClearOnScanAction</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoClearOnScanAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoClearOnScanAction</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onAutoClearOnScanAction</span><span class="p">)</span>

<div class="viewcode-block" id="TaurusTrend.isTimerNeeded"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.isTimerNeeded">[docs]</a>    <span class="k">def</span> <span class="nf">isTimerNeeded</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checkMinimized</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;checks if it makes sense to activate the replot timer.</span>
<span class="sd">        The following conditions must be met:</span>

<span class="sd">        - the replot timer must exist</span>
<span class="sd">        - the area of the plot must be non-zero</span>
<span class="sd">        - at least one trendset must be attached</span>
<span class="sd">        - the plot should be visible</span>
<span class="sd">        - the plot should not be minimized (unless checkMinimized=False)</span>

<span class="sd">        :param checkMinimized: (bool) whether to include the check of minimized (True by default)</span>

<span class="sd">        :return: (bool)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> \
            <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">size</span><span class="p">()</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">()</span> <span class="ow">and</span> \
            <span class="nb">bool</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">))</span> <span class="ow">and</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">isVisible</span><span class="p">()</span> <span class="ow">and</span> \
            <span class="ow">not</span> <span class="p">(</span><span class="n">checkMinimized</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isMinimized</span><span class="p">())</span></div>

<div class="viewcode-block" id="TaurusTrend.showEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.showEvent">[docs]</a>    <span class="k">def</span> <span class="nf">showEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented from :meth:`TaurusPlot.showEvent` so that</span>
<span class="sd">        the replot timer is active only when needed&#39;&#39;&#39;</span>
        <span class="n">TaurusPlot</span><span class="o">.</span><span class="n">showEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isTimerNeeded</span><span class="p">(</span><span class="n">checkMinimized</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;(re)starting the timer (in showEvent)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.hideEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.hideEvent">[docs]</a>    <span class="k">def</span> <span class="nf">hideEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented from :meth:`TaurusPlot.showEvent` so that</span>
<span class="sd">        the replot timer is active only when needed&#39;&#39;&#39;</span>
        <span class="n">TaurusPlot</span><span class="o">.</span><span class="n">hideEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;stopping the timer (in hideEvent)&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.resizeEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.resizeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented from :meth:`TaurusPlot.resizeEvent` so that</span>
<span class="sd">        the replot timer is active only when needed&#39;&#39;&#39;</span>
        <span class="n">TaurusPlot</span><span class="o">.</span><span class="n">resizeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">oldSize</span><span class="p">()</span><span class="o">.</span><span class="n">isEmpty</span><span class="p">():</span>  <span class="c1"># do further checks only if previous size was 0</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isTimerNeeded</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;(re)starting the timer (in resizeEvent)&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;stopping the timer (in resizeEvent)&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.setXIsTime"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setXIsTime">[docs]</a>    <span class="k">def</span> <span class="nf">setXIsTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">Qwt5</span><span class="o">.</span><span class="n">QwtPlot</span><span class="o">.</span><span class="n">xBottom</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reimplemented from :meth:`TaurusPlot.setXIsTime`&#39;&#39;&#39;</span>
        <span class="c1"># set a reasonable scale</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAxisScale</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startingTime</span> <span class="o">-</span> <span class="mi">60</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_startingTime</span><span class="p">)</span>  <span class="c1"># Set a range of 1 min</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setAxisScale</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>  <span class="c1"># Set a range of 10 events</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axisWidget</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">scaleDivChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rescheduleReplot</span><span class="p">)</span>  <span class="c1"># disconnects the previous axis</span>
        <span class="c1"># enable/disable the archiving action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchivingAction</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>
        <span class="c1"># call the parent class method</span>
        <span class="c1"># the axis is changed here</span>
        <span class="n">TaurusPlot</span><span class="o">.</span><span class="n">setXIsTime</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="c1"># set the replot timer if needed</span>
        <span class="k">if</span> <span class="n">enable</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_designMode</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_dirtyPlot</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">doReplot</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rescheduleReplot</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axisWidget</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span><span class="o">.</span><span class="n">scaleDivChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rescheduleReplot</span><span class="p">)</span>  <span class="c1"># connects the new axis</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TaurusTrend.onScanPlotablesFilterChanged"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.onScanPlotablesFilterChanged">[docs]</a>    <span class="k">def</span> <span class="nf">onScanPlotablesFilterChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flt</span><span class="p">,</span> <span class="n">scanname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scanname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">scanname</span> <span class="o">=</span> <span class="s2">&quot;scan://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span>
        <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTrendSet</span><span class="p">(</span><span class="n">scanname</span><span class="p">)</span>
        <span class="n">tset</span><span class="o">.</span><span class="n">onPlotablesFilterChanged</span><span class="p">(</span><span class="n">flt</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.setScansAutoClear"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setScansAutoClear">[docs]</a>    <span class="k">def</span> <span class="nf">setScansAutoClear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        sets whether the trend sets associated to scans should be reset every</span>
<span class="sd">        time a data_desc packet is received from the door.</span>

<span class="sd">        :param enable: (bool)</span>

<span class="sd">        .. seealso:: :meth:`setScanDoor` and :class:`ScanTrendsSet`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_autoClearOnScanAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_onAutoClearOnScanAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">,</span> <span class="n">scanname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Autoclear on Scan set to </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">enable</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">scanname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">scanname</span> <span class="o">=</span> <span class="s2">&quot;scan://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span>
        <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTrendSet</span><span class="p">(</span><span class="n">scanname</span><span class="p">)</span>
        <span class="n">tset</span><span class="o">.</span><span class="n">setAutoClear</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span>

<div class="viewcode-block" id="TaurusTrend.getScansAutoClear"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getScansAutoClear">[docs]</a>    <span class="k">def</span> <span class="nf">getScansAutoClear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_autoClearOnScanAction</span><span class="o">.</span><span class="n">isChecked</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.setScansUsePointNumber"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setScansUsePointNumber">[docs]</a>    <span class="k">def</span> <span class="nf">setScansUsePointNumber</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        .. note:: This method is deprecated. Please use :meth:`setScansXDataKey` instead</span>

<span class="sd">        sets whether the trend sets associated to scans should use the point</span>
<span class="sd">        number from the data record for the abscissas (default).</span>

<span class="sd">        :param enable: (bool)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s1">&#39;setScansUsePointNumber is deprecated. Please use setScansXDataKey instead&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;point_nb&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;__SCAN_TREND_INDEX__&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setScansXDataKey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.setScansXDataKey"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setScansXDataKey">[docs]</a>    <span class="k">def</span> <span class="nf">setScansXDataKey</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">scanname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        selects the source for the data to be used as abscissas in the scan plot.</span>

<span class="sd">        :param key: (str) a string corresponding to a data label for data</span>
<span class="sd">                    present in the scan. Alternatively, &quot;__SCAN_TREND_INDEX__&quot;</span>
<span class="sd">                    can be used for an internal integer count of scan records</span>

<span class="sd">        :param scanname: (str or None) name of the model for the scan. If None,</span>
<span class="sd">                         the default scan is selected</span>

<span class="sd">        .. seealso:: the constructor of :class:`ScanTrendsSet`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">scanname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="n">scanname</span> <span class="o">=</span> <span class="s2">&quot;scan://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span>
        <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTrendSet</span><span class="p">(</span><span class="n">scanname</span><span class="p">)</span>
        <span class="n">tset</span><span class="o">.</span><span class="n">setXDataKey</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAxisTitle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scansXDataKey</span> <span class="o">=</span> <span class="n">key</span></div>

<div class="viewcode-block" id="TaurusTrend.setScanDoor"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setScanDoor">[docs]</a>    <span class="k">def</span> <span class="nf">setScanDoor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qdoorname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        sets the door to which TaurusTrend will listen for scans.</span>
<span class="sd">        This removes any previous scan set using this method, but respects scans set with setModel</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeModels</span><span class="p">([</span><span class="s2">&quot;scan://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addModels</span><span class="p">([</span><span class="s2">&quot;scan://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">qdoorname</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="o">=</span> <span class="n">qdoorname</span></div>

<div class="viewcode-block" id="TaurusTrend.clearScan"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.clearScan">[docs]</a>    <span class="k">def</span> <span class="nf">clearScan</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scanname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;resets the curves associated to the given scan</span>

<span class="sd">        :param scanname: (str) the scan model name (e.g. &quot;scan://a/b/c&quot;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTrendSet</span><span class="p">(</span><span class="n">scanname</span><span class="p">)</span>
        <span class="n">tset</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.clearBuffers"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.clearBuffers">[docs]</a>    <span class="k">def</span> <span class="nf">clearBuffers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;clears the buffers of existing trend sets (note that this does</span>
<span class="sd">        not remove the models, it simply removes all stored data)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">(</span><span class="n">replot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.updateCurves"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.updateCurves">[docs]</a>    <span class="k">def</span> <span class="nf">updateCurves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">names</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Defines the curves that need to be plotted. For a TaurusTrend, the</span>
<span class="sd">        models can refer to:</span>

<span class="sd">        - scalar data: they are to be plotted in a trend</span>
<span class="sd">        - on-dimensional data: each element of the spectrum is considered</span>
<span class="sd">          independently</span>

<span class="sd">        Note that passing an attribute for X values makes no sense in this case</span>

<span class="sd">        Internally, every curve is grouped in a TaurusTrendSet. For each SPECTRUM</span>
<span class="sd">        attribute, a TrendSet is created, containing as many curves as the</span>
<span class="sd">        lenght of the spectrum For eacha SCALAR attribute, a TrendSet containing</span>
<span class="sd">        just one curve is created.</span>

<span class="sd">        :param names: (sequence&lt;str&gt;) a sequence of model names</span>

<span class="sd">        .. note:: Adding/removing a model will add/remove a whole set. No</span>
<span class="sd">                  sub-set adding/removing is allowed.</span>
<span class="sd">                  Still, each curve will be independent regarding its</span>
<span class="sd">                  properties, and can be hidden/shown independently.</span>

<span class="sd">        .. seealso:: :meth:`TaurusPlot.updateCurves`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># For it to work properly, &#39;names&#39; must be a CaselessList, just as</span>
            <span class="c1"># self.trendSets is a CaselessDict</span>
            <span class="n">del_sets</span> <span class="o">=</span> <span class="p">[</span><span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">names</span><span class="p">]</span>

            <span class="c1"># if all trends were removed, reset the color palette</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">del_sets</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_curvePens</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># update new/existing trendsets</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="s2">&quot;|&quot;</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s1">&#39;composed (&quot;X|Y&quot;) models are not supported by TaurusTrend&#39;</span><span class="p">)</span>
                <span class="c1"># create a new TrendSet if not already there</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
                    <span class="c1"># check if the model name is of scan type and provides a</span>
                    <span class="c1"># door</span>
                    <span class="n">matchScan</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;scan:\/\/(.*)&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">matchScan</span><span class="p">:</span>
                        <span class="n">tset</span> <span class="o">=</span> <span class="n">ScanTrendsSet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">autoClear</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getScansAutoClear</span><span class="p">(</span>
                        <span class="p">),</span> <span class="n">xDataKey</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_scansXDataKey</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="o">=</span> <span class="n">matchScan</span><span class="o">.</span><span class="n">group</span><span class="p">(</span>
                            <span class="mi">1</span><span class="p">)</span>  <span class="c1"># the name of the door</span>
                        <span class="n">tset</span><span class="o">.</span><span class="n">connectWithQDoor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">tset</span> <span class="o">=</span> <span class="n">TaurusTrendsSet</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcedReadingPeriod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">tset</span><span class="o">.</span><span class="n">setForcedReadingPeriod</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_forcedReadingPeriod</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">tset</span>
                    <span class="n">tset</span><span class="o">.</span><span class="n">registerDataChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curveDataChanged</span><span class="p">)</span>
            <span class="c1"># Trend Sets to be removed</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">del_sets</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">tset</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                <span class="n">tset</span><span class="o">.</span><span class="n">unregisterDataChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">curveDataChanged</span><span class="p">)</span>
                <span class="n">tset</span><span class="o">.</span><span class="n">forcedReadingTimer</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">tset</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">(</span><span class="n">replot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">matchScan</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;scan:\/\/(.*)&quot;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">matchScan</span><span class="p">:</span>
                    <span class="n">olddoorname</span> <span class="o">=</span> <span class="n">matchScan</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">tset</span><span class="o">.</span><span class="n">disconnectQDoor</span><span class="p">(</span><span class="n">olddoorname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">del_sets</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">autoShowYAxes</span><span class="p">()</span>

            <span class="c1"># legend</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showLegend</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">curves</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="n">forever</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>

            <span class="c1"># keep the replotting timer active only if there is something to</span>
            <span class="c1"># refresh</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">isTimerNeeded</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;(re)starting the timer (in updateCurves)&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;stopping the timer (in updateCurves)&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.getTrendSetNames"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getTrendSetNames">[docs]</a>    <span class="k">def</span> <span class="nf">getTrendSetNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the names of all TrendSets attached to this TaurusTrend.</span>

<span class="sd">        :return: (list&lt;str&gt;) a copy of self.trendSets.keys()</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.getTrendSet"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getTrendSet">[docs]</a>    <span class="k">def</span> <span class="nf">getTrendSet</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;gets a trend set object by name.</span>

<span class="sd">        **Important**: Note that the TrendSet object is not thread safe.</span>
<span class="sd">        Therefore, if you access it you must do it protected by the</span>
<span class="sd">        TaurusTrend.curves_lock reentrant lock.</span>

<span class="sd">        :param name: (str) the trend set name</span>

<span class="sd">        :return: (TaurusTrendSet) the trend set object corresponding to name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="TaurusTrend.getCurveTitle"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getCurveTitle">[docs]</a>    <span class="k">def</span> <span class="nf">getCurveTitle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented from :class:`TaurusPlot`.</span>
<span class="sd">        Returns the title of a curve from a trendset</span>

<span class="sd">        :param name: (str) The name of the trendset. If the name is not a known</span>
<span class="sd">                     trendset name and index is None, we will try with tsetname and</span>
<span class="sd">                     index obtained from parsing the given name (assuming the</span>
<span class="sd">                     format &#39;&lt;tsetname&gt;[&lt;index&gt;]&#39;).</span>
<span class="sd">        :param index: (int or None) the index of the curve in the trend set.</span>
<span class="sd">                      If None is passed, it returns the base title of the trendset</span>

<span class="sd">        :return: (str) the title</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># name not found...</span>
                <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># maybe name was actually a curve name including the index?</span>
                    <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(.*)\[([0-9]+)\]$&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                        <span class="n">name</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
                        <span class="c1"># recursive call with parsed tsetname and index</span>
                        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getCurveTitle</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">tset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">tset</span><span class="o">.</span><span class="n">compiledTitle</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">tset</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">title</span></div>

<div class="viewcode-block" id="TaurusTrend.changeCurvesTitlesDialog"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.changeCurvesTitlesDialog">[docs]</a>    <span class="k">def</span> <span class="nf">changeCurvesTitlesDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">curveNamesList</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Shows a dialog to set the curves titles (it will change the current</span>
<span class="sd">        curves titles and the default curves titles)</span>

<span class="sd">        :param curveNamesList: (string_sequence or string_iterator) names of the</span>
<span class="sd">                               curves to which the title will be changed (if</span>
<span class="sd">                               None given , it will apply to all the TrendsSets</span>
<span class="sd">                               and it will also be used as default for newly</span>
<span class="sd">                               created ones)</span>

<span class="sd">        :return: (caselessDict&lt;str,QString&gt; or None) The return value will be</span>
<span class="sd">                 `None` if `curveNamesList` is None. Otherwise it will be a</span>
<span class="sd">                 dictionary with key=curvename and value=newtitle.</span>

<span class="sd">        .. seealso:: :meth:`setCurvesTitle`, :meth:`setDefaultCurvesTitle`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">newTitlesDict</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">placeholders</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;label&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;model&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;attr_name&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;attr_fullname&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;dev_alias&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;dev_name&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;dev_fullname&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;current_title&gt;&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;&lt;trend_index&gt;&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;[trend_index]&gt;&#39;</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="n">placeholders</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_defaultCurvesTitle</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">placeholders</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">current</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">placeholders</span><span class="p">)</span>
            <span class="n">items</span> <span class="o">=</span> <span class="n">placeholders</span> <span class="o">+</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_defaultCurvesTitle</span><span class="p">]</span>

        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;New text to be used for the curves.</span><span class="se">\n</span><span class="s1">You can use any of the following placeholders:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="n">placeholders</span><span class="p">)</span>
        <span class="n">titletext</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;New Title for Curves&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="n">current</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">titletext</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">titletext</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">curveNamesList</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setDefaultCurvesTitle</span><span class="p">(</span><span class="n">titletext</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setTrendSetsTitles</span><span class="p">(</span><span class="n">titletext</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">newTitlesDict</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">curveName</span> <span class="ow">in</span> <span class="n">curveNamesList</span><span class="p">:</span>
                        <span class="n">curvetitle</span> <span class="o">=</span> <span class="n">titletext</span>
                        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">curveName</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">:</span>
                                <span class="n">curvetitle</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">compileBaseTitle</span><span class="p">(</span><span class="n">curvetitle</span><span class="p">)</span>
                                <span class="n">curvetitle</span> <span class="o">=</span> <span class="n">curvetitle</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
                                    <span class="s1">&#39;&lt;trend_index&gt;&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">%i</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ts</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">curveName</span><span class="p">))</span>
                                <span class="k">break</span>
                        <span class="n">curve</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">curves</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">curveName</span><span class="p">)</span>
                        <span class="n">curve</span><span class="o">.</span><span class="n">setTitleText</span><span class="p">(</span><span class="n">curvetitle</span><span class="p">)</span>
                        <span class="n">newTitlesDict</span><span class="p">[</span><span class="n">curveName</span><span class="p">]</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">title</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">updateLegend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">())</span>
                    <span class="k">return</span> <span class="n">newTitlesDict</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">newTitlesDict</span></div>

<div class="viewcode-block" id="TaurusTrend.setTrendSetsTitles"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setTrendSetsTitles">[docs]</a>    <span class="k">def</span> <span class="nf">setTrendSetsTitles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">basetitle</span><span class="p">,</span> <span class="n">setNames</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Calls setTitleText(basetitle) for each Trend Set set in setNames</span>

<span class="sd">        :param basetitle: (str) the base title</span>
<span class="sd">        :param setNames: (sequence&lt;str&gt; or iterator&lt;str&gt;) names of the sets to be changed</span>

<span class="sd">        See: TaurusTrendsSet.setTitleText</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">setNames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">setNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">tname</span> <span class="ow">in</span> <span class="n">setNames</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">[</span><span class="n">tname</span><span class="p">]</span><span class="o">.</span><span class="n">setTitleText</span><span class="p">(</span><span class="n">basetitle</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateLegend</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legend</span><span class="p">())</span></div>

    <span class="nd">@Qt</span><span class="o">.</span><span class="n">pyqtSlot</span><span class="p">(</span><span class="s1">&#39;QString&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;dataChanged&#39;</span><span class="p">)</span>
<div class="viewcode-block" id="TaurusTrend.curveDataChanged"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.curveDataChanged">[docs]</a>    <span class="k">def</span> <span class="nf">curveDataChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;slot that is called whenever a curve emits a dataChanged signal</span>

<span class="sd">        :emits: &quot;dataChanged(const QString &amp;)&quot;</span>

<span class="sd">        :param name: (str) curve name</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">curve</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">getCurves</span><span class="p">():</span>
                <span class="n">curve</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">_xValues</span><span class="p">,</span> <span class="n">curve</span><span class="o">.</span><span class="n">_yValues</span><span class="p">)</span>
            <span class="c1"># self._zoomer.setZoomBase()</span>
            <span class="c1"># keep the scale width constant, but translate it to get the last</span>
            <span class="c1"># value</span>
            <span class="k">if</span> <span class="n">curve</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">getXDynScale</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">curve</span><span class="o">.</span><span class="n">_xValues</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">sdiv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisScaleDiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">)</span>
                <span class="n">currmin</span><span class="p">,</span> <span class="n">currmax</span> <span class="o">=</span> <span class="n">sdiv</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">(),</span> <span class="n">sdiv</span><span class="o">.</span><span class="n">upperBound</span><span class="p">()</span>
                <span class="n">datamax</span> <span class="o">=</span> <span class="n">curve</span><span class="o">.</span><span class="n">_xValues</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">datamax</span> <span class="o">&gt;</span> <span class="n">currmax</span> <span class="ow">or</span> <span class="n">datamax</span> <span class="o">&lt;</span> <span class="n">currmin</span><span class="p">:</span>
                    <span class="n">minstep</span> <span class="o">=</span> <span class="n">datamax</span> <span class="o">-</span> <span class="n">currmax</span>  <span class="c1"># the new scale max must be above the latest point</span>
                    <span class="n">maxstep</span> <span class="o">=</span> <span class="n">datamax</span> <span class="o">-</span> <span class="n">currmin</span>  <span class="c1"># the new scale min must be below the latest point</span>
                    <span class="n">step</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getXAxisRange</span><span class="p">()</span> <span class="o">*</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_scrollStep</span><span class="p">,</span> <span class="n">minstep</span><span class="p">),</span> <span class="n">maxstep</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setAxisScale</span><span class="p">(</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">currmin</span> <span class="o">+</span> <span class="n">step</span><span class="p">,</span> <span class="n">currmax</span> <span class="o">+</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">xIsTime</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dirtyPlot</span> <span class="o">=</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="TaurusTrend.doReplot"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.doReplot">[docs]</a>    <span class="k">def</span> <span class="nf">doReplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;calls :meth:`replot` only if there is new data to be plotted&#39;&#39;&#39;</span>
        <span class="c1">#self.trace(&#39;Replotting? %s&#39;,self._dirtyPlot)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dirtyPlot</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dirtyPlot</span> <span class="o">=</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="TaurusTrend.rescheduleReplot"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.rescheduleReplot">[docs]</a>    <span class="k">def</span> <span class="nf">rescheduleReplot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">Qwt5</span><span class="o">.</span><span class="n">QwtPlot</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1080</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;calculates the replotting frequency based on the time axis range.</span>
<span class="sd">        It assumes that it is unnecessary to replot with a period less than the</span>
<span class="sd">        time per pixel.</span>

<span class="sd">        :param axis: (Qwt5.QwtPlot.Axis) the axis to which it should associate</span>
<span class="sd">        :param width: (int) the approx canvas width (in pixels). The exact value</span>
<span class="sd">                      could be obtained from the widget, but an order of</span>
<span class="sd">                      magnitude approximation is usually ok (and cheaper). The</span>
<span class="sd">                      default value is 1080 (HD ready!)</span>

<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">xIsTime</span><span class="p">:</span>
            <span class="n">sdiv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisScaleDiv</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
            <span class="n">currmin</span><span class="p">,</span> <span class="n">currmax</span> <span class="o">=</span> <span class="n">sdiv</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">(),</span> <span class="n">sdiv</span><span class="o">.</span><span class="n">upperBound</span><span class="p">()</span>
            <span class="n">plot_refresh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="p">(</span><span class="n">currmax</span> <span class="o">-</span> <span class="n">currmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">width</span><span class="p">)</span>
            <span class="c1"># enforce limits</span>
            <span class="n">plot_refresh</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="nb">max</span><span class="p">((</span><span class="n">plot_refresh</span><span class="p">,</span> <span class="mi">250</span><span class="p">)),</span> <span class="mi">1800000</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">interval</span><span class="p">()</span> <span class="o">!=</span> <span class="n">plot_refresh</span><span class="p">:</span>
                <span class="c1"># note: calling QTimer.setInterval() very often seems to eventually trigger some bug</span>
                <span class="c1">#      that stops the timer from emitting the timeout signal. We avoid this by</span>
                <span class="c1">#      calling setInterval only when really needed.</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_replotTimer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="n">plot_refresh</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;New replot period is </span><span class="si">%1.2f</span><span class="s1"> seconds&#39;</span><span class="p">,</span>
                           <span class="p">(</span><span class="n">plot_refresh</span> <span class="o">/</span> <span class="mf">1000.</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;rescheduleReplot() called but X axis is not in time mode&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.setPaused"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setPaused">[docs]</a>    <span class="k">def</span> <span class="nf">setPaused</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paused</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Pauses itself and other listeners (e.g. the trendsets) depending on it</span>

<span class="sd">        .. seealso:: :meth:`TaurusBaseComponent.setPaused`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">ts</span><span class="o">.</span><span class="n">setPaused</span><span class="p">(</span><span class="n">paused</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_isPaused</span> <span class="o">=</span> <span class="n">paused</span></div>

<div class="viewcode-block" id="TaurusTrend.createConfig"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.createConfig">[docs]</a>    <span class="k">def</span> <span class="nf">createConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a pickable dictionary containing all relevant information</span>
<span class="sd">        about the current plot.</span>
<span class="sd">        For Taurus attributes it stores the attribute name and the curve properties</span>
<span class="sd">        For raw data curves, it stores the data as well.</span>

<span class="sd">        Hint: The following code allows you to serialize the configuration</span>
<span class="sd">        dictionary as a string (which you can store as a QSetting, or as a Taurus</span>
<span class="sd">        Attribute)::</span>

<span class="sd">            import pickle</span>
<span class="sd">            c = pickle.dumps(taurusplot.createConfig())  #c is a string that can be stored</span>

<span class="sd">        :param names:  (sequence&lt;str&gt;) a sequence of TrendSet names for which the</span>
<span class="sd">                       configuration will be stored (all by default).</span>

<span class="sd">        :return: (dict) configurations (which can be loaded with applyConfig)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">configdict</span> <span class="o">=</span> <span class="n">TaurusPlot</span><span class="o">.</span><span class="n">createConfig</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">curvenames</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># use the superclass configdict as a starting point</span>
        <span class="k">if</span> <span class="n">tsnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tsnames</span> <span class="o">=</span> <span class="n">CaselessList</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">())</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">CaselessList</span><span class="p">([</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()</span> <span class="k">if</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">tsnames</span><span class="p">])</span>
        <span class="c1"># overwrite the value created by TaurusPlot.createConfig()</span>
        <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
        <span class="c1"># delete the TangoCurves key since it is meaningless in a TaurusTrend</span>
        <span class="n">configdict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;TangoCurves&quot;</span><span class="p">)</span>
        <span class="n">tsetsdict</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">()</span>
        <span class="n">rawdatadict</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">(</span><span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;RawData&quot;</span><span class="p">])</span>
        <span class="n">miscdict</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">(</span><span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;Misc&quot;</span><span class="p">])</span>
        <span class="n">miscdict</span><span class="p">[</span><span class="s2">&quot;ForcedReadingPeriod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getForcedReadingPeriod</span><span class="p">()</span>
        <span class="n">miscdict</span><span class="p">[</span><span class="s2">&quot;MaxBufferSize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMaxDataBufferSize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">tsname</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">tsname</span> <span class="ow">in</span> <span class="n">tsnames</span><span class="p">:</span>
                    <span class="c1"># store a dict containing just model names (key and value</span>
                    <span class="c1"># are the same)</span>
                    <span class="n">tsetsdict</span><span class="p">[</span><span class="n">tsname</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsname</span>
                <span class="k">for</span> <span class="n">cname</span> <span class="ow">in</span> <span class="n">CaselessList</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">getCurveNames</span><span class="p">()):</span>
                    <span class="c1"># clean the rawdatadict of rawdata curves that come from</span>
                    <span class="c1"># trendsets (but we keep the properties!)</span>
                    <span class="n">rawdatadict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">cname</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;TrendSets&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">tsetsdict</span>
        <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;RawData&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rawdatadict</span>
        <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;Misc&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">miscdict</span>
        <span class="k">return</span> <span class="n">configdict</span></div>

<div class="viewcode-block" id="TaurusTrend.applyConfig"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.applyConfig">[docs]</a>    <span class="k">def</span> <span class="nf">applyConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configdict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;applies the settings stored in a configdict to the current plot.</span>

<span class="sd">        :param configdict: (dict)</span>

<span class="sd">        .. seealso:: :meth:`createConfig`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkConfigVersion</span><span class="p">(</span><span class="n">configdict</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="c1"># set the max Buffer data size (we do it before ataching the curves to</span>
        <span class="c1"># avoid useless reallocations of buffers)</span>
        <span class="n">maxBufferSize</span> <span class="o">=</span> <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;Misc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MaxBufferSize&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">maxBufferSize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setMaxDataBufferSize</span><span class="p">(</span><span class="n">maxBufferSize</span><span class="p">)</span>
        <span class="c1"># attach the curves</span>
        <span class="k">for</span> <span class="n">rd</span> <span class="ow">in</span> <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;RawData&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attachRawData</span><span class="p">(</span><span class="n">rd</span><span class="p">)</span>
        <span class="c1"># for backwards compatibility, if the ordered list of models is not</span>
        <span class="c1"># stored, it uses the unsorted dict values</span>
        <span class="n">models</span> <span class="o">=</span> <span class="n">configdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;TrendSets&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addModels</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
            <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
            <span class="c1"># a fake event to force generating the curves</span>
            <span class="n">tset</span><span class="o">.</span><span class="n">fireEvent</span><span class="p">(</span>
                <span class="kc">None</span><span class="p">,</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">taurusbasetypes</span><span class="o">.</span><span class="n">TaurusEventType</span><span class="o">.</span><span class="n">Change</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># set curve properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCurveAppearanceProperties</span><span class="p">(</span><span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;CurveProp&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updateLegend</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># set the axes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyAxesConfig</span><span class="p">(</span><span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;Axes&quot;</span><span class="p">])</span>
        <span class="c1"># set other misc configurations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">applyMiscConfig</span><span class="p">(</span><span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;Misc&quot;</span><span class="p">])</span>
        <span class="n">forcedreadingperiod</span> <span class="o">=</span> <span class="n">configdict</span><span class="p">[</span><span class="s2">&quot;Misc&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ForcedReadingPeriod&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">forcedreadingperiod</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setForcedReadingPeriod</span><span class="p">(</span><span class="n">forcedreadingperiod</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TaurusTrend.getQtDesignerPluginInfo"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getQtDesignerPluginInfo">[docs]</a>    <span class="k">def</span> <span class="nf">getQtDesignerPluginInfo</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns pertinent information in order to be able to build a valid</span>
<span class="sd">        QtDesigner widget plugin</span>

<span class="sd">        :return: (dict) a map with pertinent designer information&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;module&#39;</span><span class="p">:</span> <span class="s1">&#39;taurus.qt.qtgui.plot&#39;</span><span class="p">,</span>
            <span class="s1">&#39;group&#39;</span><span class="p">:</span> <span class="s1">&#39;Taurus Display&#39;</span><span class="p">,</span>
            <span class="s1">&#39;icon&#39;</span><span class="p">:</span> <span class="s1">&#39;designer:qwtplot.png&#39;</span><span class="p">,</span>
            <span class="s1">&#39;container&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span></div>

<div class="viewcode-block" id="TaurusTrend.setEventFilters"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setEventFilters">[docs]</a>    <span class="k">def</span> <span class="nf">setEventFilters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tsetnames</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">preqt</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;propagates a list of taurus filters to the trendsets given by tsetnames.</span>
<span class="sd">        See :meth:`TaurusBaseComponent.setEventFilters`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">tsetnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tsetnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tsetnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">setEventFilters</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span> <span class="n">preqt</span><span class="o">=</span><span class="n">preqt</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.setUsePollingBuffer"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setUsePollingBuffer">[docs]</a>    <span class="k">def</span> <span class="nf">setUsePollingBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;enables/disables looking up in the PollingBuffer for data</span>

<span class="sd">        :param enable: (bool) if True, PollingBuffer values will be used if available</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBuffer</span> <span class="o">=</span> <span class="n">enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.getUsePollingBuffer"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getUsePollingBuffer">[docs]</a>    <span class="k">def</span> <span class="nf">getUsePollingBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;whether TaurusTrend is looking for data in the PollingBuffer</span>

<span class="sd">        :return: (bool)</span>

<span class="sd">        .. seealso:: :meth:`setUsePollingBuffer`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBuffer</span></div>

<div class="viewcode-block" id="TaurusTrend.resetUsePollingBuffer"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.resetUsePollingBuffer">[docs]</a>    <span class="k">def</span> <span class="nf">resetUsePollingBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Same as setUsePollingBuffer(True)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUsePollingBuffer</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.setUseArchiving"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setUseArchiving">[docs]</a>    <span class="k">def</span> <span class="nf">setUseArchiving</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;enables/disables looking up in the archiver for data stored before</span>
<span class="sd">        the Trend was started</span>

<span class="sd">        :param enable: (bool) if True, archiving values will be used if available</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">getXIsTime</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;ignoring setUseArchiving. Reason: not in X time scale&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchivingAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="n">enable</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.getUseArchiving"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getUseArchiving">[docs]</a>    <span class="k">def</span> <span class="nf">getUseArchiving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;whether TaurusTrend is looking for data in the archiver when needed</span>

<span class="sd">        :return: (bool)</span>

<span class="sd">        .. seealso:: :meth:`setUseArchiving`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_useArchiving</span></div>

<div class="viewcode-block" id="TaurusTrend.resetUseArchiving"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.resetUseArchiving">[docs]</a>    <span class="k">def</span> <span class="nf">resetUseArchiving</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Same as setUseArchiving(True)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUseArchiving</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_onUseArchivingAction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enable</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;slot being called when toggling the useArchiving action</span>

<span class="sd">        .. seealso:: :meth:`setUseArchiving`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">enable</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_archivingWarningThresshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startingTime</span> <span class="o">-</span> \
                <span class="mi">600</span>  <span class="c1"># 10 min before the widget was created</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axisWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">)</span><span class="o">.</span><span class="n">scaleDivChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaleChangeWarning</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">axisWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">)</span><span class="o">.</span><span class="n">scaleDivChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaleChangeWarning</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_archivingWarningThresshold</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useArchiving</span> <span class="o">=</span> <span class="n">enable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">replot</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_scaleChangeWarning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;slot that may be called when the x axis changes the scale&#39;&#39;&#39;</span>
        <span class="n">sdiv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">axisScaleDiv</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">)</span>
        <span class="n">smin</span> <span class="o">=</span> <span class="n">sdiv</span><span class="o">.</span><span class="n">lowerBound</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">smin</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_archivingWarningThresshold</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showArchivingWarning</span><span class="p">()</span>
            <span class="c1"># lower the thresshold by twice the current range</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_archivingWarningThresshold</span> <span class="o">=</span> <span class="n">smin</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sdiv</span><span class="o">.</span><span class="n">range</span><span class="p">()</span>

<div class="viewcode-block" id="TaurusTrend.showArchivingWarning"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.showArchivingWarning">[docs]</a>    <span class="k">def</span> <span class="nf">showArchivingWarning</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;shows a dialog warning of the potential isuues with</span>
<span class="sd">        archiving performance. It offers the user to disable archiving retrieval&#39;&#39;&#39;</span>
        <span class="c1"># stop the scale change notification temporally (to avoid duplicate</span>
        <span class="c1"># warnings)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setUseArchiving</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">axisWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">)</span><span class="o">.</span><span class="n">scaleDivChanged</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaleChangeWarning</span><span class="p">)</span>
        <span class="c1"># show a dialog</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">setModal</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">())</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;Archiving warning&#39;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Archiving retrieval is enabled.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
              <span class="s1">&#39;Rescaling to previous date/times may cause performance loss.</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span>\
              <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Disable archiving retrieval?</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>
        <span class="n">rememberCB</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QCheckBox</span><span class="p">(</span><span class="s1">&#39;Do not ask again&#39;</span><span class="p">)</span>
        <span class="n">buttonbox</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="p">()</span>
        <span class="n">buttonbox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span>
            <span class="s1">&#39;&amp;Keep enabled&#39;</span><span class="p">),</span> <span class="n">buttonbox</span><span class="o">.</span><span class="n">RejectRole</span><span class="p">)</span>
        <span class="n">buttonbox</span><span class="o">.</span><span class="n">addButton</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">(</span><span class="s1">&#39;&amp;Disable&#39;</span><span class="p">),</span> <span class="n">buttonbox</span><span class="o">.</span><span class="n">AcceptRole</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">buttonbox</span><span class="p">)</span>
        <span class="n">buttonbox</span><span class="o">.</span><span class="n">accepted</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">buttonbox</span><span class="o">.</span><span class="n">rejected</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dlg</span><span class="o">.</span><span class="n">reject</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">rememberCB</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="c1"># disable archiving if the user said so</span>
        <span class="k">if</span> <span class="n">dlg</span><span class="o">.</span><span class="n">result</span><span class="p">()</span> <span class="o">==</span> <span class="n">dlg</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUseArchiving</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># restore the scale change notification only if the user chose to keep</span>
        <span class="c1"># archiving AND did not want to disable warnings</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setUseArchiving</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">rememberCB</span><span class="o">.</span><span class="n">isChecked</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">axisWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xBottom</span><span class="p">)</span><span class="o">.</span><span class="n">scaleDivChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_scaleChangeWarning</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.setMaxDataBufferSize"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setMaxDataBufferSize">[docs]</a>    <span class="k">def</span> <span class="nf">setMaxDataBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxSize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;sets the maximum number of events that can be plotted in the trends</span>

<span class="sd">        :param maxSize: (int or None) the maximum limit. If None is passed,</span>
<span class="sd">                        the user is prompted for a value.</span>

<span class="sd">        .. seealso:: :meth:`TaurusTrendSet.setMaxDataBufferSize`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">maxSize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxSize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxDataBufferSize</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># API changed in QInputDialog since Qt4.4</span>
                <span class="n">qgetint</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">qgetint</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInteger</span>
            <span class="n">maxSize</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">qgetint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;New buffer data size&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;Enter the number of points to be kept in memory for each curve&#39;</span><span class="p">,</span>
                                  <span class="n">maxSize</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="n">choiceOnClear</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">ts</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ts</span><span class="o">.</span><span class="n">setMaxDataBufferSize</span><span class="p">(</span><span class="n">maxSize</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">choiceOnClear</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">choiceOnClear</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                            <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Clear buffers?&quot;</span><span class="p">,</span> <span class="s2">&quot;Clear the curves that contain too many points for the selected buffer size?&quot;</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">choiceOnClear</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                        <span class="n">ts</span><span class="o">.</span><span class="n">clearTrends</span><span class="p">(</span><span class="n">replot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">ts</span><span class="o">.</span><span class="n">setMaxDataBufferSize</span><span class="p">(</span><span class="n">maxSize</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_maxDataBufferSize</span> <span class="o">=</span> <span class="n">maxSize</span></div>

<div class="viewcode-block" id="TaurusTrend.getMaxDataBufferSize"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getMaxDataBufferSize">[docs]</a>    <span class="k">def</span> <span class="nf">getMaxDataBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the maximum number of events that can be plotted in the trend</span>

<span class="sd">        :return: (int)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxDataBufferSize</span></div>

<div class="viewcode-block" id="TaurusTrend.resetMaxDataBufferSize"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.resetMaxDataBufferSize">[docs]</a>    <span class="k">def</span> <span class="nf">resetMaxDataBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Same as setMaxDataBufferSize(self.DEFAULT_MAX_BUFFER_SIZE)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setMaxDataBufferSize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DEFAULT_MAX_BUFFER_SIZE</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_canvasContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; see :meth:`TaurusPlot._canvasContextMenu` &#39;&#39;&#39;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">TaurusPlot</span><span class="o">.</span><span class="n">_canvasContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setCurvesTitleAction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_useArchivingAction</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setCurvesTitleAction</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_usePollingBufferAction</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setCurvesTitleAction</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_setForcedReadingPeriodAction</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setCurvesTitleAction</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">_setMaxBufferSizeAction</span><span class="p">)</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setCurvesTitleAction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clearBuffersAction</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">insertAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_setCurvesTitleAction</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">_autoClearOnScanAction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">menu</span>

    <span class="k">def</span> <span class="nf">_axisContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; see :meth:`TaurusPlot._axisContextMenu` &#39;&#39;&#39;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">TaurusPlot</span><span class="o">.</span><span class="n">_axisContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Qwt5</span><span class="o">.</span><span class="n">QwtPlot</span><span class="o">.</span><span class="n">xBottom</span><span class="p">,</span> <span class="n">Qwt5</span><span class="o">.</span><span class="n">QwtPlot</span><span class="o">.</span><span class="n">xTop</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="s1">&#39;Source of X values...&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">onChangeXDataKeyAction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">menu</span>

<div class="viewcode-block" id="TaurusTrend.onChangeXDataKeyAction"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.onChangeXDataKeyAction">[docs]</a>    <span class="k">def</span> <span class="nf">onChangeXDataKeyAction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;[Auto Selection]&#39;</span><span class="p">,</span> <span class="s1">&#39;[Internal Scan Index]&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scanname</span> <span class="o">=</span> <span class="s2">&quot;scan://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__qdoorname</span>
            <span class="n">tset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTrendSet</span><span class="p">(</span><span class="n">scanname</span><span class="p">)</span>
            <span class="n">datadesc</span> <span class="o">=</span> <span class="n">tset</span><span class="o">.</span><span class="n">getDataDesc</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">datadesc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">datadesc</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">stripShape</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># an scalar</span>
                        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dd</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">])</span>

        <span class="n">key</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;X data source selection&#39;</span><span class="p">,</span>
                                          <span class="s1">&#39;Which data is to be used for the abscissas in scans?&#39;</span><span class="p">,</span>
                                          <span class="n">options</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="n">options</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="n">options</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="s1">&#39;__SCAN_TREND_INDEX__&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setScansXDataKey</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">scanname</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.setForcedReadingPeriod"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setForcedReadingPeriod">[docs]</a>    <span class="k">def</span> <span class="nf">setForcedReadingPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tsetnames</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the forced reading period for the trend sets given by tsetnames.</span>

<span class="sd">        :param msec: (int or None) period in milliseconds. If None passed, the user will be</span>
<span class="sd">                     prompted</span>
<span class="sd">        :param tsetnames: (seq&lt;str&gt; or None) names of the curves for which the forced</span>
<span class="sd">                          reading is set. If None passed, this will be set for all</span>
<span class="sd">                          present *and future* curves added to this trend</span>

<span class="sd">        .. seealso: :meth:`TaurusTrendSet.setForcedReadingPeriod`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">msec</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">msec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcedReadingPeriod</span>
            <span class="k">try</span><span class="p">:</span>  <span class="c1"># API changed in QInputDialog since Qt4.4</span>
                <span class="n">qgetint</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInt</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="n">qgetint</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getInteger</span>
            <span class="n">msec</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">qgetint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;New forced reading period&#39;</span><span class="p">,</span>
                               <span class="s1">&#39;Enter the new period for forced reading (in ms).</span><span class="se">\n</span><span class="s1"> Enter &quot;0&quot; for disabling&#39;</span><span class="p">,</span>
                               <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">msec</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">604800000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">msec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">msec</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_forcedReadingPeriod</span> <span class="o">=</span> <span class="n">msec</span>

        <span class="k">if</span> <span class="n">tsetnames</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tsetnames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModel</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">tsetnames</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">setForcedReadingPeriod</span><span class="p">(</span><span class="n">msec</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.getForcedReadingPeriod"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getForcedReadingPeriod">[docs]</a>    <span class="k">def</span> <span class="nf">getForcedReadingPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tsetname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the forced reading period for the given trend (or the general period</span>
<span class="sd">        if None is given)</span>

<span class="sd">        :param tsetname: (str or None) name of the trend set for which the forced</span>
<span class="sd">                          reading should be returned. If None passed, the</span>
<span class="sd">                          default period for all curves is returned</span>

<span class="sd">        .. seealso: :meth:`setForcedReadingPeriod`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">tsetname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_forcedReadingPeriod</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trendSets</span><span class="p">[</span><span class="n">tsetname</span><span class="p">]</span><span class="o">.</span><span class="n">getForcedReadingPeriod</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">curves_lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusTrend.resetForcedReadingPeriod"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.resetForcedReadingPeriod">[docs]</a>    <span class="k">def</span> <span class="nf">resetForcedReadingPeriod</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Equivalent to setForcedReadingPeriod(msec=-1, tsetnames=None)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setForcedReadingPeriod</span><span class="p">(</span><span class="n">msec</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">tsetnames</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusTrend.setScrollStep"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.setScrollStep">[docs]</a>    <span class="k">def</span> <span class="nf">setScrollStep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">scrollStep</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets the scroll step when in Dynamic X mode. This is used to avoid</span>
<span class="sd">        excessive replotting, which may be a problem when plotting a lot of points.</span>

<span class="sd">        :param scrollStep: (float) portion of the current range that will</span>
<span class="sd">                             be added when scrolling.  For example, 0.1 means</span>
<span class="sd">                             that 10% of the current range will be added when</span>
<span class="sd">                             scrolling. A value of 0 means that no extra</span>
<span class="sd">                             space will be added (thus the scroll is not in</span>
<span class="sd">                             &quot;steps&quot;). Large scroll steps mean rough scrolls,</span>
<span class="sd">                             but also less CPU usage.</span>

<span class="sd">        .. seealso:: :meth:`setXDynScale`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_scrollStep</span> <span class="o">=</span> <span class="n">scrollStep</span></div>

<div class="viewcode-block" id="TaurusTrend.getScrollStep"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.getScrollStep">[docs]</a>    <span class="k">def</span> <span class="nf">getScrollStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the value of the scroll step</span>

<span class="sd">        :return: (float)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_scrollStep</span></div>

<div class="viewcode-block" id="TaurusTrend.resetScrollStep"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/plot/_TaurusTrend.html#taurus.qt.qtgui.plot.TaurusTrend.resetScrollStep">[docs]</a>    <span class="k">def</span> <span class="nf">resetScrollStep</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;equivalent to setScrollStep(0.2)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setScrollStep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span></div>

    <span class="n">useArchiving</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtProperty</span><span class="p">(</span>
        <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">getUseArchiving</span><span class="p">,</span> <span class="n">setUseArchiving</span><span class="p">,</span> <span class="n">resetUseArchiving</span><span class="p">)</span>
    <span class="n">usePollingBuffer</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtProperty</span><span class="p">(</span>
        <span class="s2">&quot;bool&quot;</span><span class="p">,</span> <span class="n">getUsePollingBuffer</span><span class="p">,</span> <span class="n">setUsePollingBuffer</span><span class="p">,</span> <span class="n">resetUsePollingBuffer</span><span class="p">)</span>
    <span class="n">maxDataBufferSize</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtProperty</span><span class="p">(</span>
        <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">getMaxDataBufferSize</span><span class="p">,</span> <span class="n">setMaxDataBufferSize</span><span class="p">,</span> <span class="n">resetMaxDataBufferSize</span><span class="p">)</span>
    <span class="n">scrollstep</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtProperty</span><span class="p">(</span>
        <span class="s2">&quot;double&quot;</span><span class="p">,</span> <span class="n">getScrollStep</span><span class="p">,</span> <span class="n">setScrollStep</span><span class="p">,</span> <span class="n">resetScrollStep</span><span class="p">)</span>
    <span class="n">forcedReadingPeriod</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtProperty</span><span class="p">(</span>
        <span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">getForcedReadingPeriod</span><span class="p">,</span> <span class="n">setForcedReadingPeriod</span><span class="p">,</span> <span class="n">resetForcedReadingPeriod</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">test</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">taurus.qt.qtgui.application</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">qt</span><span class="o">.</span><span class="n">qtgui</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">TaurusApplication</span><span class="p">()</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QWidget</span><span class="p">()</span>
    <span class="n">w</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">())</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QSplitter</span><span class="p">()</span>
    <span class="n">w</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">TaurusTrend</span><span class="p">()</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="s1">&#39;asdasdasdasdasd&#39;</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">setSizes</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">w</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="n">setModel</span><span class="p">([</span><span class="s1">&#39;bl97/pc/dummy-01/voltage&#39;</span><span class="p">])</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">taurus.qt.qtgui.application</span>
    <span class="kn">import</span> <span class="nn">taurus.core.util.argparse</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">argparse</span><span class="o">.</span><span class="n">get_taurus_parser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_usage</span><span class="p">(</span><span class="s2">&quot;%prog [options] [&lt;model1&gt; [&lt;model2&gt;] ...]&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;a taurus application for plotting trends&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-x&quot;</span><span class="p">,</span> <span class="s2">&quot;--x-axis-mode&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;x_axis_mode&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;t|e&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;interprete X values as either timestamps (t) or event numbers (e). Accepted values: t|e&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-b&quot;</span><span class="p">,</span> <span class="s2">&quot;--buffer&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;max_buffer_size&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">TaurusTrend</span><span class="o">.</span><span class="n">DEFAULT_MAX_BUFFER_SIZE</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;maximum number of values per curve to be plotted (default = </span><span class="si">%i</span><span class="s2">) (when reached, the oldest values will be discarded)&quot;</span> <span class="o">%</span> <span class="n">TaurusTrend</span><span class="o">.</span><span class="n">DEFAULT_MAX_BUFFER_SIZE</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--config&quot;</span><span class="p">,</span> <span class="s2">&quot;--config-file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use the given config file for initialization&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--export&quot;</span><span class="p">,</span> <span class="s2">&quot;--export-file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;export_file&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use the given file to as output instead of showing the plot&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-r&quot;</span><span class="p">,</span> <span class="s2">&quot;--forced-read&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;forced_read_period&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s2">&quot;MILLISECONDS&quot;</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;force Taurustrend to re-read the attributes every MILLISECONDS ms&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;-a&quot;</span><span class="p">,</span> <span class="s2">&quot;--use-archiving&quot;</span><span class="p">,</span>
                      <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;use_archiving&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--window-name&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;window_name&quot;</span><span class="p">,</span>
                      <span class="n">default</span><span class="o">=</span><span class="s2">&quot;TaurusTrend&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Name of the window&quot;</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">qt</span><span class="o">.</span><span class="n">qtgui</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">TaurusApplication</span><span class="p">(</span><span class="n">cmd_line_parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span>
                                                        <span class="n">app_name</span><span class="o">=</span><span class="s2">&quot;taurustrend&quot;</span><span class="p">,</span>
                                                        <span class="n">app_version</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Release</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_command_line_args</span><span class="p">()</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_command_line_options</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">x_axis_mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">]:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">models</span> <span class="o">=</span> <span class="n">args</span>

    <span class="n">w</span> <span class="o">=</span> <span class="n">TaurusTrend</span><span class="p">()</span>
    <span class="n">w</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">window_name</span><span class="p">)</span>

    <span class="c1"># xistime option</span>
    <span class="n">w</span><span class="o">.</span><span class="n">setXIsTime</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">x_axis_mode</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;t&#39;</span><span class="p">)</span>
    <span class="c1"># max buffer size option</span>
    <span class="n">w</span><span class="o">.</span><span class="n">setMaxDataBufferSize</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">max_buffer_size</span><span class="p">))</span>
    <span class="c1"># configuration file option</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">config_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span><span class="o">.</span><span class="n">loadConfig</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">config_file</span><span class="p">)</span>
    <span class="c1"># set models</span>
    <span class="k">if</span> <span class="n">models</span><span class="p">:</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
    <span class="c1"># export option</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">export_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">curves</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">exportIfAllCurves</span><span class="p">(</span><span class="n">curve</span><span class="p">,</span> <span class="n">trend</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">counters</span><span class="o">=</span><span class="n">curves</span><span class="p">):</span>
            <span class="n">curve</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">curve</span><span class="p">)</span>
            <span class="nb">print</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">: Event received for </span><span class="si">%s</span><span class="s1">  &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="n">curve</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span>
            <span class="k">if</span> <span class="n">curve</span> <span class="ow">in</span> <span class="n">counters</span><span class="p">:</span>
                <span class="n">counters</span><span class="p">[</span><span class="n">curve</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">counters</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
                    <span class="n">trend</span><span class="o">.</span><span class="n">exportPdf</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">export_file</span><span class="p">)</span>
                    <span class="nb">print</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">+</span> <span class="s1">&#39; </span><span class="si">%s</span><span class="s1">: Exported to : </span><span class="si">%s</span><span class="s1">  &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span> <span class="n">options</span><span class="o">.</span><span class="n">export_file</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">10</span>
                    <span class="n">trend</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">curves</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">w</span><span class="o">.</span><span class="n">trendSets</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">ts</span><span class="o">.</span><span class="n">dataChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">exportIfAllCurves</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>  <span class="c1"># exit without showing the widget</span>

    <span class="c1"># period option</span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">forced_read_period</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setForcedReadingPeriod</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">forced_read_period</span><span class="p">)</span>

    <span class="c1"># archiving option</span>
    <span class="n">w</span><span class="o">.</span><span class="n">setUseArchiving</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">use_archiving</span><span class="p">)</span>

    <span class="c1"># show the widget</span>
    <span class="n">w</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># if no models are passed, show the data import dialog</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">options</span><span class="o">.</span><span class="n">config_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">w</span><span class="o">.</span><span class="n">showDataImportDlg</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'4.1.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>