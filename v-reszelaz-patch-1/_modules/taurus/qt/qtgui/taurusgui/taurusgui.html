

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>taurus.qt.qtgui.taurusgui.taurusgui &mdash; taurus 4.1.2-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="taurus 4.1.2-alpha documentation" href="../../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../../index.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> taurus
          

          
            
            <img src="../../../../../_static/taurus.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference external" href="http://www.taurus-scada.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/taurus-org/taurus">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/taurus">Download from PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../docs.html">Taurus 4.1 documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../index.html">taurus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
      
    <li>taurus.qt.qtgui.taurusgui.taurusgui</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for taurus.qt.qtgui.taurusgui.taurusgui</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1">#############################################################################</span>
<span class="c1">##</span>
<span class="c1"># This file is part of Taurus</span>
<span class="c1">##</span>
<span class="c1"># http://taurus-scada.org</span>
<span class="c1">##</span>
<span class="c1"># Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c1">##</span>
<span class="c1"># Taurus is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1"># Taurus is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with Taurus.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">##</span>
<span class="c1">###########################################################################</span>

<span class="sd">&quot;&quot;&quot;This package provides the TaurusGui class&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DockWidgetPanel&quot;</span><span class="p">,</span> <span class="s2">&quot;TaurusGui&quot;</span><span class="p">]</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;restructuredtext&#39;</span>


<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">inspect</span>

<span class="kn">from</span> <span class="nn">lxml</span> <span class="k">import</span> <span class="n">etree</span>

<span class="kn">import</span> <span class="nn">taurus</span>
<span class="kn">from</span> <span class="nn">taurus</span> <span class="k">import</span> <span class="n">tauruscustomsettings</span>
<span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="k">import</span> <span class="n">Qt</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtcore.configuration</span> <span class="k">import</span> <span class="n">BaseConfigurableClass</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtcore.communication</span> <span class="k">import</span> <span class="n">SharedDataManager</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.util</span> <span class="k">import</span> <span class="n">TaurusWidgetFactory</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.base</span> <span class="k">import</span> <span class="n">TaurusBaseWidget</span><span class="p">,</span> <span class="n">TaurusBaseComponent</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.container</span> <span class="k">import</span> <span class="n">TaurusMainWindow</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.taurusgui.utils</span> <span class="k">import</span> <span class="p">(</span><span class="n">ExternalApp</span><span class="p">,</span> <span class="n">PanelDescription</span><span class="p">,</span>
                                             <span class="n">ToolBarDescription</span><span class="p">,</span>
                                             <span class="n">AppletDescription</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.taurusgui.appsettingswizard</span> <span class="k">import</span> <span class="n">ExternalAppEditor</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.panel</span> <span class="k">import</span> <span class="n">QDoubleListDlg</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.util.ui</span> <span class="k">import</span> <span class="n">UILoadable</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.taurusgui.utils</span> <span class="k">import</span> <span class="n">ExternalAppAction</span>


<span class="nd">@UILoadable</span><span class="p">(</span><span class="n">with_ui</span><span class="o">=</span><span class="s1">&#39;ui&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">AssociationDialog</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A dialog for viewing and editing the associations between instruments</span>
<span class="sd">    and panels&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">flags</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">flags</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">Widget</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadUi</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">activated</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onInstrumentChanged</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onDialogButtonClicked</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">refreshBT</span><span class="o">.</span><span class="n">clicked</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">currentinstrument</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">currentText</span><span class="p">()</span>
        <span class="n">mainwindow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">associations</span> <span class="o">=</span> <span class="n">mainwindow</span><span class="o">.</span><span class="n">getAllInstrumentAssociations</span><span class="p">()</span>

        <span class="c1"># fill the comboboxes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">panelCB</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">addItems</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">associations</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">panelCB</span><span class="o">.</span><span class="n">addItems</span><span class="p">([</span><span class="s1">&#39;__[None]__&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">mainwindow</span><span class="o">.</span><span class="n">getPanelNames</span><span class="p">())</span>

        <span class="c1"># restore the index</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">currentinstrument</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">onInstrumentChanged</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">onInstrumentChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrumentname</span><span class="p">):</span>
        <span class="n">instrumentname</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">)</span>
        <span class="n">panelname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">associations</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">panelname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">panelCB</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">panelCB</span><span class="o">.</span><span class="n">findText</span><span class="p">(</span><span class="n">panelname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">panelCB</span><span class="o">.</span><span class="n">setCurrentIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onDialogButtonClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">button</span><span class="p">):</span>
        <span class="n">role</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">buttonBox</span><span class="o">.</span><span class="n">buttonRole</span><span class="p">(</span><span class="n">button</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">role</span> <span class="ow">in</span> <span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">AcceptRole</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDialogButtonBox</span><span class="o">.</span><span class="n">ApplyRole</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">panelCB</span><span class="o">.</span><span class="n">currentIndex</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">panelname</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">panelCB</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">panelname</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">instrumentname</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="o">.</span><span class="n">currentText</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">associations</span><span class="p">[</span><span class="n">instrumentname</span><span class="p">]</span> <span class="o">=</span> <span class="n">panelname</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span><span class="o">.</span><span class="n">setInstrumentAssociation</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">,</span> <span class="n">panelname</span><span class="p">)</span>


<div class="viewcode-block" id="DockWidgetPanel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel">[docs]</a><span class="k">class</span> <span class="nc">DockWidgetPanel</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDockWidget</span><span class="p">,</span> <span class="n">TaurusBaseWidget</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is an extended QDockWidget which provides some methods for being used</span>
<span class="sd">    as a &quot;panel&quot; of a TaurusGui application. Widgets of TaurusGui are inserted</span>
<span class="sd">    in the application by adding them to a DockWidgetPanel.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">mainwindow</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QDockWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setAllowedAreas</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">TopDockWidgetArea</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>
        <span class="c1"># self._widget = self.widget()  #keep a pointer that may change if the</span>
        <span class="c1"># widget changes</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># store a weakref of the main window</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_mainwindow</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">proxy</span><span class="p">(</span><span class="n">mainwindow</span><span class="p">)</span>

<div class="viewcode-block" id="DockWidgetPanel.isCustom"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.isCustom">[docs]</a>    <span class="k">def</span> <span class="nf">isCustom</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_custom</span></div>

<div class="viewcode-block" id="DockWidgetPanel.setCustom"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.setCustom">[docs]</a>    <span class="k">def</span> <span class="nf">setCustom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">custom</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_custom</span> <span class="o">=</span> <span class="n">custom</span></div>

<div class="viewcode-block" id="DockWidgetPanel.isPermanent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.isPermanent">[docs]</a>    <span class="k">def</span> <span class="nf">isPermanent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_permanent</span></div>

<div class="viewcode-block" id="DockWidgetPanel.setPermanent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.setPermanent">[docs]</a>    <span class="k">def</span> <span class="nf">setPermanent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permanent</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_permanent</span> <span class="o">=</span> <span class="n">permanent</span></div>

<div class="viewcode-block" id="DockWidgetPanel.setWidgetFromClassName"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.setWidgetFromClassName">[docs]</a>    <span class="k">def</span> <span class="nf">setWidgetFromClassName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classname</span><span class="p">,</span> <span class="n">modulename</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getWidgetClassName</span><span class="p">()</span> <span class="o">!=</span> <span class="n">classname</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">klass</span> <span class="o">=</span> <span class="n">TaurusWidgetFactory</span><span class="p">()</span><span class="o">.</span><span class="n">getWidgetClass</span><span class="p">(</span><span class="n">classname</span><span class="p">)</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">classname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">classname</span><span class="p">:</span>
                        <span class="n">mn</span><span class="p">,</span> <span class="n">classname</span> <span class="o">=</span> <span class="n">classname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="n">modulename</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span>
                                      <span class="p">(</span><span class="n">modulename</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">mn</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s1">&#39;. &#39;</span><span class="p">)</span>
                    <span class="n">module</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">modulename</span><span class="p">,</span> <span class="n">fromlist</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
                    <span class="n">klass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">module</span><span class="p">,</span> <span class="n">classname</span><span class="p">)</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="n">klass</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                        <span class="s1">&#39;Cannot create widget from classname &quot;</span><span class="si">%s</span><span class="s1">&quot;. Reason: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">classname</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="c1"># set customwidgetmap if necessary</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;setCustomWidgetMap&#39;</span><span class="p">):</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setCustomWidgetMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_mainwindow</span><span class="o">.</span><span class="n">getCustomWidgetMap</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">wname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">-</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">objectName</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="n">classname</span><span class="p">))</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span></div>

<div class="viewcode-block" id="DockWidgetPanel.getWidgetModuleName"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.getWidgetModuleName">[docs]</a>    <span class="k">def</span> <span class="nf">getWidgetModuleName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="vm">__module__</span></div>

<div class="viewcode-block" id="DockWidgetPanel.getWidgetClassName"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.getWidgetClassName">[docs]</a>    <span class="k">def</span> <span class="nf">getWidgetClassName</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">&#39;&#39;</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span></div>

<div class="viewcode-block" id="DockWidgetPanel.applyConfig"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.applyConfig">[docs]</a>    <span class="k">def</span> <span class="nf">applyConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configdict</span><span class="p">,</span> <span class="n">depth</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># create the widget</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setWidgetFromClassName</span><span class="p">(</span><span class="n">configdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s1">&#39;widgetClassName&#39;</span><span class="p">),</span> <span class="n">modulename</span><span class="o">=</span><span class="n">configdict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;widgetModuleName&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(),</span> <span class="n">BaseConfigurableClass</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">applyConfig</span><span class="p">(</span><span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;widget&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Failed to set the widget for this panel. Reason: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Debug</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">applyConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configdict</span><span class="p">,</span> <span class="n">depth</span><span class="p">)</span></div>

<div class="viewcode-block" id="DockWidgetPanel.createConfig"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.createConfig">[docs]</a>    <span class="k">def</span> <span class="nf">createConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">configdict</span> <span class="o">=</span> <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">createConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;widgetClassName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getWidgetClassName</span><span class="p">()</span>
        <span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;widgetModuleName&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getWidgetModuleName</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">(),</span> <span class="n">BaseConfigurableClass</span><span class="p">):</span>
            <span class="n">configdict</span><span class="p">[</span><span class="s1">&#39;widget&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">createConfig</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">configdict</span></div>

<div class="viewcode-block" id="DockWidgetPanel.closeEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_DockWidgetPanel.html#taurus.qt.qtgui.taurusgui.DockWidgetPanel.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QDockWidget</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="TaurusGui"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui">[docs]</a><span class="k">class</span> <span class="nc">TaurusGui</span><span class="p">(</span><span class="n">TaurusMainWindow</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This is main class for constructing the dynamic GUIs. TaurusGui is a</span>
<span class="sd">    specialised TaurusMainWindow which is able to handle &quot;panels&quot; and load</span>
<span class="sd">    configuration files.</span>
<span class="sd">    There are several ways of using TaurusGui. In the following we will give</span>
<span class="sd">    3 examples on how to create a simple GUI called &quot;MyGui&quot; which contains one</span>
<span class="sd">    panel called &quot;Foo&quot; and consisting of a `QWidget`:</span>

<span class="sd">    **Example 1: use declarative configuration files.**</span>

<span class="sd">    You can create a purely declarative configuration file to be interpreted by</span>
<span class="sd">    the standard `taurusgui` script::</span>

<span class="sd">        from taurus.qt.qtgui.taurusgui.utils import PanelDescription</span>

<span class="sd">        GUI_NAME = &#39;MyGui&#39;</span>
<span class="sd">        panel = PanelDescription(&#39;Foo&#39;,</span>
<span class="sd">                                 classname=&#39;taurus.external.qt.Qt.QWidget&#39;)</span>

<span class="sd">    Note that this just a very simple example. For a much richer one, see the</span>
<span class="sd">    :mod:`taurus.qt.qtgui.taurusgui.conf.tgconf_example01`</span>

<span class="sd">    **Example 2: do everything programmatically.**</span>

<span class="sd">    A stand-alone python script that launches the gui when executed. No</span>
<span class="sd">    configuration file is used here. Panels and other components are added</span>
<span class="sd">    programatically::</span>

<span class="sd">        if __name__ == &#39;__main__&#39;:</span>
<span class="sd">            from taurus.qt.qtgui.application import TaurusApplication</span>
<span class="sd">            from taurus.qt.qtgui.taurusgui import TaurusGui</span>
<span class="sd">            from taurus.external.qt import Qt</span>
<span class="sd">            app = TaurusApplication(app_name=&#39;MyGui&#39;)</span>
<span class="sd">            gui = TaurusGui()</span>
<span class="sd">            panel = Qt.QWidget()</span>
<span class="sd">            gui.createPanel(panel, &#39;Foo&#39;)</span>
<span class="sd">            gui.show()</span>
<span class="sd">            app.exec_()</span>


<span class="sd">    **Example 3: mixing declarative and programmatic ways**</span>

<span class="sd">    It is also possible to create a stand-alone python script which loads itself</span>
<span class="sd">    as a configuration file. In this way you can add things programmatically and</span>
<span class="sd">    at the same time use the declarative way::</span>

<span class="sd">        GUI_NAME = &#39;MyGui&#39; # &lt;-- declarative!</span>
<span class="sd">        if __name__ == &#39;__main__&#39;:</span>
<span class="sd">            from taurus.qt.qtgui.application import TaurusApplication</span>
<span class="sd">            from taurus.qt.qtgui.taurusgui import TaurusGui</span>
<span class="sd">            from taurus.external.qt import Qt</span>
<span class="sd">            app = TaurusApplication()</span>
<span class="sd">            gui = TaurusGui(confname=__file__)</span>
<span class="sd">            panel = Qt.QWidget()</span>
<span class="sd">            gui.createPanel(panel, &#39;Foo&#39;)  # &lt;-- programmatic!</span>
<span class="sd">            gui.show()</span>
<span class="sd">            app.exec_()</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">SelectedInstrument</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">doorNameChanged</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">macroserverNameChanged</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="n">newShortMessage</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtSignal</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>

    <span class="n">IMPLICIT_ASSOCIATION</span> <span class="o">=</span> <span class="s1">&#39;__[IMPLICIT]__&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">confname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">configRecursionDepth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">TaurusMainWindow</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">configRecursionDepth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">defaultConfigRecursionDepth</span> <span class="o">=</span> <span class="n">configRecursionDepth</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__external_app_actions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_external_app_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__permanent_ext_apps</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__synoptics</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelToInstrumentMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDockNestingEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigProperty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_getPermanentExternalApps</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">_setPermanentExternalApps</span><span class="p">,</span>
                                    <span class="s1">&#39;permanentexternalapps&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigProperty</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_getPermanentCustomPanels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_setPermanentCustomPanels</span><span class="p">,</span> <span class="s1">&#39;permanentCustomPanels&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigProperty</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getAllInstrumentAssociations</span><span class="p">,</span>
                                    <span class="bp">self</span><span class="o">.</span><span class="n">setAllInstrumentAssociations</span><span class="p">,</span> <span class="s1">&#39;instrumentAssociation&#39;</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">taurus</span> <span class="k">import</span> <span class="n">tauruscustomsettings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setCustomWidgetMap</span><span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">tauruscustomsettings</span><span class="p">,</span> <span class="s1">&#39;T_FORM_CUSTOM_WIDGET_MAP&#39;</span><span class="p">,</span> <span class="p">{}))</span>

        <span class="c1"># Create a global SharedDataManager</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span> <span class="o">=</span> <span class="n">SharedDataManager</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__initPanelsMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initQuickAccessToolBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initJorgBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initSharedDataConnections</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initToolsMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initViewMenu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__initPanelsToolBar</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">loadConfiguration</span><span class="p">(</span><span class="n">confname</span><span class="p">)</span>

        <span class="c1"># connect the main window itself as a reader/writer of &quot;short messages&quot;</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectReader</span><span class="p">(</span><span class="s2">&quot;shortMessage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onShortMessage</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectWriter</span><span class="p">(</span><span class="s2">&quot;shortMessage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;newShortMessage&#39;</span><span class="p">)</span>

        <span class="c1"># emit a short message informing that we are ready to go</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> is ready&#39;</span> <span class="o">%</span> <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">applicationName</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newShortMessage</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultConfigRecursionDepth</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Fail-proof mode&quot;</span><span class="p">,</span>
                                       <span class="p">(</span><span class="s1">&#39;Running in fail-proof mode.&#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Loading of potentially problematic settings is disabled.&#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Some panels may not be loaded or may ignore previous user configuration&#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">This will also apply when loading perspectives&#39;</span><span class="p">),</span>
                                       <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">NoButton</span><span class="p">)</span>

<div class="viewcode-block" id="TaurusGui.closeEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.closeEvent">[docs]</a>    <span class="k">def</span> <span class="nf">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__macroBroker</span><span class="o">.</span><span class="n">removeTemporaryPanels</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">TaurusMainWindow</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">closeEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">isAccepted</span><span class="p">():</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">question</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Closing error&#39;</span><span class="p">,</span>
                    <span class="s2">&quot;Panel &#39;</span><span class="si">%s</span><span class="s2">&#39; cannot be closed. Proceed closing?&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">,</span>
                    <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">No</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Yes</span><span class="p">:</span>
                    <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">break</span></div>

    <span class="k">def</span> <span class="nf">__updatePanelsMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;dynamically fill the panels menus&#39;&#39;&#39;</span>
        <span class="n">panelsmenu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span>
        <span class="n">permanent</span> <span class="o">=</span> <span class="p">(</span><span class="n">panelsmenu</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__permPanelsMenu</span><span class="p">)</span>
        <span class="n">panelsmenu</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">panelnames</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
            <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">isPermanent</span><span class="p">()</span> <span class="o">==</span> <span class="n">permanent</span><span class="p">)])</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">panelnames</span><span class="p">:</span>
            <span class="n">panelsmenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__initPanelsMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Panels menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="s1">&#39;Panels&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menuBar</span><span class="p">()</span><span class="o">.</span><span class="n">insertMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">helpMenu</span><span class="o">.</span><span class="n">menuAction</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hideAllPanelsAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s1">&#39;actions:hide.svg&#39;</span><span class="p">),</span> <span class="s2">&quot;Hide all panels&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">hideAllPanels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">showAllPanelsAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s1">&#39;actions:show.svg&#39;</span><span class="p">),</span> <span class="s2">&quot;Show all panels&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAllPanels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newPanelAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;window-new&quot;</span><span class="p">),</span> <span class="s2">&quot;New Panel...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createCustomPanel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removePanelAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;edit-clear&quot;</span><span class="p">),</span> <span class="s2">&quot;Remove Panel...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removePanel</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span>
            <span class="s2">&quot;preferences-desktop-personal&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Switch temporary/permanent status...&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">updatePermanentCustomPanels</span><span class="p">)</span>
        <span class="c1"># temporary and permanent panels submenus</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__permPanelsMenu</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="s1">&#39;Permanent Panels&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__permPanelsMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__permPanelsMenu</span><span class="o">.</span><span class="n">aboutToShow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__updatePanelsMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tempPanelsMenu</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="s1">&#39;Temporary Panels&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__tempPanelsMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__tempPanelsMenu</span><span class="o">.</span><span class="n">aboutToShow</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__updatePanelsMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelsMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__initViewMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># the superclass may already have added stuff to the viewMenu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="c1"># view locking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lockviewAction</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span>
            <span class="s2">&quot;system-lock-screen&quot;</span><span class="p">),</span> <span class="s2">&quot;Lock View&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lockviewAction</span><span class="o">.</span><span class="n">setCheckable</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lockviewAction</span><span class="o">.</span><span class="n">toggled</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">setLockView</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lockviewAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isModifiableByUser</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_lockviewAction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__initPanelsToolBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Panels toolbar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panelsToolBar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="s2">&quot;Panels&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panelsToolBar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;PanelsToolbar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">panelsToolBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newPanelAction</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewToolBarsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">panelsToolBar</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__initQuickAccessToolBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quickAccessToolBar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="s2">&quot;Quick Access&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quickAccessToolBar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s2">&quot;quickAccessToolbar&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quickAccessToolBar</span><span class="o">.</span><span class="n">setToolButtonStyle</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">ToolButtonTextBesideIcon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewToolBarsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">quickAccessToolBar</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__initJorgBar</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Fancy Stuff ToolBar (aka Jorg&#39;s Bar ;) )</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QToolBar</span><span class="p">(</span><span class="s1">&#39;Fancy ToolBar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="s1">&#39;jorgsToolBar&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">RightToolBarArea</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span><span class="o">.</span><span class="n">setIconSize</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QSize</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span><span class="o">.</span><span class="n">setMovable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__initSharedDataConnections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># register the TAURUSGUI itself as a writer/reader for several shared</span>
        <span class="c1"># data items</span>
        <span class="n">splashScreen</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">splashScreen</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">splashScreen</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splashScreen</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;setting up shared data connections&quot;</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectWriter</span><span class="p">(</span>
            <span class="s2">&quot;macroserverName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;macroserverNameChanged&#39;</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectWriter</span><span class="p">(</span><span class="s2">&quot;doorName&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;doorNameChanged&#39;</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectReader</span><span class="p">(</span>
            <span class="s2">&quot;SelectedInstrument&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onSelectedInstrument</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectWriter</span><span class="p">(</span>
            <span class="s2">&quot;SelectedInstrument&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;SelectedInstrument&#39;</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectReader</span><span class="p">(</span><span class="s2">&quot;executionStarted&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">setFocusToPanel</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectReader</span><span class="p">(</span><span class="s2">&quot;selectedPerspective&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadPerspective</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectWriter</span><span class="p">(</span>
            <span class="s2">&quot;perspectiveChanged&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;perspectiveChanged&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__initToolsMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolsMenu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">toolsMenu</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="s2">&quot;Tools&quot;</span><span class="p">)</span>
        <span class="n">tm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolsMenu</span>
        <span class="n">tm</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;apps:preferences-system-session.svg&quot;</span><span class="p">),</span>
                     <span class="s2">&quot;manage instrument-panel associations&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">onShowAssociationDialog</span><span class="p">)</span>
        <span class="n">tm</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s2">&quot;document-save&quot;</span><span class="p">),</span>
                     <span class="s2">&quot;Export current Panel configuration to XML&quot;</span><span class="p">,</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">onExportCurrentPanelConfiguration</span><span class="p">)</span>
        <span class="n">tm</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;actions:data-transfer.svg&quot;</span><span class="p">),</span>
                     <span class="s2">&quot;Show Shared Data Manager connections&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showSDMInfo</span><span class="p">)</span>

        <span class="c1"># tools-&gt;external apps submenu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addExternalApplicationAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalAppsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s1">&#39;list-add&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Add external application launcher...&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createExternalApp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeExternalApplicationAction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">externalAppsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s1">&#39;list-remove&#39;</span><span class="p">),</span>
            <span class="s1">&#39;Remove external appication launcher...&#39;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeExternalApp</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">externalAppsMenu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>

<div class="viewcode-block" id="TaurusGui.createExternalApp"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.createExternalApp">[docs]</a>    <span class="k">def</span> <span class="nf">createExternalApp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Add a new external application on execution time&#39;&#39;&#39;</span>
        <span class="n">app_editor</span> <span class="o">=</span> <span class="n">ExternalAppEditor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">xml</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">app_editor</span><span class="o">.</span><span class="n">getDialog</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_app_names</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;The &quot;</span><span class="si">%s</span><span class="s1">&quot; external application exists in your GUI.&#39;</span>
                   <span class="s1">&#39; If you want to create a new one, &#39;</span>
                   <span class="s1">&#39;please use other text label&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">taurus</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">ok</span><span class="p">:</span>
            <span class="n">extapp</span> <span class="o">=</span> <span class="n">ExternalApp</span><span class="o">.</span><span class="n">fromXml</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">extapp</span><span class="o">.</span><span class="n">getAction</span><span class="p">()</span>
            <span class="n">action_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">extapp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_addExternalAppLauncher</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_addExternalAppLauncher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
        <span class="n">action_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">text</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__external_app_actions</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">action</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addExternalAppLauncher</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_external_app_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="TaurusGui.removeExternalApp"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.removeExternalApp">[docs]</a>    <span class="k">def</span> <span class="nf">removeExternalApp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Remove the given external application from the GUI.</span>

<span class="sd">        :param name: (str or None) the name of the external application to be</span>
<span class="sd">                     removed</span>
<span class="sd">                     If None given, the user will be prompted</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">apps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">__permanent_ext_apps</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">apps</span><span class="p">)</span>
            <span class="n">msg1</span> <span class="o">=</span> <span class="s2">&quot;Remove External application&quot;</span>
            <span class="n">msg2</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;External application to be removed &quot;</span>
                    <span class="s2">&quot;(only custom external applications can be removed).&quot;</span><span class="p">)</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg1</span><span class="p">,</span> <span class="n">msg2</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
                                               <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">apps</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Cannot remove the external application &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span>
                   <span class="s1">&#39; (not found)&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__permanent_ext_apps</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__external_app_actions</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_external_app_names</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleteExternalAppLauncher</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;External application &quot;</span><span class="si">%s</span><span class="s1">&quot; removed&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.setCustomWidgetMap"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.setCustomWidgetMap">[docs]</a>    <span class="k">def</span> <span class="nf">setCustomWidgetMap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets the widget map that is used application-wide. This widget map will</span>
<span class="sd">        be used by default in all TaurusForm Panels belonging to this gui.</span>

<span class="sd">        :param map: (dict&lt;str,Qt.QWidget&gt;) a dictionary whose keys are device</span>
<span class="sd">                    type strings (e.g. see :class:`PyTango.DeviceInfo`) and</span>
<span class="sd">                    whose values are widgets to be used</span>

<span class="sd">        .. seealso:: :meth:`TaurusForm.setCustomWidgetMap`, :meth:`getCustomWidgetMap`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_customWidgetMap</span> <span class="o">=</span> <span class="nb">map</span></div>

<div class="viewcode-block" id="TaurusGui.getCustomWidgetMap"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.getCustomWidgetMap">[docs]</a>    <span class="k">def</span> <span class="nf">getCustomWidgetMap</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the default map used to create custom widgets by the TaurusForms</span>
<span class="sd">        belonging to this GUI</span>

<span class="sd">        :return: (dict&lt;str,Qt.QWidget&gt;) a dictionary whose keys are device</span>
<span class="sd">                 type strings (i.e. see :class:`PyTango.DeviceInfo`) and whose</span>
<span class="sd">                 values are widgets to be used</span>

<span class="sd">        .. seealso:: :meth:`setCustomWidgetMap`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_customWidgetMap</span></div>

<div class="viewcode-block" id="TaurusGui.createConfig"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.createConfig">[docs]</a>    <span class="k">def</span> <span class="nf">createConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented from TaurusMainWindow.createConfig&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePermanentCustomPanels</span><span class="p">(</span><span class="n">showAlways</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">updatePermanentExternalApplications</span><span class="p">(</span><span class="n">showAlways</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cfg</span> <span class="o">=</span> <span class="n">TaurusMainWindow</span><span class="o">.</span><span class="n">createConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cfg</span></div>

<div class="viewcode-block" id="TaurusGui.removePanel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.removePanel">[docs]</a>    <span class="k">def</span> <span class="nf">removePanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; remove the given panel from the GUI.</span>

<span class="sd">        .. note:: The panel; is actually removed from the current perspective.</span>
<span class="sd">                  If the panel is saved in other perspectives, it should be removed from</span>
<span class="sd">                  them as well.</span>

<span class="sd">        :param name: (str or None) the name of the panel to be removed</span>
<span class="sd">                     If None given, the user will be prompted</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">items</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
                <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">isCustom</span><span class="p">()])</span>
            <span class="n">name</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Remove Panel&quot;</span><span class="p">,</span>
                                               <span class="s2">&quot;Panel to be removed (only custom panels can be removed).</span><span class="se">\n</span><span class="s2"> Important: you may want to save the perspective afterwards,</span><span class="se">\n</span><span class="s2"> and maybe remove the panel from other perspectives as well&quot;</span><span class="p">,</span> <span class="n">items</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Cannot remove panel &quot;</span><span class="si">%s</span><span class="s1">&quot; (not found)&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># in case the widget is a Taurus one and does some cleaning when</span>
            <span class="c1"># setting model to None</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">widget</span><span class="p">()</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">unregisterConfigurableItem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">raiseOnError</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removeDockWidget</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">setParent</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_DeleteOnClose</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Panel &quot;</span><span class="si">%s</span><span class="s1">&quot; removed&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.createPanel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.createPanel">[docs]</a>    <span class="k">def</span> <span class="nf">createPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">floating</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">registerconfig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">custom</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">permanent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">instrumentkey</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a panel containing the given widget.</span>

<span class="sd">        :param wiget: (QWidget) the widget to be contained in the panel</span>
<span class="sd">        :param name: (str) the name of the panel. It will be used in tabs as well as for configuration</span>
<span class="sd">        :param floating: (bool) whether the panel should be docked or floating. (see note below)</span>
<span class="sd">        :param registerconfig: (bool) if True, the panel will be registered as a delegate for configuration</span>
<span class="sd">        :param custom: (bool) if True the panel is to be considered a &quot;custom panel&quot;</span>
<span class="sd">        :param permanent: (bool) set this to True for panels that need to be recreated when restoring the app</span>
<span class="sd">        :param icon: (QIcon) icon for the panel</span>
<span class="sd">        :param instrumentkey: (str) name of an instrument to which this panel is to be associated</span>

<span class="sd">        :return: (DockWidgetPanel) the created panel</span>

<span class="sd">        .. note:: On a previous version, there was a mandatory parameter called</span>
<span class="sd">                  `area` (which accepted a Qt.DockWidgetArea or None as values)</span>
<span class="sd">                  this parameter has now been substituted by the keyword</span>
<span class="sd">                  argument `floating`. In order to provide backwards</span>
<span class="sd">                  compatibility, the &quot;floating&quot; keyword argument stays at the</span>
<span class="sd">                  same position as the old `area` argument and if a Qt.DockWidgetArea</span>
<span class="sd">                  value is given, it will be interpreted as floating=True (while if</span>
<span class="sd">                  `None` is passed, it will be interpreted as floating=False.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># backwards compatibility:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">floating</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s1">&#39;Deprecation warning: please note that the &quot;area&quot; argument is deprecated. See TaurusGui.createPanel doc&#39;</span><span class="p">)</span>
            <span class="n">floating</span> <span class="o">=</span> <span class="ow">not</span><span class="p">(</span><span class="n">floating</span><span class="p">)</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Panel with name &quot;</span><span class="si">%s</span><span class="s1">&quot; already exists. Reusing.&#39;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>

        <span class="c1"># create a panel</span>
        <span class="n">panel</span> <span class="o">=</span> <span class="n">DockWidgetPanel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">widget</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="c1"># we will only place panels in this area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">addDockWidget</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">TopDockWidgetArea</span><span class="p">,</span> <span class="n">panel</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabifyDockWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">values</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">panel</span><span class="p">)</span>

        <span class="n">panel</span><span class="o">.</span><span class="n">setFloating</span><span class="p">(</span><span class="n">floating</span><span class="p">)</span>

        <span class="c1"># associate this panel with an instrument</span>
        <span class="k">if</span> <span class="n">instrumentkey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">instrumentkey</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMPLICIT_ASSOCIATION</span><span class="p">:</span>
                <span class="c1"># see if there is an item whose name is the same as that of the</span>
                <span class="c1"># panel</span>
                <span class="k">for</span> <span class="n">syn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__synoptics</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">syn</span><span class="o">.</span><span class="n">get_item_list</span><span class="p">():</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">setInstrumentAssociation</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                        <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setInstrumentAssociation</span><span class="p">(</span><span class="n">instrumentkey</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">icon</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">()</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="n">icon</span><span class="p">)</span>

        <span class="c1"># set flags</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">setCustom</span><span class="p">(</span><span class="n">custom</span><span class="p">)</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">setPermanent</span><span class="p">(</span><span class="n">permanent</span><span class="p">)</span>

        <span class="c1"># register the panel for configuration</span>
        <span class="k">if</span> <span class="n">registerconfig</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigDelegate</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">panel</span>

        <span class="c1"># connect the panel visibility changes</span>
        <span class="n">panel</span><span class="o">.</span><span class="n">visibilityChanged</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_onPanelVisibilityChanged</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">panel</span></div>

<div class="viewcode-block" id="TaurusGui.getPanel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.getPanel">[docs]</a>    <span class="k">def</span> <span class="nf">getPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;get a panel object by name</span>

<span class="sd">        :return: (DockWidgetPanel)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">unicode</span><span class="p">(</span><span class="n">name</span><span class="p">)]</span></div>

<div class="viewcode-block" id="TaurusGui.getPanelNames"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.getPanelNames">[docs]</a>    <span class="k">def</span> <span class="nf">getPanelNames</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the names of existing panels</span>

<span class="sd">        :return: (list&lt;str&gt;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span></div>

    <span class="k">def</span> <span class="nf">_setPermanentExternalApps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permExternalApps</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;creates empty panels for restoring custom panels.</span>

<span class="sd">        :param permCustomPanels: (list&lt;str&gt;) list of names of custom panels</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># first create the panels if they don&#39;t actually exist</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">permExternalApps</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_external_app_names</span><span class="p">:</span>
                <span class="c1"># create empty action</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__permanent_ext_apps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="n">action</span> <span class="o">=</span> <span class="n">ExternalAppAction</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_addExternalAppLauncher</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">action</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getPermanentExternalApps</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__permanent_ext_apps</span>

    <span class="k">def</span> <span class="nf">_setPermanentCustomPanels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">permCustomPanels</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;creates empty panels for restoring custom panels.</span>

<span class="sd">        :param permCustomPanels: (list&lt;str&gt;) list of names of custom panels</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># first create the panels if they don&#39;t actually exist</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">permCustomPanels</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createPanel</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">custom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">permanent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_getPermanentCustomPanels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        returns a list of panel names for which the custom and permanent flags</span>
<span class="sd">        are True (i.e., those custom panels that should be stored in</span>
<span class="sd">        configuration and/or perspectives)</span>

<span class="sd">        :return: (list&lt;str&gt;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">isCustom</span><span class="p">()</span> <span class="ow">and</span> <span class="n">p</span><span class="o">.</span><span class="n">isPermanent</span><span class="p">())]</span>

<div class="viewcode-block" id="TaurusGui.updatePermanentCustomPanels"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.updatePermanentCustomPanels">[docs]</a>    <span class="k">def</span> <span class="nf">updatePermanentCustomPanels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showAlways</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Shows a dialog for selecting which custom panels should be permanently</span>
<span class="sd">        stored in the configuration.</span>

<span class="sd">        :param showAlways: (bool) forces showing the dialog even if there are no new custom Panels</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># check if there are some newly created panels that may be made</span>
        <span class="c1"># permanent</span>
        <span class="n">perm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_getPermanentCustomPanels</span><span class="p">()</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span>
            <span class="n">p</span><span class="o">.</span><span class="n">isCustom</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">p</span><span class="o">.</span><span class="n">isPermanent</span><span class="p">())]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">showAlways</span><span class="p">:</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">QDoubleListDlg</span><span class="p">(</span><span class="n">winTitle</span><span class="o">=</span><span class="s1">&#39;Stored panels&#39;</span><span class="p">,</span>
                                 <span class="n">mainLabel</span><span class="o">=</span><span class="s1">&#39;Select which of the panels should be stored&#39;</span><span class="p">,</span>
                                 <span class="n">label1</span><span class="o">=</span><span class="s1">&#39;Temporary (to be discarded)&#39;</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;Permanent (to be stored)&#39;</span><span class="p">,</span>
                                 <span class="n">list1</span><span class="o">=</span><span class="n">temp</span><span class="p">,</span> <span class="n">list2</span><span class="o">=</span><span class="n">perm</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
                <span class="c1"># update the permanent Custom Panels</span>
                <span class="n">registered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigurableItemNames</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dlg</span><span class="o">.</span><span class="n">getAll2</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">registered</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">setPermanent</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigDelegate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">name</span><span class="p">)</span>
                <span class="c1"># unregister any panel that is temporary</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dlg</span><span class="o">.</span><span class="n">getAll1</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">setPermanent</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unregisterConfigurableItem</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">raiseOnError</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.updatePermanentExternalApplications"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.updatePermanentExternalApplications">[docs]</a>    <span class="k">def</span> <span class="nf">updatePermanentExternalApplications</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">showAlways</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Shows a dialog for selecting which new externals applications</span>
<span class="sd">        should be permanently stored in the configuration.</span>

<span class="sd">        :param showAlways: (bool) forces showing the dialog</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># check if there are some newly created external applications that may</span>
        <span class="c1"># be made permanent</span>
        <span class="c1">#permanet_ext_app = list(self._external_app_names)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">showAlways</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Select which of the external applications should be stored&#39;</span>
            <span class="n">dlg</span> <span class="o">=</span> <span class="n">QDoubleListDlg</span><span class="p">(</span><span class="n">winTitle</span><span class="o">=</span><span class="s1">&#39;Stored external applications&#39;</span><span class="p">,</span>
                                 <span class="n">mainLabel</span><span class="o">=</span><span class="n">msg</span><span class="p">,</span>
                                 <span class="n">label1</span><span class="o">=</span><span class="s1">&#39;Temporary (to be discarded)&#39;</span><span class="p">,</span>
                                 <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;Permanent (to be stored)&#39;</span><span class="p">,</span>
                                 <span class="n">list1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span>
                                 <span class="n">list2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__permanent_ext_apps</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
                <span class="c1"># update the temporally external applications</span>
                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dlg</span><span class="o">.</span><span class="n">getAll2</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__permanent_ext_apps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__external_app</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dlg</span><span class="o">.</span><span class="n">getAll1</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">unregisterConfigurableItem</span><span class="p">(</span><span class="s2">&quot;_extApp[</span><span class="si">%s</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
                                                    <span class="n">raiseOnError</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.createCustomPanel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.createCustomPanel">[docs]</a>    <span class="k">def</span> <span class="nf">createCustomPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">paneldesc</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a panel from a Panel Description and sets it as &quot;custom panel&quot;.</span>

<span class="sd">        :param paneldesc: (PanelDescription) description of the panel to be created</span>

<span class="sd">        .. seealso:: :meth:`createPanel`</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">paneldesc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.taurusgui</span> <span class="k">import</span> <span class="n">PanelDescriptionWizard</span>
            <span class="n">paneldesc</span><span class="p">,</span> <span class="n">ok</span> <span class="o">=</span> <span class="n">PanelDescriptionWizard</span><span class="o">.</span><span class="n">getDialog</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">extraWidgets</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_extraCatalogWidgets</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ok</span><span class="p">:</span>
                <span class="k">return</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">paneldesc</span><span class="o">.</span><span class="n">getWidget</span><span class="p">(</span><span class="n">sdm</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="p">,</span> <span class="n">setModel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;setCustomWidgetMap&#39;</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setCustomWidgetMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getCustomWidgetMap</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">paneldesc</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">paneldesc</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">TaurusBaseComponent</span><span class="p">):</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setModifiableByUser</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">w</span><span class="o">.</span><span class="n">setModelInConfig</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createPanel</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">paneldesc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">floating</span><span class="o">=</span><span class="n">paneldesc</span><span class="o">.</span><span class="n">floating</span><span class="p">,</span> <span class="n">custom</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">registerconfig</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">instrumentkey</span><span class="o">=</span><span class="n">paneldesc</span><span class="o">.</span><span class="n">instrumentkey</span><span class="p">,</span>
                         <span class="n">permanent</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Panel </span><span class="si">%s</span><span class="s1"> created. Drag items to it or use the context menu to customize it&#39;</span> <span class="o">%</span> <span class="n">w</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">newShortMessage</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.createMainSynoptic"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.createMainSynoptic">[docs]</a>    <span class="k">def</span> <span class="nf">createMainSynoptic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">synopticname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a synoptic panel and registers it as &quot;SelectedInstrument&quot;</span>
<span class="sd">        reader and writer (allowing  selecting instruments from synoptic</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">jdwFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">synopticname</span><span class="p">)</span>
            <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.graphic</span> <span class="k">import</span> <span class="n">TaurusJDrawSynopticsView</span>
            <span class="n">synoptic</span> <span class="o">=</span> <span class="n">TaurusJDrawSynopticsView</span><span class="p">()</span>
            <span class="n">synoptic</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">jdwFileName</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__synoptics</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">synoptic</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># print repr(e)</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Error loading synoptic file &quot;</span><span class="si">%s</span><span class="s1">&quot;.</span><span class="se">\n</span><span class="s1">Synoptic won</span><span class="se">\&#39;</span><span class="s1">t be available&#39;</span> <span class="o">%</span> <span class="n">jdwFileName</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ignore</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectWriter</span><span class="p">(</span>
            <span class="s2">&quot;SelectedInstrument&quot;</span><span class="p">,</span> <span class="n">synoptic</span><span class="p">,</span> <span class="s2">&quot;graphicItemSelected&quot;</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectReader</span><span class="p">(</span>
            <span class="s2">&quot;SelectedInstrument&quot;</span><span class="p">,</span> <span class="n">synoptic</span><span class="o">.</span><span class="n">selectGraphicItem</span><span class="p">)</span>

        <span class="c1"># find an unique (and short) name</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">synopticname</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Syn&#39;</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">while</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">_</span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">prefix</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">synopticpanel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createPanel</span><span class="p">(</span><span class="n">synoptic</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">permanent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                         <span class="n">icon</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span>
                                             <span class="s1">&#39;image-x-generic&#39;</span><span class="p">))</span>
        <span class="n">toggleSynopticAction</span> <span class="o">=</span> <span class="n">synopticpanel</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">quickAccessToolBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">toggleSynopticAction</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.createConsole"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.createConsole">[docs]</a>    <span class="k">def</span> <span class="nf">createConsole</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernels</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;createConsole() and the &quot;CONSOLE&quot; configuration key are &#39;</span> <span class="o">+</span>
               <span class="s1">&#39;deprecated since 4.0.4. Add a panel with a &#39;</span> <span class="o">+</span>
               <span class="s1">&#39;silx.gui.console.IPythonWidget  widdget instead&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">silx.gui.console</span> <span class="k">import</span> <span class="n">IPythonWidget</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Cannot import taurus.qt.qtgui.console. &#39;</span> <span class="o">+</span>
                         <span class="s1">&#39;The Console Panel will not be available&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">console</span> <span class="o">=</span> <span class="n">IPythonWidget</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">createPanel</span><span class="p">(</span><span class="n">console</span><span class="p">,</span> <span class="s2">&quot;Console&quot;</span><span class="p">,</span> <span class="n">permanent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">icon</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s1">&#39;utilities-terminal&#39;</span><span class="p">))</span></div>

<div class="viewcode-block" id="TaurusGui.createInstrumentsFromPool"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.createInstrumentsFromPool">[docs]</a>    <span class="k">def</span> <span class="nf">createInstrumentsFromPool</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">macroservername</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Creates a list of instrument panel descriptions by gathering the info</span>
<span class="sd">        from the Pool. Each panel is a TaurusForm grouping together all those</span>
<span class="sd">        elements that belong to the same instrument according to the Pool info</span>

<span class="sd">        :return: (list&lt;PanelDescription&gt;)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">instrument_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ms</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">Device</span><span class="p">(</span><span class="n">macroservername</span><span class="p">)</span>
            <span class="n">instruments</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">getElementsOfType</span><span class="p">(</span><span class="s1">&#39;Instrument&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instruments</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Could not fetch Instrument list from &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">macroservername</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="n">msg</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ignore</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">instruments</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">i_name</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">full_name</span>
            <span class="c1">#i_name, i_unknown, i_type, i_pools = i.split()</span>
            <span class="n">i_view</span> <span class="o">=</span> <span class="n">PanelDescription</span><span class="p">(</span>
                <span class="n">i_name</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;TaurusForm&#39;</span><span class="p">,</span> <span class="n">floating</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="p">[])</span>
            <span class="n">instrument_dict</span><span class="p">[</span><span class="n">i_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">i_view</span>

        <span class="kn">from</span> <span class="nn">operator</span> <span class="k">import</span> <span class="n">attrgetter</span>
        <span class="n">pool_elements</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">getElementsWithInterface</span><span class="p">(</span>
            <span class="s1">&#39;Moveable&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="n">pool_elements</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">getElementsWithInterface</span><span class="p">(</span>
            <span class="s1">&#39;ExpChannel&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="n">pool_elements</span> <span class="o">+=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ms</span><span class="o">.</span><span class="n">getElementsWithInterface</span><span class="p">(</span>
            <span class="s1">&#39;IORegister&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">key</span><span class="o">=</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">pool_elements</span><span class="p">:</span>
            <span class="n">instrument</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">instrument</span>
            <span class="k">if</span> <span class="n">instrument</span><span class="p">:</span>
                <span class="n">i_name</span> <span class="o">=</span> <span class="n">instrument</span>
                <span class="n">e_name</span> <span class="o">=</span> <span class="s2">&quot;tango://</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">elem</span><span class="o">.</span><span class="n">full_name</span>
                <span class="n">instrument_dict</span><span class="p">[</span><span class="n">i_name</span><span class="p">]</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_name</span><span class="p">)</span>
        <span class="c1"># filter out empty panels</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[</span><span class="n">instrument</span> <span class="k">for</span> <span class="n">instrument</span> <span class="ow">in</span> <span class="n">instrument_dict</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
               <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instrument</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="k">def</span> <span class="nf">__getVarFromXML</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root</span><span class="p">,</span> <span class="n">nodename</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">nodename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">name</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">default</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">text</span>

    <span class="k">def</span> <span class="nf">_importConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the module corresponding to `confname` or to</span>
<span class="sd">        `tgconf_&lt;confname&gt;`. Note: the `conf` subdirectory of the directory in</span>
<span class="sd">        which taurusgui.py file is installed is temporally prepended to sys.path</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">confsubdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span>
            <span class="vm">__file__</span><span class="p">)),</span> <span class="s1">&#39;conf&#39;</span><span class="p">)</span>  <span class="c1"># the path to a conf subdirectory of the place where taurusgui.py is</span>
        <span class="n">oldpath</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># add the conf subdirectory dir to the pythonpath</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="p">[</span><span class="n">confsubdir</span><span class="p">]</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span>
            <span class="n">conf</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">confname</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
            <span class="n">altconfname</span> <span class="o">=</span> <span class="s2">&quot;tgconf_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">confname</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conf</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span><span class="n">altconfname</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;cannot import </span><span class="si">%s</span><span class="s1"> or </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">confname</span><span class="p">,</span> <span class="n">altconfname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">oldpath</span>  <span class="c1"># restore the previous sys.path</span>
        <span class="k">return</span> <span class="n">conf</span>

<div class="viewcode-block" id="TaurusGui.loadConfiguration"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.loadConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">loadConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">confname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Reads a configuration file</span>

<span class="sd">        :param confname: (str or None) the  name of module located in the</span>
<span class="sd">                         PYTHONPATH or in the conf subdirectory of the directory</span>
<span class="sd">                         in which taurusgui.py file is installed.</span>
<span class="sd">                         This method will try to import &lt;confname&gt;.</span>
<span class="sd">                         If that fails, it will try to import</span>
<span class="sd">                         `tgconf_&lt;confname&gt;`.</span>
<span class="sd">                         Alternatively, `confname` can be the path to the</span>
<span class="sd">                         configuration module (not necessarily in the</span>
<span class="sd">                         PYTHONPATH).</span>
<span class="sd">                         `confname` can also be None, in which case a dummy</span>
<span class="sd">                         empty module will be used.</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="c1"># import the python config file</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">confname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">types</span>
                <span class="n">conf</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span>
                    <span class="s1">&#39;__dummy_conf_module__&#39;</span><span class="p">)</span>  <span class="c1"># dummy module</span>
                <span class="n">confname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">applicationName</span><span class="p">())</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">confname</span><span class="p">):</span>  <span class="c1"># if confname is a dir or file name</span>
                <span class="kn">import</span> <span class="nn">imp</span>
                <span class="n">path</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">confname</span><span class="p">)</span>
                <span class="n">name</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">f</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">find_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span><span class="n">path</span><span class="p">])</span>
                    <span class="n">conf</span> <span class="o">=</span> <span class="n">imp</span><span class="o">.</span><span class="n">load_module</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
                    <span class="n">confname</span> <span class="o">=</span> <span class="n">name</span>
                <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
                    <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_importConfiguration</span><span class="p">(</span><span class="n">confname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># if confname is not a dir name, we assume it is a module name in the python path</span>
                <span class="n">conf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_importConfiguration</span><span class="p">(</span><span class="n">confname</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">conf</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Error loading configuration: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>  <span class="c1"># repr(e)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># Get the xml root node from the xml configuration file</span>
        <span class="n">XML_CONFIG</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;XML_CONFIG&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">XML_CONFIG</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xmlConfigFileName</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_xmlConfigFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">XML_CONFIG</span><span class="p">)</span>
        <span class="c1"># default fallback (in case of I/O or parse errors)</span>
        <span class="n">xmlroot</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="s1">&#39;&lt;root&gt;&lt;/root&gt;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">XML_CONFIG</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># If a relative name was given, the conf directory will be used</span>
                <span class="c1"># as base path</span>
                <span class="n">xmlfname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">XML_CONFIG</span><span class="p">)</span>
                <span class="n">xmlFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">xmlfname</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">xmlstring</span> <span class="o">=</span> <span class="n">xmlFile</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="n">xmlFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">xmlroot</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xmlstring</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Error reading the XML file: &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">xmlfname</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s1">Reason:&quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ignore</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># General Qt application settings and jorgs bar logos</span>
        <span class="n">APPNAME</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;GUI_NAME&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;GUI_NAME&quot;</span><span class="p">,</span> <span class="n">confname</span><span class="p">))</span>
        <span class="n">ORGNAME</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;ORGANIZATION&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;ORGANIZATION&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">organizationName</span><span class="p">())</span> <span class="ow">or</span> <span class="s1">&#39;Taurus&#39;</span><span class="p">))</span>
        <span class="n">CUSTOMLOGO</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;CUSTOM_LOGO&#39;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;LOGO&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span><span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;CUSTOM_LOGO&quot;</span><span class="p">,</span> <span class="s1">&#39;logos:taurus.png&#39;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QFile</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CUSTOMLOGO</span><span class="p">):</span>
            <span class="n">customIcon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">CUSTOMLOGO</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">customIcon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">CUSTOMLOGO</span><span class="p">))</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">setApplicationName</span><span class="p">(</span><span class="n">APPNAME</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">setOrganizationName</span><span class="p">(</span><span class="n">ORGNAME</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">()</span>

        <span class="n">logo</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tauruscustomsettings</span><span class="p">,</span> <span class="s1">&#39;ORGANIZATION_LOGO&#39;</span><span class="p">,</span>
                       <span class="s2">&quot;logos:taurus.png&quot;</span><span class="p">)</span>
        <span class="n">ORGANIZATIONLOGO</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;ORGANIZATION_LOGO&#39;</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span><span class="n">xmlroot</span><span class="p">,</span>
                                                        <span class="s2">&quot;ORGANIZATION_LOGO&quot;</span><span class="p">,</span>
                                                        <span class="n">logo</span><span class="p">))</span>
        <span class="c1">##</span>
        <span class="k">if</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QFile</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">ORGANIZATIONLOGO</span><span class="p">):</span>
            <span class="n">organizationIcon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">ORGANIZATIONLOGO</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">organizationIcon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">ORGANIZATIONLOGO</span><span class="p">))</span>

        <span class="c1"># if required, enforce that only one instance of this GUI can be run</span>
        <span class="n">SINGLEINSTANCE</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;SINGLE_INSTANCE&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;SINGLE_INSTANCE&quot;</span><span class="p">,</span> <span class="s1">&#39;True&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">SINGLEINSTANCE</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkSingleInstance</span><span class="p">():</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Only one istance of </span><span class="si">%s</span><span class="s1"> is allowed to run the same time&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">APPNAME</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Multiple copies&#39;</span><span class="p">,</span> <span class="n">msg</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># some initialization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resetQSettings</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">APPNAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowIcon</span><span class="p">(</span><span class="n">customIcon</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">organizationIcon</span><span class="p">,</span> <span class="n">ORGNAME</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">customIcon</span><span class="p">,</span> <span class="n">APPNAME</span><span class="p">)</span>

        <span class="c1"># get custom widget catalog entries</span>
        <span class="c1"># @todo: support also loading from xml</span>
        <span class="n">EXTRA_CATALOG_WIDGETS</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;EXTRA_CATALOG_WIDGETS&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extraCatalogWidgets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">classname</span><span class="p">,</span> <span class="n">pixmapname</span> <span class="ow">in</span> <span class="n">EXTRA_CATALOG_WIDGETS</span><span class="p">:</span>
            <span class="c1"># If a relative file name is given, the conf directory will be used</span>
            <span class="c1"># as base path</span>
            <span class="k">if</span> <span class="n">pixmapname</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QFile</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">pixmapname</span><span class="p">):</span>
                <span class="n">pixmapname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">pixmapname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_extraCatalogWidgets</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">classname</span><span class="p">,</span> <span class="n">pixmapname</span><span class="p">))</span>

        <span class="c1"># manual panel</span>
        <span class="n">MANUAL_URI</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;MANUAL_URI&#39;</span><span class="p">,</span>
                             <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span><span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;MANUAL_URI&quot;</span><span class="p">,</span>
                                                  <span class="n">taurus</span><span class="o">.</span><span class="n">Release</span><span class="o">.</span><span class="n">url</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHelpManualURI</span><span class="p">(</span><span class="n">MANUAL_URI</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">createPanel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">helpManualBrowser</span><span class="p">,</span> <span class="s1">&#39;Manual&#39;</span><span class="p">,</span> <span class="n">permanent</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                         <span class="n">icon</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="o">.</span><span class="n">fromTheme</span><span class="p">(</span><span class="s1">&#39;help-browser&#39;</span><span class="p">))</span>

        <span class="c1"># configure the macro infrastructure</span>
        <span class="n">MACROSERVER_NAME</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;MACROSERVER_NAME&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;MACROSERVER_NAME&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="n">MACRO_PANELS</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;MACRO_PANELS&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;MACRO_PANELS&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">))</span>
        <span class="c1"># macro infrastructure will only be created if MACROSERVER_NAME is set</span>
        <span class="k">if</span> <span class="n">MACRO_PANELS</span> <span class="ow">and</span> <span class="n">MACROSERVER_NAME</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.taurusgui</span> <span class="k">import</span> <span class="n">MacroBroker</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__macroBroker</span> <span class="o">=</span> <span class="n">MacroBroker</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">MACROSERVER_NAME</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">macroserverNameChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">MACROSERVER_NAME</span><span class="p">)</span>

        <span class="n">DOOR_NAME</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;DOOR_NAME&#39;</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span><span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;DOOR_NAME&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">DOOR_NAME</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">doorNameChanged</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">DOOR_NAME</span><span class="p">)</span>

        <span class="n">MACROEDITORS_PATH</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;MACROEDITORS_PATH&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;MACROEDITORS_PATH&quot;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">MACROEDITORS_PATH</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">sardana.taurus.qt.qtgui.extra_macroexecutor.macroparameterseditor.macroparameterseditor</span> <span class="k">import</span> <span class="n">ParamEditorManager</span>
            <span class="n">ParamEditorManager</span><span class="p">()</span><span class="o">.</span><span class="n">parsePaths</span><span class="p">(</span><span class="n">MACROEDITORS_PATH</span><span class="p">)</span>
            <span class="n">ParamEditorManager</span><span class="p">()</span><span class="o">.</span><span class="n">browsePaths</span><span class="p">()</span>

        <span class="c1"># Synoptics</span>
        <span class="n">SYNOPTIC</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;SYNOPTIC&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">SYNOPTIC</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>  <span class="c1"># old config file style</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s1">&#39;Deprecated usage of SYNOPTIC keyword (now it expects a list of paths). Please update your configuration file to: &quot;SYNOPTIC=[</span><span class="se">\&#39;</span><span class="si">%s</span><span class="se">\&#39;</span><span class="s1">]&quot;.&#39;</span> <span class="o">%</span> <span class="n">SYNOPTIC</span><span class="p">)</span>
            <span class="n">SYNOPTIC</span> <span class="o">=</span> <span class="p">[</span><span class="n">SYNOPTIC</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">SYNOPTIC</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># we look in the xml config file if not present in the python config</span>
            <span class="n">SYNOPTIC</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">node</span> <span class="o">=</span> <span class="n">xmlroot</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;SYNOPTIC&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">child</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;str&quot;</span><span class="p">)</span>
                    <span class="c1"># we do not append empty strings</span>
                    <span class="k">if</span> <span class="n">s</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
                        <span class="n">SYNOPTIC</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">SYNOPTIC</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createMainSynoptic</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

        <span class="c1"># Get panel descriptions from pool if required</span>
        <span class="n">INSTRUMENTS_FROM_POOL</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;INSTRUMENTS_FROM_POOL&#39;</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;INSTRUMENTS_FROM_POOL&quot;</span><span class="p">,</span> <span class="s1">&#39;False&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;true&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">INSTRUMENTS_FROM_POOL</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">splashScreen</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Gathering Instrument info from Pool&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="n">POOLINSTRUMENTS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createInstrumentsFromPool</span><span class="p">(</span>
                <span class="n">MACROSERVER_NAME</span><span class="p">)</span>  <span class="c1"># auto create instruments from pool</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">POOLINSTRUMENTS</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1">#######################################################################</span>
        <span class="c1"># Deprecated CONSOLE command (if you need a IPython Console, just add a</span>
        <span class="c1"># Panel with a `silx.gui.console.IPythonWidget`</span>
        <span class="c1"># TODO: remove this block when deprecation grace time is due</span>
        <span class="n">CONSOLE</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;CONSOLE&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;CONSOLE&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">if</span> <span class="n">CONSOLE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">createConsole</span><span class="p">([])</span>
        <span class="c1">#######################################################################</span>

        <span class="c1"># get custom panel descriptions from the python config file</span>
        <span class="n">CUSTOM_PANELS</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span>
            <span class="n">conf</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">PanelDescription</span><span class="p">)]</span>

        <span class="c1"># add custom panel descriptions from xml config</span>
        <span class="n">panelDescriptions</span> <span class="o">=</span> <span class="n">xmlroot</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;PanelDescriptions&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">panelDescriptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">panelDescriptions</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;PanelDescription&quot;</span><span class="p">):</span>
                    <span class="n">pd</span> <span class="o">=</span> <span class="n">PanelDescription</span><span class="o">.</span><span class="n">fromXml</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">pd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">CUSTOM_PANELS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="p">)</span>

        <span class="c1"># create panels based on the panel descriptions gathered before</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">CUSTOM_PANELS</span> <span class="o">+</span> <span class="n">POOLINSTRUMENTS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">splashScreen</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Creating panel </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">getWidget</span><span class="p">(</span><span class="n">sdm</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="p">,</span> <span class="n">setModel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="s1">&#39;setCustomWidgetMap&#39;</span><span class="p">):</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">setCustomWidgetMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getCustomWidgetMap</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">instrumentkey</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">instrumentkey</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">IMPLICIT_ASSOCIATION</span>
                <span class="c1"># the pool instruments may change when the pool config changes,</span>
                <span class="c1"># so we do not store their config</span>
                <span class="n">registerconfig</span> <span class="o">=</span> <span class="n">p</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">POOLINSTRUMENTS</span>
                <span class="c1"># create a panel</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">createPanel</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">floating</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">floating</span><span class="p">,</span> <span class="n">registerconfig</span><span class="o">=</span><span class="n">registerconfig</span><span class="p">,</span>
                                 <span class="n">instrumentkey</span><span class="o">=</span><span class="n">instrumentkey</span><span class="p">,</span> <span class="n">permanent</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Cannot create panel </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;__Unknown__&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ignore</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># get custom toolbars descriptions from the python config file</span>
        <span class="n">CUSTOM_TOOLBARS</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span>
            <span class="n">conf</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ToolBarDescription</span><span class="p">)]</span>

        <span class="c1"># add custom toolbar descriptions from xml config</span>
        <span class="n">toolBarDescriptions</span> <span class="o">=</span> <span class="n">xmlroot</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ToolBarDescriptions&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">toolBarDescriptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">toolBarDescriptions</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;ToolBarDescription&quot;</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">ToolBarDescription</span><span class="o">.</span><span class="n">fromXml</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">CUSTOM_TOOLBARS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="c1"># create toolbars based on the descriptions gathered before</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">CUSTOM_TOOLBARS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">splashScreen</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Creating Toolbar </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">getWidget</span><span class="p">(</span><span class="n">sdm</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="p">,</span> <span class="n">setModel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="c1"># add the toolbar to the window</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addToolBar</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="c1"># add the toggleview action to the view menu</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewToolBarsMenu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">())</span>
                <span class="c1"># register the toolbar as delegate if it supports it</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">BaseConfigurableClass</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigDelegate</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Cannot add toolbar </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;__Unknown__&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ignore</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="n">CUSTOM_APPLETS</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># for backwards compatibility</span>
        <span class="n">MONITOR</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span>
            <span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;MONITOR&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span><span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;MONITOR&quot;</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">if</span> <span class="n">MONITOR</span><span class="p">:</span>
            <span class="n">CUSTOM_APPLETS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">AppletDescription</span><span class="p">(</span>
                <span class="s1">&#39;monitor&#39;</span><span class="p">,</span> <span class="n">classname</span><span class="o">=</span><span class="s1">&#39;TaurusMonitorTiny&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">MONITOR</span><span class="p">))</span>

        <span class="c1"># get custom applet descriptions from the python config file</span>
        <span class="n">CUSTOM_APPLETS</span> <span class="o">+=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span>
            <span class="n">conf</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">AppletDescription</span><span class="p">)]</span>

        <span class="c1"># add applet descriptions from xml config</span>
        <span class="n">appletDescriptions</span> <span class="o">=</span> <span class="n">xmlroot</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;AppletDescriptions&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">appletDescriptions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">appletDescriptions</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;AppletDescription&quot;</span><span class="p">):</span>
                    <span class="n">d</span> <span class="o">=</span> <span class="n">AppletDescription</span><span class="o">.</span><span class="n">fromXml</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">d</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">CUSTOM_APPLETS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>

        <span class="c1"># create applet based on the descriptions gathered before</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">CUSTOM_APPLETS</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">splashScreen</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="s2">&quot;Creating applet </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">getWidget</span><span class="p">(</span><span class="n">sdm</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="p">,</span> <span class="n">setModel</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">d</span><span class="o">.</span><span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">w</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
                <span class="c1"># add the widget to the applets toolbar</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">jorgsBar</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                <span class="c1"># register the toolbar as delegate if it supports it</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">BaseConfigurableClass</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigDelegate</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Cannot add applet </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">getattr</span><span class="p">(</span>
                    <span class="n">d</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;__Unknown__&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">traceback</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Info</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;Initialization error&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="se">\n\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="n">msg</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ignore</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">result</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Abort</span><span class="p">:</span>
                    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>

        <span class="c1"># add external applications from both the python and the xml config</span>
        <span class="c1"># files</span>
        <span class="n">EXTERNAL_APPS</span> <span class="o">=</span> <span class="p">[</span><span class="n">obj</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span>
            <span class="n">conf</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">ExternalApp</span><span class="p">)]</span>

        <span class="n">externalAppsNode</span> <span class="o">=</span> <span class="n">xmlroot</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ExternalApps&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">externalAppsNode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">externalAppsNode</span><span class="p">:</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;ExternalApp&quot;</span><span class="p">):</span>
                    <span class="n">ea</span> <span class="o">=</span> <span class="n">ExternalApp</span><span class="o">.</span><span class="n">fromXml</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">child</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">ea</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">EXTERNAL_APPS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ea</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">EXTERNAL_APPS</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_external_app_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getAction</span><span class="p">()</span><span class="o">.</span><span class="n">text</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addExternalAppLauncher</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">getAction</span><span class="p">())</span>

        <span class="c1"># get the &quot;factory settings&quot; filename. By default, it is called</span>
        <span class="c1"># &quot;default.ini&quot; and resides in the configuration dir</span>
        <span class="n">INIFILE</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s1">&#39;INIFILE&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getVarFromXML</span><span class="p">(</span>
            <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;INIFILE&quot;</span><span class="p">,</span> <span class="s2">&quot;default.ini&quot;</span><span class="p">))</span>
        <span class="c1"># if a relative name is given, the conf dir is used as the root path</span>
        <span class="n">iniFileName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">INIFILE</span><span class="p">)</span>

        <span class="c1"># read the settings (or the factory settings if the regular file is not</span>
        <span class="c1"># found)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Loading previous state&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultConfigRecursionDepth</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s2">&quot; in Fail Proof mode&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">splashScreen</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadSettings</span><span class="p">(</span><span class="n">factorySettingsFileName</span><span class="o">=</span><span class="n">iniFileName</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.setLockView"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.setLockView">[docs]</a>    <span class="k">def</span> <span class="nf">setLockView</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">locked</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModifiableByUser</span><span class="p">(</span><span class="ow">not</span> <span class="n">locked</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.setModifiableByUser"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.setModifiableByUser">[docs]</a>    <span class="k">def</span> <span class="nf">setModifiableByUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifiable</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">modifiable</span><span class="p">:</span>
            <span class="n">dwfeat</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDockWidget</span><span class="o">.</span><span class="n">AllDockWidgetFeatures</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dwfeat</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDockWidget</span><span class="o">.</span><span class="n">NoDockWidgetFeatures</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">toggleViewAction</span><span class="p">()</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">modifiable</span><span class="p">)</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">setFeatures</span><span class="p">(</span><span class="n">dwfeat</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">newPanelAction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showAllPanelsAction</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">hideAllPanelsAction</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">addExternalApplicationAction</span><span class="p">,</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">removeExternalApplicationAction</span><span class="p">,</span>
                       <span class="p">):</span>
            <span class="n">action</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">modifiable</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_lockviewAction</span><span class="o">.</span><span class="n">setChecked</span><span class="p">(</span><span class="ow">not</span> <span class="n">modifiable</span><span class="p">)</span>
        <span class="n">TaurusMainWindow</span><span class="o">.</span><span class="n">setModifiableByUser</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modifiable</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.onShortMessage"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.onShortMessage">[docs]</a>    <span class="k">def</span> <span class="nf">onShortMessage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Slot to be called when there is a new short message. Currently, the only action</span>
<span class="sd">        taken when there is a new message is to display it in the main window status bar.</span>

<span class="sd">        :param msg: (str) the short descriptive message to be handled</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statusBar</span><span class="p">()</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.hideAllPanels"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.hideAllPanels">[docs]</a>    <span class="k">def</span> <span class="nf">hideAllPanels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;hides all current panels&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusGui.showAllPanels"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.showAllPanels">[docs]</a>    <span class="k">def</span> <span class="nf">showAllPanels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;shows all current panels&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">panel</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">itervalues</span><span class="p">():</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusGui.onShowAssociationDialog"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.onShowAssociationDialog">[docs]</a>    <span class="k">def</span> <span class="nf">onShowAssociationDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;launches the instrument-panel association dialog (modal)&#39;&#39;&#39;</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">AssociationDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">connectWriter</span><span class="p">(</span>
            <span class="s2">&quot;SelectedInstrument&quot;</span><span class="p">,</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="p">,</span> <span class="s2">&quot;activated(QString)&quot;</span><span class="p">)</span>
        <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">disconnectWriter</span><span class="p">(</span>
            <span class="s2">&quot;SelectedInstrument&quot;</span><span class="p">,</span> <span class="n">dlg</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">instrumentCB</span><span class="p">,</span> <span class="s2">&quot;activated(QString)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.getInstrumentAssociation"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.getInstrumentAssociation">[docs]</a>    <span class="k">def</span> <span class="nf">getInstrumentAssociation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrumentname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the panel name associated to an instrument name</span>

<span class="sd">        :param instrumentname: (str or None) The name of the instrument whose associated panel is wanted</span>

<span class="sd">        :return: (str or None) the associated panel name (or None).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.setInstrumentAssociation"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.setInstrumentAssociation">[docs]</a>    <span class="k">def</span> <span class="nf">setInstrumentAssociation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrumentname</span><span class="p">,</span> <span class="n">panelname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets the panel name associated to an instrument</span>

<span class="sd">        :param instrumentname: (str) The name of the instrument</span>
<span class="sd">        :param panelname: (str or None) The name of the associated</span>
<span class="sd">                          panel or None to remove the association</span>
<span class="sd">                          for this instrument.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">instrumentname</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">)</span>
        <span class="c1"># remove a previous association if it exists</span>
        <span class="n">oldpanelname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelToInstrumentMap</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">oldpanelname</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># create the new association</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span><span class="p">[</span><span class="n">instrumentname</span><span class="p">]</span> <span class="o">=</span> <span class="n">panelname</span>
        <span class="k">if</span> <span class="n">panelname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__panelToInstrumentMap</span><span class="p">[</span><span class="n">panelname</span><span class="p">]</span> <span class="o">=</span> <span class="n">instrumentname</span></div>

<div class="viewcode-block" id="TaurusGui.getAllInstrumentAssociations"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.getAllInstrumentAssociations">[docs]</a>    <span class="k">def</span> <span class="nf">getAllInstrumentAssociations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the dictionary of instrument-panel associations</span>

<span class="sd">        :return: (dict&lt;str,str&gt;) a dict whose keys are the instruments known to the gui</span>
<span class="sd">                 and whose values are the corresponding associated panels (or None).</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.setAllInstrumentAssociations"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.setAllInstrumentAssociations">[docs]</a>    <span class="k">def</span> <span class="nf">setAllInstrumentAssociations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">associationsdict</span><span class="p">,</span> <span class="n">clearExisting</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Sets the dictionary of instrument-panel associations.</span>
<span class="sd">        By default, it keeps any existing association not present in the associationsdict.</span>

<span class="sd">        :param associationsdict: (dict&lt;str,str&gt;) a dict whose keys are the instruments names</span>
<span class="sd">                                 and whose values are the corresponding associated panels (or None)</span>
<span class="sd">        :param clearExisting: (bool) if True, the the existing asociations are cleared.</span>
<span class="sd">                              If False (default) existing associations are</span>
<span class="sd">                              updated with those in associationsdict</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">clearExisting</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">associationsdict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">associationsdict</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__panelToInstrumentMap</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__instrumentToPanelMap</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__panelToInstrumentMap</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span></div>

    <span class="k">def</span> <span class="nf">_onPanelVisibilityChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">visible</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">visible</span><span class="p">:</span>
            <span class="n">panelname</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sender</span><span class="p">()</span><span class="o">.</span><span class="n">objectName</span><span class="p">())</span>
            <span class="n">instrumentname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panelToInstrumentMap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">panelname</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">instrumentname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">SelectedInstrument</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">)</span>

<div class="viewcode-block" id="TaurusGui.onSelectedInstrument"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.onSelectedInstrument">[docs]</a>    <span class="k">def</span> <span class="nf">onSelectedInstrument</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instrumentname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Slot to be called when the selected instrument has changed (e.g. by user</span>
<span class="sd">        clicking in the synoptic)</span>

<span class="sd">        :param instrumentname: (str) The name that identifies the instrument.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">instrumentname</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">)</span>
        <span class="n">panelname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getInstrumentAssociation</span><span class="p">(</span><span class="n">instrumentname</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFocusToPanel</span><span class="p">(</span><span class="n">panelname</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.setFocusToPanel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.setFocusToPanel">[docs]</a>    <span class="k">def</span> <span class="nf">setFocusToPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">panelname</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Method that sets a focus for panel passed via an argument</span>

<span class="sd">        :param panelname: (str) The name that identifies the panel.</span>
<span class="sd">                               This name must be unique within the panels in the GUI.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">panelname</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">panelname</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">panelname</span><span class="p">]</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">setFocus</span><span class="p">()</span>
            <span class="n">panel</span><span class="o">.</span><span class="n">raise_</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="TaurusGui.tabifyArea"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.tabifyArea">[docs]</a>    <span class="k">def</span> <span class="nf">tabifyArea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; tabifies all panels in a given area.</span>

<span class="sd">        :param area: (Qt.DockWidgetArea)</span>

<span class="sd">        .. warning:: This method is deprecated</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span>
            <span class="s1">&#39;tabifyArea is no longer supported (now all panels reside in the same DockWidget Area)&#39;</span><span class="p">)</span>
        <span class="n">panels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">findPanelsInArea</span><span class="p">(</span><span class="n">area</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">panels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">p0</span> <span class="o">=</span> <span class="n">panels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">panels</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tabifyDockWidget</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.findPanelsInArea"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.findPanelsInArea">[docs]</a>    <span class="k">def</span> <span class="nf">findPanelsInArea</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; returns all panels in the given area</span>

<span class="sd">        :param area: (QMdiArea, Qt.DockWidgetArea, &#39;FLOATING&#39; or None). If</span>
<span class="sd">                     area==&#39;FLOATING&#39;, the dockwidgets that are floating will be</span>
<span class="sd">                     returned.</span>
<span class="sd">        :param area:  (Qt.DockWidgetArea or str )</span>

<span class="sd">        .. warning:: This method is deprecated</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">DeprecationWarning</span><span class="p">(</span>
            <span class="s1">&#39;findPanelsInArea is no longer supported (now all panels reside in the same DockWidget Area)&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">area</span> <span class="o">==</span> <span class="s1">&#39;FLOATING&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">isFloating</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dockWidgetArea</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="o">==</span> <span class="n">area</span><span class="p">]</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TaurusGui.getQtDesignerPluginInfo"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.getQtDesignerPluginInfo">[docs]</a>    <span class="k">def</span> <span class="nf">getQtDesignerPluginInfo</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;TaurusGui is not to be in designer &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="TaurusGui.onShowManual"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.onShowManual">[docs]</a>    <span class="k">def</span> <span class="nf">onShowManual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented from :class:`TaurusMainWindow` to show the manual in a panel (not just a dockwidget)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setFocusToPanel</span><span class="p">(</span><span class="s1">&#39;Manual&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusGui.onExportCurrentPanelConfiguration"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.onExportCurrentPanelConfiguration">[docs]</a>    <span class="k">def</span> <span class="nf">onExportCurrentPanelConfiguration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xmlConfigFileName</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xmlConfigFileName</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xmlroot</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s2">&quot;taurusgui_config&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xmlConfigFileName</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
                <span class="n">xmlroot</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Cannot parse file &quot;</span><span class="si">%s</span><span class="s1">&quot;: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">,</span>
                           <span class="bp">self</span><span class="o">.</span><span class="n">_xmlConfigFileName</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">return</span>

        <span class="c1"># retrieve/create the PanelDescriptions node</span>
        <span class="n">panelDescriptionsNode</span> <span class="o">=</span> <span class="n">xmlroot</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;PanelDescriptions&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">panelDescriptionsNode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">panelDescriptionsNode</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span>
                <span class="n">xmlroot</span><span class="p">,</span> <span class="s2">&quot;PanelDescriptions&quot;</span><span class="p">)</span>

        <span class="c1"># Get all custom panels</span>
        <span class="n">dlg</span> <span class="o">=</span> <span class="n">QDoubleListDlg</span><span class="p">(</span><span class="n">winTitle</span><span class="o">=</span><span class="s1">&#39;Export Panels to XML&#39;</span><span class="p">,</span>
                             <span class="n">mainLabel</span><span class="o">=</span><span class="s1">&#39;Select which of the custom panels you want to export as xml configuration&#39;</span><span class="p">,</span>
                             <span class="n">label1</span><span class="o">=</span><span class="s1">&#39;Not Exported&#39;</span><span class="p">,</span> <span class="n">label2</span><span class="o">=</span><span class="s1">&#39;Exported&#39;</span><span class="p">,</span>
                             <span class="n">list1</span><span class="o">=</span><span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">isCustom</span><span class="p">()],</span> <span class="n">list2</span><span class="o">=</span><span class="p">[])</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="n">Accepted</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">exportlist</span> <span class="o">=</span> <span class="n">dlg</span><span class="o">.</span><span class="n">getAll2</span><span class="p">()</span>

        <span class="c1"># create xml for those to be exported</span>
        <span class="n">registered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getConfigurableItemNames</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">exportlist</span><span class="p">:</span>
            <span class="n">panel</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__panels</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">registered</span><span class="p">:</span>
                <span class="n">panel</span><span class="o">.</span><span class="n">setPermanent</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigDelegate</span><span class="p">(</span><span class="n">panel</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
            <span class="n">panelxml</span> <span class="o">=</span> <span class="n">PanelDescription</span><span class="o">.</span><span class="n">fromPanel</span><span class="p">(</span><span class="n">panel</span><span class="p">)</span><span class="o">.</span><span class="n">toXml</span><span class="p">()</span>
            <span class="n">panelDescriptionsNode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">panelxml</span><span class="p">))</span>
        <span class="n">xml</span> <span class="o">=</span> <span class="n">etree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">xmlroot</span><span class="p">,</span> <span class="n">pretty_print</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># write to file</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">fname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QFileDialog</span><span class="o">.</span><span class="n">getSaveFileName</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Open File&quot;</span><span class="p">,</span> <span class="n">fname</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tr</span><span class="p">(</span><span class="s2">&quot;XML files (*.xml)&quot;</span><span class="p">))</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span>
                    <span class="k">return</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
            <span class="c1"># backup the file</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
                <span class="kn">import</span> <span class="nn">shutil</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">bckname</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.orig&quot;</span> <span class="o">%</span> <span class="n">fname</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">bckname</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> will be overwritten but I could not create a backup in </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">bckname</span><span class="p">)</span>
            <span class="c1"># write the data</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">xml</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Cannot write to </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;I/O problem&quot;</span><span class="p">,</span> <span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Choose a different location.&#39;</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">NoButton</span><span class="p">)</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">hint</span> <span class="o">=</span> <span class="s2">&quot;XML_CONFIG = &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">relpath</span><span class="p">(</span>
            <span class="n">fname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Configuration written in </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">fname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;Configuration updated&quot;</span><span class="p">,</span>
                                   <span class="n">msg</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Make sure that the .py configuration file in </span><span class="si">%s</span><span class="s1"> contains</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">_confDirectory</span><span class="p">,</span> <span class="n">hint</span><span class="p">),</span>
                                   <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">NoButton</span><span class="p">)</span>

        <span class="k">return</span></div>

<div class="viewcode-block" id="TaurusGui.showSDMInfo"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/taurusgui/_TaurusGui.html#taurus.qt.qtgui.taurusgui.TaurusGui.showSDMInfo">[docs]</a>    <span class="k">def</span> <span class="nf">showSDMInfo</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;pops up a dialog showing the current information from the Shared Data Manager&#39;&#39;&#39;</span>
        <span class="c1">#w = Qt.QMessageBox( self)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;Currently managing </span><span class="si">%i</span><span class="s1"> shared data objects:</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">activeDataUIDs</span><span class="p">()),</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">activeDataUIDs</span><span class="p">()))</span>
        <span class="n">nfo</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">qApp</span><span class="o">.</span><span class="n">SDM</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Information</span><span class="p">,</span> <span class="s1">&#39;Shared Data Manager Information&#39;</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span>
                           <span class="n">buttons</span><span class="o">=</span><span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Close</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">setDetailedText</span><span class="p">(</span><span class="n">nfo</span><span class="p">)</span>
        <span class="n">w</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">nfo</span><span class="p">)</span></div></div>


<span class="c1">#------------------------------------------------------------------------------</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">confname</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">taurus</span>
    <span class="kn">from</span> <span class="nn">taurus.core.util</span> <span class="k">import</span> <span class="n">argparse</span>
    <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.application</span> <span class="k">import</span> <span class="n">TaurusApplication</span>

    <span class="n">taurus</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Starting execution of TaurusGui&#39;</span><span class="p">)</span>

    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">get_taurus_parser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_usage</span><span class="p">(</span><span class="s2">&quot;%prog [options] confname&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;The taurus GUI application&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;--config-dir&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;config_dir&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use the given configuration directory for initialization&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;--new-gui&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;new_gui&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;launch a wizard for creating a new TaurusGUI application&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;--fail-proof&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;fail_proof&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s2">&quot;launch in fail proof mode (it prevents potentially problematic configs from being loaded)&quot;</span><span class="p">)</span>

    <span class="n">app</span> <span class="o">=</span> <span class="n">TaurusApplication</span><span class="p">(</span><span class="n">cmd_line_parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span> <span class="n">app_name</span><span class="o">=</span><span class="s2">&quot;taurusgui&quot;</span><span class="p">,</span>
                            <span class="n">app_version</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Release</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_command_line_args</span><span class="p">()</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_command_line_options</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">new_gui</span><span class="p">:</span>  <span class="c1"># launch app settings wizard instead of taurusgui</span>
        <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.taurusgui</span> <span class="k">import</span> <span class="n">AppSettingsWizard</span>
        <span class="n">wizard</span> <span class="o">=</span> <span class="n">AppSettingsWizard</span><span class="p">()</span>
        <span class="n">wizard</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">confname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">confname</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">config_dir</span>

    <span class="k">if</span> <span class="n">confname</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># for backwards compat, we allow to specify the confname without the &quot;--config-dir&quot; parameter</span>
            <span class="n">confname</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
            <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">fail_proof</span><span class="p">:</span>
        <span class="n">configRecursionDepth</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">configRecursionDepth</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">gui</span> <span class="o">=</span> <span class="n">TaurusGui</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">confname</span><span class="o">=</span><span class="n">confname</span><span class="p">,</span>
                    <span class="n">configRecursionDepth</span><span class="o">=</span><span class="n">configRecursionDepth</span><span class="p">)</span>

    <span class="n">gui</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

    <span class="n">taurus</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Finished execution of TaurusGui&#39;</span><span class="p">)</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
    <span class="c1"># xmlTest()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'4.1.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>