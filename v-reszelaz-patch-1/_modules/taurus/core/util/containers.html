

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>taurus.core.util.containers &mdash; taurus 4.1.2-alpha documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="taurus 4.1.2-alpha documentation" href="../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../index.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> taurus
          

          
            
            <img src="../../../../_static/taurus.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference external" href="http://www.taurus-scada.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/taurus-org/taurus">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/taurus">Download from PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docs.html">Taurus 4.1 documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../index.html">taurus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
      
    <li>taurus.core.util.containers</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for taurus.core.util.containers</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1">#############################################################################</span>
<span class="c1">##</span>
<span class="c1"># This file is part of Taurus</span>
<span class="c1">##</span>
<span class="c1"># http://taurus-scada.org</span>
<span class="c1">##</span>
<span class="c1"># Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c1">##</span>
<span class="c1"># Taurus is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">##</span>
<span class="c1"># Taurus is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU Lesser General Public License for more details.</span>
<span class="c1">##</span>
<span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1"># along with Taurus.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">##</span>
<span class="c1">#############################################################################</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This module contains a set of useful containers that are not part of the standard</span>
<span class="sd">python distribution.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CaselessList&quot;</span><span class="p">,</span> <span class="s2">&quot;CaselessDict&quot;</span><span class="p">,</span> <span class="s2">&quot;CaselessWeakValueDict&quot;</span><span class="p">,</span> <span class="s2">&quot;LoopList&quot;</span><span class="p">,</span>
           <span class="s2">&quot;CircBuf&quot;</span><span class="p">,</span> <span class="s2">&quot;LIFO&quot;</span><span class="p">,</span> <span class="s2">&quot;TimedQueue&quot;</span><span class="p">,</span> <span class="s2">&quot;self_locked&quot;</span><span class="p">,</span> <span class="s2">&quot;ThreadDict&quot;</span><span class="p">,</span>
           <span class="s2">&quot;defaultdict&quot;</span><span class="p">,</span> <span class="s2">&quot;defaultdict_fromkey&quot;</span><span class="p">,</span> <span class="s2">&quot;CaselessDefaultDict&quot;</span><span class="p">,</span>
           <span class="s2">&quot;DefaultThreadDict&quot;</span><span class="p">,</span> <span class="s2">&quot;getDictAsTree&quot;</span><span class="p">,</span> <span class="s2">&quot;ArrayBuffer&quot;</span><span class="p">,</span> <span class="p">]</span>

<span class="n">__docformat__</span> <span class="o">=</span> <span class="s2">&quot;restructuredtext&quot;</span>

<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">operator</span>


<div class="viewcode-block" id="CaselessList"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList">[docs]</a><span class="k">class</span> <span class="nc">CaselessList</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A case insensitive lists that has some caseless methods. Only allows</span>
<span class="sd">    strings as list members. Most methods that would normally return a list,</span>
<span class="sd">    return a CaselessList. (Except list() and lowercopy())</span>
<span class="sd">    Sequence Methods implemented are :</span>
<span class="sd">    __contains__, remove, count, index, append, extend, insert,</span>
<span class="sd">    __getitem__, __setitem__, __getslice__, __setslice__</span>
<span class="sd">    __add__, __radd__, __iadd__, __mul__, __rmul__</span>
<span class="sd">    Plus Extra methods:</span>
<span class="sd">    findentry, copy , lowercopy, list</span>
<span class="sd">    Inherited methods :</span>
<span class="sd">    __imul__, __len__, __iter__, pop, reverse, sort</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlist</span><span class="o">=</span><span class="p">[]):</span>
        <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">inlist</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                                <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1"> which is </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span>
                                <span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__lowerstreq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">and</span> <span class="n">b</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">b</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<div class="viewcode-block" id="CaselessList.findentry"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.findentry">[docs]</a>    <span class="k">def</span> <span class="nf">findentry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A caseless way of checking if an item is in the list or not.</span>
<span class="sd">        It returns None or the entry.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                            <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lowerstreq</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">entry</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A caseless way of checking if a list has a member in it or not.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lowerstreq</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<div class="viewcode-block" id="CaselessList.remove"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.remove">[docs]</a>    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove the first occurence of an item, the caseless way.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lowerstreq</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span>
                <span class="k">return</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;: list.remove(x): x not in list&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessList.copy"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a CaselessList copy of self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CaselessList</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessList.list"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.list">[docs]</a>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a normal list version of self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessList.lowercopy"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.lowercopy">[docs]</a>    <span class="k">def</span> <span class="nf">lowercopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return a lowercase (list) copy of self.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span></div>

<div class="viewcode-block" id="CaselessList.append"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds an item to the list and checks it&#39;s a string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                            <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessList.extend"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Extend the list with another list. Each member of the list must be</span>
<span class="sd">        a string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;You can only extend lists with lists. &#39;</span>
                            <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                                <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessList.count"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.count">[docs]</a>    <span class="k">def</span> <span class="nf">count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Counts references to &#39;item&#39; in a caseless manner.</span>
<span class="sd">        If item is not a string it will always return 0.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lowerstreq</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">entry</span><span class="p">):</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">count</span></div>

<div class="viewcode-block" id="CaselessList.index"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">minindex</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">maxindex</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provide an index of first occurence of item in the list. (or raise</span>
<span class="sd">        a ValueError if item not present)</span>
<span class="sd">        If item is not a string, will raise a TypeError.</span>
<span class="sd">        minindex and maxindex are also optional arguments</span>
<span class="sd">        s.index(x[, i[, j]]) return smallest k such that s[k] == x and i &lt;= k &lt; j</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">maxindex</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">maxindex</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">minindex</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minindex</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">maxindex</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">maxindex</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                            <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">))</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">minindex</span>
        <span class="k">while</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="n">maxindex</span><span class="p">:</span>
            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lowerstreq</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]):</span>
                <span class="k">return</span> <span class="n">index</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;: list.index(x): x not in list&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessList.insert"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessList.html#taurus.core.util.CaselessList.insert">[docs]</a>    <span class="k">def</span> <span class="nf">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;s.insert(i, x) same as s[i:i] = [x]</span>
<span class="sd">        Raises TypeError if x isn&#39;t a string.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                            <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For setting values in the list.</span>
<span class="sd">        index must be an integer or (extended) slice object. (__setslice__ used</span>
<span class="sd">        for simple slices)</span>
<span class="sd">        If index is an integer then value must be a string.</span>
<span class="sd">        If index is a slice object then value must be a list of strings - with</span>
<span class="sd">        the same length as the slice object requires.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                                <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
            <span class="nb">list</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;__len__&#39;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s1">&#39;Value given to set slice is not a sequence object.&#39;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                                    <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
            <span class="nb">list</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Indexes must be integers or slice objects.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">sequence</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called to implement assignment to self[i:j].&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">sequence</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="n">basestring</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Members of this object must be strings. &#39;</span>
                                <span class="s1">&#39;You supplied </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">type</span><span class="p">(</span><span class="n">entry</span><span class="p">))</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">__setslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">sequence</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Called to implement evaluation of self[i:j].</span>
<span class="sd">        Although the manual says this method is deprecated - if I don&#39;t define</span>
<span class="sd">        it the list one is called.</span>
<span class="sd">        (Which returns a list - this returns a CaselessList)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CaselessList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="n">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;For fetching indexes.</span>
<span class="sd">        If a slice is fetched then the list returned is a CaselessList.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">CaselessList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To add a list, and return a CaselessList.</span>
<span class="sd">        Every element of item must be a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CaselessList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To add a list, and return a CaselessList.</span>
<span class="sd">        Every element of item must be a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CaselessList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To add a list in place.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">item</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">entry</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To multiply itself, and return a CaselessList.</span>
<span class="sd">        Every element of item must be a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CaselessList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;To multiply itself, and return a CaselessList.</span>
<span class="sd">        Every element of item must be a string.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CaselessList</span><span class="p">(</span><span class="nb">list</span><span class="o">.</span><span class="fm">__rmul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">))</span></div>


<div class="viewcode-block" id="CaselessDict"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDict.html#taurus.core.util.CaselessDict">[docs]</a><span class="k">class</span> <span class="nc">CaselessDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A case insensitive dictionary. Use this class as a normal dictionary.</span>
<span class="sd">    The keys must be strings&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
            <span class="c1"># Doesn&#39;t do keyword args</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<div class="viewcode-block" id="CaselessDict.has_key"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDict.html#taurus.core.util.CaselessDict.has_key">[docs]</a>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`dict.has_key`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></div>

<div class="viewcode-block" id="CaselessDict.get"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDict.html#taurus.core.util.CaselessDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">def_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`dict.get`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">def_val</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessDict.setdefault"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDict.html#taurus.core.util.CaselessDict.setdefault">[docs]</a>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">def_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`dict.setdefault`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">def_val</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessDict.update"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDict.html#taurus.core.util.CaselessDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`dict.update`&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessDict.fromkeys"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDict.html#taurus.core.util.CaselessDict.fromkeys">[docs]</a>    <span class="k">def</span> <span class="nf">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="CaselessDict.pop"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDict.html#taurus.core.util.CaselessDict.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">def_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`dict.pop`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">def_val</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></div>


<div class="viewcode-block" id="CaselessWeakValueDict"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessWeakValueDict.html#taurus.core.util.CaselessWeakValueDict">[docs]</a><span class="k">class</span> <span class="nc">CaselessWeakValueDict</span><span class="p">(</span><span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other</span><span class="p">:</span>
            <span class="c1"># Doesn&#39;t do keyword args</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
                    <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

<div class="viewcode-block" id="CaselessWeakValueDict.has_key"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessWeakValueDict.html#taurus.core.util.CaselessWeakValueDict.has_key">[docs]</a>    <span class="k">def</span> <span class="nf">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`weakref.WeakValueDictionary.has_key`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></div>

<div class="viewcode-block" id="CaselessWeakValueDict.get"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessWeakValueDict.html#taurus.core.util.CaselessWeakValueDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">def_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`weakref.WeakValueDictionary.get`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">def_val</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessWeakValueDict.setdefault"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessWeakValueDict.html#taurus.core.util.CaselessWeakValueDict.setdefault">[docs]</a>    <span class="k">def</span> <span class="nf">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">def_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`weakref.WeakValueDictionary.setdefault`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">def_val</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessWeakValueDict.update"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessWeakValueDict.html#taurus.core.util.CaselessWeakValueDict.update">[docs]</a>    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`weakref.WeakValueDictionary.update`&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">v</span><span class="p">)</span></div>

<div class="viewcode-block" id="CaselessWeakValueDict.fromkeys"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessWeakValueDict.html#taurus.core.util.CaselessWeakValueDict.fromkeys">[docs]</a>    <span class="k">def</span> <span class="nf">fromkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">iterable</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">CaselessWeakValueDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">iterable</span><span class="p">:</span>
            <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span></div>

<div class="viewcode-block" id="CaselessWeakValueDict.pop"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessWeakValueDict.html#taurus.core.util.CaselessWeakValueDict.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">def_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;overwritten from :meth:`weakref.WeakValueDictionary.pop`&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">def_val</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">weakref</span><span class="o">.</span><span class="n">WeakValueDictionary</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span></div>


<span class="c1"># {{{ http://code.activestate.com/recipes/576642/ (r10)</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>


<span class="k">class</span> <span class="nc">PersistentDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Persistent dictionary with an API compatible with shelve and anydbm.</span>

<span class="sd">    The dict is kept in memory, so the dictionary operations run as fast as</span>
<span class="sd">    a regular dictionary.</span>

<span class="sd">    Write to disk is delayed until close or sync (similar to gdbm&#39;s fast mode).</span>

<span class="sd">    Input file format is automatically discovered.</span>
<span class="sd">    Output file format is selectable between pickle, json, and csv.</span>
<span class="sd">    All three serialization formats are backed by fast C implementations.</span>

<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">flag</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">=</span> <span class="n">flag</span>                    <span class="c1"># r=readonly, c=create, or n=new</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>                    <span class="c1"># None or an octal triple like 0644</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>                <span class="c1"># &#39;csv&#39;, &#39;json&#39;, or &#39;pickle&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span>
        <span class="k">if</span> <span class="n">flag</span> <span class="o">!=</span> <span class="s1">&#39;n&#39;</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">R_OK</span><span class="p">):</span>
            <span class="n">fileobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span> <span class="k">if</span> <span class="nb">format</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span> <span class="k">else</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">fileobj</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">sync</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="s1">&#39;Write dict to disk&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">flag</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span>
        <span class="n">tempname</span> <span class="o">=</span> <span class="n">filename</span> <span class="o">+</span> <span class="s1">&#39;.tmp&#39;</span>
        <span class="n">fileobj</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tempname</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span> <span class="k">else</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">tempname</span><span class="p">)</span>
            <span class="k">raise</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">fileobj</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">tempname</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span>    <span class="c1"># atomic commit</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sync</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">exc_info</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;csv&#39;</span><span class="p">:</span>
            <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">fileobj</span><span class="p">)</span><span class="o">.</span><span class="n">writerows</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;json&#39;</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">,</span> <span class="n">separators</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">))</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">==</span> <span class="s1">&#39;pickle&#39;</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">fileobj</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;Unknown format: &#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fileobj</span><span class="p">):</span>
        <span class="c1"># try formats from most restrictive to least restrictive</span>
        <span class="k">for</span> <span class="n">loader</span> <span class="ow">in</span> <span class="p">(</span><span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">,</span> <span class="n">csv</span><span class="o">.</span><span class="n">reader</span><span class="p">):</span>
            <span class="n">fileobj</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">loader</span><span class="p">(</span><span class="n">fileobj</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;File not in a supported format&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="LoopList"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList">[docs]</a><span class="k">class</span> <span class="nc">LoopList</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;this class provides an effectively cyclic list.</span>
<span class="sd">    It can be used, e.g., for storing colors or pen properties to be changed automatically in a plot</span>

<span class="sd">    A LoopList stores an internal index to remember the last accessed item in the list</span>
<span class="sd">    It provides  previous(), current() and next() methods that return the previous,current and next items in the list.</span>
<span class="sd">    The method allItems() returns a copy of all items contained in the list.</span>
<span class="sd">    The index can be accessed by setCurrentIndex() and getCurrentIndex()  (setCurrentIndex(i) additionally returns new current item)</span>
<span class="sd">    Items can be accessed ***without modifying the current index*** by using llist[i]  and llist[i]=x syntax</span>
<span class="sd">    len(llist) returns the **period** of the list.</span>

<span class="sd">    .. note::</span>

<span class="sd">        only basic methods of lists are implemented for llists. In particular,</span>
<span class="sd">        the following are **not** implemented:</span>

<span class="sd">            - slicing</span>
<span class="sd">            - resizing (append, insert, del,...)</span>
<span class="sd">            - binary operators (+,*,...)</span>

<span class="sd">    ..note::</span>

<span class="sd">        it can be used for loops, but the loop will be infinite unless other</span>
<span class="sd">        condition is used for exiting it:</span>

<span class="sd">            - for item in llist: print item  # This is a infinite loop!!</span>
<span class="sd">            - for i in range(len(llist)):print  llist[i]  #This is not infinite</span>
<span class="sd">              since len(llist) returns the period of the list&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemlist</span><span class="o">=</span><span class="p">[]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setItemList</span><span class="p">(</span><span class="n">itemlist</span><span class="p">)</span>

<div class="viewcode-block" id="LoopList.setItemList"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList.setItemList">[docs]</a>    <span class="k">def</span> <span class="nf">setItemList</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">itemlist</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;sets the item list&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_itemlist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itemlist</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nitems</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_itemlist</span><span class="p">)</span></div>

<div class="viewcode-block" id="LoopList.current"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList.current">[docs]</a>    <span class="k">def</span> <span class="nf">current</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns current item&#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># makes the list effectively cyclic</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itemlist</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nitems</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;cyclic list is empty&#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="LoopList.setCurrentIndex"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList.setCurrentIndex">[docs]</a>    <span class="k">def</span> <span class="nf">setCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;sets current index (and returns the corresponding item)&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">()</span></div>

<div class="viewcode-block" id="LoopList.getCurrentIndex"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList.getCurrentIndex">[docs]</a>    <span class="k">def</span> <span class="nf">getCurrentIndex</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the current index&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_index</span></div>

<div class="viewcode-block" id="LoopList.next"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList.next">[docs]</a>    <span class="k">def</span> <span class="nf">next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;advances one item in the list and returns it&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">()</span></div>

<div class="viewcode-block" id="LoopList.previous"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList.previous">[docs]</a>    <span class="k">def</span> <span class="nf">previous</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;goes one item back in the list and returns it&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_index</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">current</span><span class="p">()</span></div>

<div class="viewcode-block" id="LoopList.allItems"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LoopList.html#taurus.core.util.LoopList.allItems">[docs]</a>    <span class="k">def</span> <span class="nf">allItems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;returns the items list (one period)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itemlist</span></div>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_itemlist</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nitems</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="s1">&#39;cyclic list is empty&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_itemlist</span><span class="p">[</span><span class="n">i</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nitems</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nitems</span></div>


<div class="viewcode-block" id="CircBuf"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CircBuf.html#taurus.core.util.CircBuf">[docs]</a><span class="k">class</span> <span class="nc">CircBuf</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A circular buffer of Python values.</span>

<span class="sd">    Examples::</span>

<span class="sd">        &gt;&gt;&gt; cb = CircBuf(3)</span>
<span class="sd">        &gt;&gt;&gt; cb.is_empty()</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; cb.put(&#39;first&#39;)</span>
<span class="sd">        &gt;&gt;&gt; cb.is_empty()</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; cb.put(&#39;second&#39;)</span>
<span class="sd">        &gt;&gt;&gt; cb.put(&#39;third&#39;)</span>
<span class="sd">        &gt;&gt;&gt; cb.is_full()</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; cb.put(&#39;fourth&#39;)</span>
<span class="sd">        &gt;&gt;&gt; cb.get()</span>
<span class="sd">        &#39;second&#39;</span>
<span class="sd">        &gt;&gt;&gt; cb.get()</span>
<span class="sd">        &#39;third&#39;</span>
<span class="sd">        &gt;&gt;&gt; cb.get()</span>
<span class="sd">        &#39;fourth&#39;</span>
<span class="sd">        &gt;&gt;&gt; cb.is_empty()</span>
<span class="sd">        1&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leng</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Construct an empty circular buffer.&quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">buf</span> <span class="o">=</span> <span class="n">leng</span> <span class="o">*</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="CircBuf.is_empty"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CircBuf.html#taurus.core.util.CircBuf.is_empty">[docs]</a>    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns true only if CircBuf has no items.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">==</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="CircBuf.is_full"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CircBuf.html#taurus.core.util.CircBuf.is_full">[docs]</a>    <span class="k">def</span> <span class="nf">is_full</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns true only if CircBuf has no space.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="p">)</span></div>

<div class="viewcode-block" id="CircBuf.get"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CircBuf.html#taurus.core.util.CircBuf.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Retrieves an item from a non-empty circular buffer.&quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="CircBuf.put"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CircBuf.html#taurus.core.util.CircBuf.put">[docs]</a>    <span class="k">def</span> <span class="nf">put</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Puts an item onto a circular buffer.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">buf</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">p</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">len</span> <span class="o">+=</span> <span class="mi">1</span></div></div>


<div class="viewcode-block" id="LIFO"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LIFO.html#taurus.core.util.LIFO">[docs]</a><span class="k">class</span> <span class="nc">LIFO</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">=</span> <span class="nb">max</span>

<div class="viewcode-block" id="LIFO.append"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LIFO.html#taurus.core.util.LIFO.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span></div>

<div class="viewcode-block" id="LIFO.extend"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LIFO.html#taurus.core.util.LIFO.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lst</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">lst</span><span class="p">[</span><span class="n">s</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span></div>

<div class="viewcode-block" id="LIFO.pop"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LIFO.html#taurus.core.util.LIFO.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>

<div class="viewcode-block" id="LIFO.clear"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LIFO.html#taurus.core.util.LIFO.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="p">[]</span></div>

<div class="viewcode-block" id="LIFO.get"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LIFO.html#taurus.core.util.LIFO.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span></div>

<div class="viewcode-block" id="LIFO.getCopy"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_LIFO.html#taurus.core.util.LIFO.getCopy">[docs]</a>    <span class="k">def</span> <span class="nf">getCopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">(</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">))</span></div>


<div class="viewcode-block" id="TimedQueue"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_TimedQueue.html#taurus.core.util.TimedQueue">[docs]</a><span class="k">class</span> <span class="nc">TimedQueue</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A FIFO that keeps all the values introduced at least for a given time.</span>
<span class="sd">    Applied to some device servers, to force States to be kept at least a minimum time.</span>
<span class="sd">    Previously named as PyTango_utils.device.StateQueue</span>
<span class="sd">    pop(): The value is removed only if delete_time has been reached.</span>
<span class="sd">    at least 1 value is always kept in the list</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the list with a sequence or an initial value. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">operator</span><span class="o">.</span><span class="n">isSequenceType</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
            <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="TimedQueue.append"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_TimedQueue.html#taurus.core.util.TimedQueue.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">keep</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Inserts a tuple with (value,insert_time,delete_time=now+keep) &quot;&quot;&quot;</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">now</span> <span class="o">+</span> <span class="n">keep</span><span class="p">)</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span></div>

<div class="viewcode-block" id="TimedQueue.pop"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_TimedQueue.html#taurus.core.util.TimedQueue.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the indicated value, or the first one; but removes only if delete_time has been reached.</span>
<span class="sd">        All values are returned at least once.</span>
<span class="sd">        When the queue has only a value, it is not deleted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># The list is empty</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">s</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">now</span> <span class="o">&lt;</span> <span class="n">t2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="TimedQueue.index"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_TimedQueue.html#taurus.core.util.TimedQueue.index">[docs]</a>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>
        <span class="k">return</span> <span class="kc">None</span></div>

    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">obj</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="self_locked"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util.html#taurus.core.util.self_locked">[docs]</a><span class="k">def</span> <span class="nf">self_locked</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">reentrant</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Decorator to make thread-safe class members</span>
<span class="sd">       Decorator to create thread-safe objects.</span>

<span class="sd">       .. warning::</span>

<span class="sd">            - With Lock() this decorator should not be used to decorate</span>
<span class="sd">              nested functions; it will cause Deadlock!</span>
<span class="sd">            - With RLock this problem is avoided ... but you should rely more</span>
<span class="sd">              on python threading&#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">threading</span>

    <span class="k">def</span> <span class="nf">lock_fun</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lock&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">reentrant</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lock&#39;</span><span class="p">,</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;lock&#39;</span><span class="p">,</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;trace&#39;</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;trace&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">acquire</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;locked: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="o">.</span><span class="n">release</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">:</span>
                <span class="nb">print</span> <span class="s2">&quot;released: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">lock_fun</span></div>


<div class="viewcode-block" id="ThreadDict"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict">[docs]</a><span class="k">class</span> <span class="nc">ThreadDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; Thread safe dictionary with redefinable read/write methods and a</span>
<span class="sd">    background thread for hardware update.  All methods are thread-safe using</span>
<span class="sd">    *@self_lock* decorator.</span>

<span class="sd">    .. note::</span>
<span class="sd">        any method decorated in this way CANNOT call other decorated methods!</span>
<span class="sd">        All values of the dictionary will be automatically updated in a separate</span>
<span class="sd">        Thread using read_method provided. Any value overwritten in the dict</span>
<span class="sd">        should launch the write_method.</span>

<span class="sd">    Briefing::</span>

<span class="sd">        a[2] equals to a[2]=read_method(2)</span>
<span class="sd">        a[2]=1 equals to a[2]=write_method(2,1)&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timewait</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">read_method</span> <span class="o">=</span> <span class="n">read_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_method</span> <span class="o">=</span> <span class="n">write_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timewait</span> <span class="o">=</span> <span class="n">timewait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">threaded</span> <span class="o">=</span> <span class="n">threaded</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_threadkeys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_cycle_start</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># equals to self.__class__.__base__ or type(self).__bases__[0]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">mro</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>

<div class="viewcode-block" id="ThreadDict.tracer"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.tracer">[docs]</a>    <span class="k">def</span> <span class="nf">tracer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">):</span>
        <span class="nb">print</span> <span class="n">text</span></div>

<div class="viewcode-block" id="ThreadDict.start"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.start">[docs]</a>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">threading</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">threaded</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_Thread&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Event</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span><span class="o">.</span><span class="n">setDaemon</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThreadDict.stop"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.stop">[docs]</a>    <span class="k">def</span> <span class="nf">stop</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">threaded</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;event&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">set</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_Thread&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span></div>

<div class="viewcode-block" id="ThreadDict.alive"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.alive">[docs]</a>    <span class="k">def</span> <span class="nf">alive</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_Thread&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_Thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="c1"># dict.__del__(self)</span>

<div class="viewcode-block" id="ThreadDict.run"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">isSet</span><span class="p">():</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">threadkeys</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1">#@todo It must be checked wich method for reading is better for thread_safe</span>
                    <span class="k">if</span> <span class="kc">True</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">hw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="c1"># try this alternative in case of deadlock (it could need</span>
                    <span class="c1"># extra locks inside read_method)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_method</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_method</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hw</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timewait</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">isSet</span><span class="p">():</span>
                    <span class="k">break</span>
            <span class="n">timewait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_timewait</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">event</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">timewait</span><span class="p">)</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.get_last_update"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.get_last_update">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_update</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.set_last_update"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.set_last_update">[docs]</a>    <span class="k">def</span> <span class="nf">set_last_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.get_last_cycle_start"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.get_last_cycle_start">[docs]</a>    <span class="k">def</span> <span class="nf">get_last_cycle_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_cycle_start</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.set_last_cycle_start"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.set_last_cycle_start">[docs]</a>    <span class="k">def</span> <span class="nf">set_last_cycle_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_cycle_start</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.get_timewait"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.get_timewait">[docs]</a>    <span class="k">def</span> <span class="nf">get_timewait</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timewait</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.set_timewait"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.set_timewait">[docs]</a>    <span class="k">def</span> <span class="nf">set_timewait</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timewait</span> <span class="o">=</span> <span class="n">value</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.append"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threadkeys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_threadkeys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.threadkeys"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.threadkeys">[docs]</a>    <span class="k">def</span> <span class="nf">threadkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_threadkeys</span><span class="p">[:]</span></div>

    <span class="nd">@self_locked</span>
    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">hw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; This method launches a read_method execution if there&#39;s no thread on charge of doing that or if the hw flag is set to True. &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">hw</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">threaded</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_method</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_method</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

    <span class="nd">@self_locked</span>
    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">hw</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; This method launches a write_method execution if the hw flag is not explicitly set to False. &#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="k">if</span> <span class="n">hw</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_method</span><span class="p">:</span>
            <span class="c1"># It implies that a key will not be added here to read thread!</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_method</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">]))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="nd">@self_locked</span>
<div class="viewcode-block" id="ThreadDict.get"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ThreadDict.html#taurus.core.util.ThreadDict.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">time</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">threaded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_method</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_method</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_update</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

    <span class="c1">#__getitem__ = self_locked(dict.__getitem__)</span>
    <span class="c1">#__setitem__ = self_locked(dict.__setitem__)</span>
    <span class="fm">__delitem__</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="fm">__delitem__</span><span class="p">)</span>
    <span class="fm">__contains__</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="fm">__contains__</span><span class="p">)</span>
    <span class="fm">__iter__</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="fm">__iter__</span><span class="p">)</span>

    <span class="n">pop</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">)</span>
    <span class="c1">#@self_locked</span>
    <span class="c1"># def pop(self,k,d=None):</span>
    <span class="c1"># if k in self.keys():</span>
    <span class="c1"># self.stop()</span>
    <span class="c1">#d = dict.pop(self,k)</span>
    <span class="c1"># self.start()</span>
    <span class="c1"># return d</span>

    <span class="nd">@self_locked</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;{&quot;</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">dict</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="p">))])</span> <span class="o">+</span> <span class="s2">&quot;}&quot;</span>

    <span class="nd">@self_locked</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;{</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">dict</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="bp">self</span><span class="p">))])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">}&quot;</span>
    <span class="c1">#__str__ = self_locked(dict.__str__)</span>
    <span class="c1">#__repr__ = self_locked(dict.__repr__)</span>

    <span class="c1">#get = self_locked(dict.get)</span>
    <span class="n">has_key</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">has_key</span><span class="p">)</span>
    <span class="n">update</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">)</span>
    <span class="n">copy</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">copy</span><span class="p">)</span>

    <span class="n">keys</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">keys</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">items</span><span class="p">)</span>
    <span class="n">iterkeys</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">iterkeys</span><span class="p">)</span>
    <span class="n">itervalues</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">itervalues</span><span class="p">)</span>
    <span class="n">iteritems</span> <span class="o">=</span> <span class="n">self_locked</span><span class="p">(</span><span class="nb">dict</span><span class="o">.</span><span class="n">iteritems</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">SortedDict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class implements a dictionary that returns keys in the same order they were inserted. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">other</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This method modifies the sorting of the dictionary overriding the existing sort key.</span>
<span class="sd">        :param key: it can be a sequence containing all the keys already existing in the dictionary</span>
<span class="sd">                    or a callable providing a sorting key algorithm.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">operator</span>
        <span class="k">if</span> <span class="n">operator</span><span class="o">.</span><span class="n">isCallable</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="nb">dict</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="s1">&#39;items&#39;</span><span class="p">):</span>
            <span class="n">other</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">other</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">fromkeys</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">SortedDict</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">d</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes key and returns its (self[key] or d or None)&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">popitem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes and returns last key,value pair&quot;&quot;&quot;</span>
        <span class="n">k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">[:]</span>

    <span class="k">def</span> <span class="nf">values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iteritems</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">iterkeys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">itervalues</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keys</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">collections</span> <span class="k">import</span> <span class="n">defaultdict</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">class</span> <span class="nc">defaultdict</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">default_factory</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span>
                    <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">default_factory</span><span class="p">,</span> <span class="s1">&#39;__call__&#39;</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;first argument must be callable&#39;</span><span class="p">)</span>
            <span class="nb">dict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="o">=</span> <span class="n">default_factory</span>

        <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="fm">__missing__</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="k">def</span> <span class="nf">__reduce__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">,</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="n">args</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__copy__</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">__copy__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
            <span class="kn">import</span> <span class="nn">copy</span>
            <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">,</span>
                              <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>

        <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;defaultdict(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">,</span>
                                            <span class="nb">dict</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>


<div class="viewcode-block" id="defaultdict_fromkey"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_defaultdict_fromkey.html#taurus.core.util.defaultdict_fromkey">[docs]</a><span class="k">class</span> <span class="nc">defaultdict_fromkey</span><span class="p">(</span><span class="n">defaultdict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a dictionary with a default_factory function that creates new elements using key as argument.</span>
<span class="sd">    Usage : new_dict = defaultdict_fromkey(method); where method like (lambda key: return new_obj(key))</span>
<span class="sd">    Each time that new_dict[key] is called with a key that doesn&#39;t exist, method(key) is used to create the value</span>
<span class="sd">    Copied from PyAlarm device server</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__missing__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="bp">self</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_factory</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="CaselessDefaultDict"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_CaselessDefaultDict.html#taurus.core.util.CaselessDefaultDict">[docs]</a><span class="k">class</span> <span class="nc">CaselessDefaultDict</span><span class="p">(</span><span class="n">defaultdict_fromkey</span><span class="p">,</span> <span class="n">CaselessDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; a join venture between caseless and default dict</span>
<span class="sd">    This class merges the two previous ones.</span>
<span class="sd">    This declaration equals to::</span>

<span class="sd">        CaselessDefaultDict = type(&#39;CaselessDefaultType&#39;,(CaselessDict,defaultdict_fromkey),{})</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">defaultdict_fromkey</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="DefaultThreadDict"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_DefaultThreadDict.html#taurus.core.util.DefaultThreadDict">[docs]</a><span class="k">class</span> <span class="nc">DefaultThreadDict</span><span class="p">(</span><span class="n">defaultdict_fromkey</span><span class="p">,</span> <span class="n">ThreadDict</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;a join venture between thread and default dict</span>
<span class="sd">    This class merges the two previous ones.</span>
<span class="sd">    @todo This two classes are not yet well integrated ... the way a new key is added to the dict must be rewritten explicitly.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">read_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">write_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timewait</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">threaded</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">defaultdict_fromkey</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">default_factory</span><span class="p">)</span>
        <span class="n">ThreadDict</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">read_method</span><span class="p">,</span>
                            <span class="n">write_method</span><span class="p">,</span> <span class="n">timewait</span><span class="p">,</span> <span class="n">threaded</span><span class="p">)</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="getDictAsTree"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util.html#taurus.core.util.getDictAsTree">[docs]</a><span class="k">def</span> <span class="nf">getDictAsTree</span><span class="p">(</span><span class="n">dct</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This method will print a recursive dict in a tree-like</span>
<span class="sd">       shape::</span>

<span class="sd">           &gt;&gt;&gt; print getDictAsTree({&#39;A&#39;:{&#39;B&#39;:[1,2],&#39;C&#39;:[3]}})&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">add_to_level</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span> <span class="s1">&#39;with key &quot;</span><span class="si">%s</span><span class="s1">&quot;&#39;</span> <span class="o">%</span> <span class="n">k</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)])</span>
                <span class="n">lines</span> <span class="o">+=</span> <span class="n">add_to_level</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">set</span><span class="p">]:</span>  <span class="c1"># End of recursion</span>
            <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">lines</span> <span class="o">+=</span> <span class="n">add_to_level</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">l</span> <span class="o">+</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">)])</span>
        <span class="k">return</span> <span class="n">lines</span>
    <span class="n">ls</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">add_to_level</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dct</span><span class="p">)]</span>
    <span class="nb">print</span> <span class="s1">&#39;lines are : </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">ls</span>
    <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ls</span><span class="p">)</span></div>


<div class="viewcode-block" id="ArrayBuffer"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer">[docs]</a><span class="k">class</span> <span class="nc">ArrayBuffer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;A data buffer which internally uses a preallocated numpy.array.</span>
<span class="sd">    An ArrayBuffer will only present the actual contents, not the full internal</span>
<span class="sd">    buffer, so when appending or extending, it behaves as if dynamic</span>
<span class="sd">    reallocation was taking place.</span>

<span class="sd">    The contents of the class:`ArrayBuffer` can be accessed as if it was a numpy</span>
<span class="sd">    array (i.e slicing notation like b[2:3], b[:,2], b[-1],... are all valid).</span>

<span class="sd">    For retrieving the full contents, see :meth:`ArrayBuffer.contents` and</span>
<span class="sd">    :meth:`ArrayBuffer.toArray`</span>

<span class="sd">    On creation, a given initial internal buffer and a maximum size are set. If</span>
<span class="sd">    the maximum size is larger than the original internal buffer, this will be</span>
<span class="sd">    automatically grown in geometrical steps if needed to accommodate the</span>
<span class="sd">    contents, up to the maximum size. Once the contents fill the maximum size,</span>
<span class="sd">    appending or extending the contents will result in older contents being</span>
<span class="sd">    discarded (in a FIFO way)</span>

<span class="sd">    The :meth:`append` and meth:`extend` methods are designed to be cheap</span>
<span class="sd">    (especially if the internal buffer size is already at the maximum size), at</span>
<span class="sd">    the expense of memory usage&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">maxSize</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Creator.</span>

<span class="sd">        :param buffer: (numpy.array) a numpy.array suitable to be used as the</span>
<span class="sd">                       internal buffer.</span>

<span class="sd">        :param maxSize: (int) Maximum size of the internal buffer. The internal</span>
<span class="sd">                        buffer length will be allowed to grow up to this value.</span>
<span class="sd">                        If maxSize=0 (default), the maximum size will be that of</span>
<span class="sd">                        the given buffer</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="o">=</span> <span class="n">buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">maxSize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span><span class="o">.</span><span class="n">__getslice__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ArrayBuffer with contents = </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span><span class="o">.</span><span class="n">__nonzero__</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span><span class="o">.</span><span class="fm">__setitem__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__setslice__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="ow">or</span> <span class="n">j</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span><span class="o">.</span><span class="n">__setslice__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<div class="viewcode-block" id="ArrayBuffer.resizeBuffer"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.resizeBuffer">[docs]</a>    <span class="k">def</span> <span class="nf">resizeBuffer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">newlen</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;resizes the internal buffer&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">newlen</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">=</span> <span class="n">newlen</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">newlen</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># first try to resize in-place</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">numpy</span>
            <span class="c1"># if not possible, do it by copying</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="ArrayBuffer.append"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.append">[docs]</a>    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; similar to the append method in a list, except that once the maximum</span>
<span class="sd">        buffer size is reached, elements get discarded on the begginning to keep</span>
<span class="sd">        the size within the limit</span>

<span class="sd">        :param x: (scalar) element to be appended</span>

<span class="sd">        .. seealso:: :meth:`extend`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">resizeBuffer</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span><span class="p">))</span>
                <span class="c1"># recursively call itself again after resizing</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moveLeft</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">+=</span> <span class="mi">1</span></div>

<div class="viewcode-block" id="ArrayBuffer.extend"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.extend">[docs]</a>    <span class="k">def</span> <span class="nf">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; similar to the extend method of a list, except that once the maximum</span>
<span class="sd">        buffer size is reached, elements get discarded on the begginning to keep</span>
<span class="sd">        the size within the limit</span>

<span class="sd">        :param a: (numpy.array) array of elements to append</span>

<span class="sd">        .. seealso:: :meth:`append`, :meth:`extendLeft`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">newend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">+</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">newend</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">:</span><span class="n">newend</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">=</span> <span class="n">newend</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resizeBuffer</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span><span class="p">))</span>
            <span class="c1"># recursively call itself again after resizing</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">moveLeft</span><span class="p">(</span><span class="n">newend</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">:]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">):]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span></div>

<div class="viewcode-block" id="ArrayBuffer.extendLeft"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.extendLeft">[docs]</a>    <span class="k">def</span> <span class="nf">extendLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Prepends data to the current contents. Note that, contrary to the</span>
<span class="sd">        extent method, no data will be discarded if the maximum size limit is</span>
<span class="sd">        reached. Instead, an exception will be raised.</span>

<span class="sd">        :param a: (numpy.array) array of elements to append</span>

<span class="sd">        .. seealso:: :meth:`extend`&#39;&#39;&#39;</span>
        <span class="n">len_a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">newend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">+</span> <span class="n">len_a</span>
        <span class="k">if</span> <span class="n">newend</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="n">len_a</span><span class="p">:</span><span class="n">newend</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span>
                <span class="mi">0</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span>  <span class="c1"># move the contents to the right</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">len_a</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">=</span> <span class="n">newend</span>
        <span class="k">elif</span> <span class="n">newend</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resizeBuffer</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span><span class="p">))</span>
            <span class="c1"># recursively call itself again after resizing</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">extendLeft</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Maximum buffer size cannot be exceeded when calling extendLeft &#39;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ArrayBuffer.moveLeft"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.moveLeft">[docs]</a>    <span class="k">def</span> <span class="nf">moveLeft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;discards n elements from the begginning to make space at the end of</span>
<span class="sd">        the buffer. Moves all elements n positions to the left and the contents</span>
<span class="sd">        size gets decreased by n</span>

<span class="sd">        **Note:** if n is larger or equal than the maximum buffer size, the</span>
<span class="sd">        whole buffer is wiped</span>

<span class="sd">        :param n: (int)&#39;&#39;&#39;</span>
        <span class="n">newend</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">newend</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">=</span> <span class="n">newend</span></div>

<div class="viewcode-block" id="ArrayBuffer.contents"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.contents">[docs]</a>    <span class="k">def</span> <span class="nf">contents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the array of the contents that have already been filled. Note</span>
<span class="sd">        that it does not return the full buffer, only those elements that have</span>
<span class="sd">        been already set.</span>

<span class="sd">        It is equivalent to b[:]</span>

<span class="sd">        :return: (numpy.array) array of contents</span>

<span class="sd">        .. seealso:: :meth:`toArray`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__buffer</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">__end</span><span class="p">]</span></div>

<div class="viewcode-block" id="ArrayBuffer.toArray"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.toArray">[docs]</a>    <span class="k">def</span> <span class="nf">toArray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns a copy of the array of the contents. It is equivalent to</span>
<span class="sd">        ``b.contents.copy()``</span>

<span class="sd">        :return: (numpy.array) copy of array of contents</span>

<span class="sd">        .. seealso:: :meth:`contents`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contents</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="ArrayBuffer.contentsSize"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.contentsSize">[docs]</a>    <span class="k">def</span> <span class="nf">contentsSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Equivalent to len(b)</span>

<span class="sd">        :return: (int) length of the current contents of the ArrayBuffer (not</span>
<span class="sd">                 the maximum size of the buffer)</span>

<span class="sd">        .. seealso:: :meth:`maxSize`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span></div>

<div class="viewcode-block" id="ArrayBuffer.bufferSize"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.bufferSize">[docs]</a>    <span class="k">def</span> <span class="nf">bufferSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the current size of the internal buffer</span>

<span class="sd">        :return: (int) lcurrent length of the internal buffer</span>

<span class="sd">        .. seealso:: :meth:`contentsSize`, :meth:`maxSize`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span></div>

<div class="viewcode-block" id="ArrayBuffer.maxSize"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.maxSize">[docs]</a>    <span class="k">def</span> <span class="nf">maxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns the maximum size of the internal buffer, beyond which the</span>
<span class="sd">        ArrayBuffer starts discarding elements when appending</span>

<span class="sd">        :return: (int) maximum length of the internal buffer</span>

<span class="sd">        .. seealso:: :meth:`contentsSize`, :meth:`append`, :meth:`extend`, :meth:`isFull`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span></div>

<div class="viewcode-block" id="ArrayBuffer.setMaxSize"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.setMaxSize">[docs]</a>    <span class="k">def</span> <span class="nf">setMaxSize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">maxSize</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Sets the maximum size of the internal buffer, beyond which the</span>
<span class="sd">        ArrayBuffer starts discarding elements when appending</span>

<span class="sd">        :param maxSize: (int) maximum length of the internal buffer</span>

<span class="sd">        .. seealso:: :meth:`contentsSize`, :meth:`append`, :meth:`extend`, :meth:`isFull`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">maxSize</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Cannot set a maximum size below the current buffer size (</span><span class="si">%i</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bsize</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span> <span class="o">=</span> <span class="n">maxSize</span></div>

<div class="viewcode-block" id="ArrayBuffer.isFull"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.isFull">[docs]</a>    <span class="k">def</span> <span class="nf">isFull</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Whether the contents fill the whole of the internal buffer</span>

<span class="sd">        :return: (bool) True if the contents fill the maximum size. False otherwise.</span>

<span class="sd">        .. seealso:: :meth:`maxSize`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__end</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__maxSize</span></div>

<div class="viewcode-block" id="ArrayBuffer.remainingSize"><a class="viewcode-back" href="../../../../devel/api/taurus/core/util/_ArrayBuffer.html#taurus.core.util.ArrayBuffer.remainingSize">[docs]</a>    <span class="k">def</span> <span class="nf">remainingSize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the remaining free space in the internal buffer (e.g., 0 if it is full)</span>

<span class="sd">        :return: (int) length of the unused space in the internal buffer</span>

<span class="sd">        .. seealso:: :meth:`contentsSize`, :meth:`maxSize`,</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxSize</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">contentsSize</span><span class="p">()</span></div></div>


<span class="k">def</span> <span class="nf">chunks</span><span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Generator which yields successive n-sized chunks from l&#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">n</span><span class="p">]</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'4.1.2-alpha',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>