

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>taurus.qt.qtgui.tree.taurusdevicetree &mdash; taurus 3.7.5 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../../search.html"/>
    <link rel="top" title="taurus 3.7.5 documentation" href="../../../../../index.html"/>
        <link rel="up" title="Module code" href="../../../../index.html"/> 

  
  <script src="../../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../../index.html" class="icon icon-home"> taurus
          

          
            
            <img src="../../../../../_static/taurus.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                3.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference external" href="http://www.taurus-scada.org">Home Page</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/taurus-org/taurus">Project Page</a></li>
<li class="toctree-l1"><a class="reference external" href="http://pypi.python.org/pypi/taurus">Download from PyPI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../docs.html">Taurus 3.7 documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../../other_versions.html">Docs for other Taurus versions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../../../../index.html">taurus</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../../../../index.html">Module code</a> &raquo;</li>
      
    <li>taurus.qt.qtgui.tree.taurusdevicetree</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for taurus.qt.qtgui.tree.taurusdevicetree</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>

<span class="c1">#############################################################################</span>
<span class="c1">##</span>
<span class="c1">## This file is part of Taurus</span>
<span class="c1">## </span>
<span class="c1">## http://taurus-scada.org</span>
<span class="c1">##</span>
<span class="c1">## Copyright 2011 CELLS / ALBA Synchrotron, Bellaterra, Spain</span>
<span class="c1">## </span>
<span class="c1">## Taurus is free software: you can redistribute it and/or modify</span>
<span class="c1">## it under the terms of the GNU Lesser General Public License as published by</span>
<span class="c1">## the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1">## (at your option) any later version.</span>
<span class="c1">## </span>
<span class="c1">## Taurus is distributed in the hope that it will be useful,</span>
<span class="c1">## but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1">## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1">## GNU Lesser General Public License for more details.</span>
<span class="c1">## </span>
<span class="c1">## You should have received a copy of the GNU Lesser General Public License</span>
<span class="c1">## along with Taurus.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">##</span>
<span class="c1">#############################################################################</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">taurusdevicetree.py: </span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TaurusDevTree&quot;</span><span class="p">,</span><span class="s2">&quot;TaurusSearchTree&quot;</span><span class="p">,</span><span class="s2">&quot;TaurusDevTreeOptions&quot;</span><span class="p">]</span> <span class="c1">#,&quot;SearchEdit&quot;] #&quot;TaurusTreeNode&quot;]</span>

<span class="kn">import</span> <span class="nn">time</span><span class="o">,</span><span class="nn">os</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="k">import</span> <span class="n">partial</span>
<span class="kn">import</span> <span class="nn">PyTango</span> <span class="c1"># to change!!</span>

<span class="k">try</span><span class="p">:</span><span class="kn">import</span> <span class="nn">icons_dev_tree</span>
<span class="k">except</span><span class="p">:</span><span class="n">icons_dev_tree</span> <span class="o">=</span> <span class="kc">None</span>

<span class="kn">from</span> <span class="nn">taurus.external.qt</span> <span class="k">import</span> <span class="n">Qt</span>

<span class="kn">import</span> <span class="nn">taurus.core</span>
<span class="kn">from</span> <span class="nn">taurus.core.util.colors</span> <span class="k">import</span> <span class="n">DEVICE_STATE_PALETTE</span><span class="p">,</span><span class="n">ATTRIBUTE_QUALITY_PALETTE</span>
<span class="kn">from</span> <span class="nn">taurus.core.util.containers</span> <span class="k">import</span> <span class="n">CaselessDict</span>
<span class="kn">from</span> <span class="nn">taurus.core.tango.search</span> <span class="k">import</span> <span class="o">*</span> <span class="c1">#@TODO: Avoid implicit imports</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtcore.util.emitter</span> <span class="k">import</span> <span class="n">SingletonWorker</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtcore.mimetypes</span> <span class="k">import</span> <span class="o">*</span>  <span class="c1">#@TODO: Avoid implicit imports</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtcore.util</span> <span class="k">import</span> <span class="n">properties</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtcore.util.properties</span> <span class="k">import</span> <span class="n">djoin</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.base</span> <span class="k">import</span> <span class="n">TaurusBaseComponent</span><span class="p">,</span> <span class="n">TaurusBaseWidget</span>
<span class="kn">from</span> <span class="nn">taurus.qt.qtgui.container</span> <span class="k">import</span> <span class="n">TaurusWidget</span>

<span class="n">TREE_ITEM_MIME_TYPE</span> <span class="o">=</span> <span class="s1">&#39;application/x-qabstractitemmodeldatalist&#39;</span>

<span class="c1">###############################################################################</span>

<span class="k">class</span> <span class="nc">TaurusTreeNodeContainer</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Interface that provides Node-focused methods to TaurusDevTree</span>
<span class="sd">    This methods should be moved to TaurusDevTreeNode class when it will be able to retrieve currentItem from Tree.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_icon_map</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#A dictionary like {device_regexp:pixmap_url}</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;This class is just an interface, do not instantiate it!&#39;</span><span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">setIconMap</span><span class="p">(</span><span class="n">klass</span><span class="p">,</span><span class="n">filters</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;A dictionary like {device_regexp:pixmap_url}&quot;&quot;&quot;</span>
        <span class="n">klass</span><span class="o">.</span><span class="n">_icon_map</span> <span class="o">=</span> <span class="n">filters</span>
        
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">getIconMap</span><span class="p">(</span><span class="n">klass</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">klass</span><span class="o">.</span><span class="n">_icon_map</span>
    
    <span class="k">def</span> <span class="nf">createItem</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;createItem(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="n">text</span><span class="p">))</span>
        <span class="n">USE_TREE_NODE</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">USE_TREE_NODE</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="n">TaurusTreeNode</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">item</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">text</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">item</span><span class="o">.</span><span class="n">isAttribute</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">item</span><span class="o">.</span><span class="n">DeviceName</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">draggable</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">item</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">text</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">UnicodeUTF8</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setNodeParent</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">adminNode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">parentNode</span> <span class="ow">or</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">item</span><span class="o">.</span><span class="n">font</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">parentNode</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">setBold</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">setItalic</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">item</span><span class="o">.</span><span class="n">setFont</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
        <span class="n">item</span><span class="o">.</span><span class="n">parentTree</span> <span class="o">=</span> <span class="bp">self</span> <span class="c1">#hook used to call external methods with item as single argument</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">[</span><span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">item</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeIcon</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">icon</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_list</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">item</span>

    <span class="c1">###########################################################################</span>
    <span class="c1"># Item members methods</span>
    
    <span class="k">def</span> <span class="nf">setNodeParent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">parent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Used to know which parent attributes must be expanded if found &quot;&quot;&quot;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">parentNode</span> <span class="o">=</span> <span class="n">parent</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        
    <span class="k">def</span> <span class="nf">setNodeAdmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">admin</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Used to assign a controller to its controlled devices in the tree &quot;&quot;&quot;</span>
        <span class="n">node</span><span class="o">.</span><span class="n">adminNode</span> <span class="o">=</span> <span class="n">admin</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">admin</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">admin</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">getNodeAdmin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">adminNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">isCallable</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">adminNode</span><span class="p">)</span> <span class="k">else</span> <span class="n">node</span><span class="o">.</span><span class="n">adminNode</span>
        
    <span class="k">def</span> <span class="nf">getNodeText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Get the text of the node as shown in the tree, @full allows to get the first word or the whole text&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;text&#39;</span><span class="p">):</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">full</span><span class="p">:</span> <span class="k">return</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">txt</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>
    
    <span class="k">def</span> <span class="nf">getNodeDeviceName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;DeviceName&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">))</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">getNodeParentName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">parentNode</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">getNodePath</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns all parent nodes prior to current &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="n">p</span><span class="p">,</span><span class="n">path</span><span class="p">,</span><span class="n">names</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">parentNode</span><span class="p">,[],[]</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
            <span class="n">names</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeDeviceName</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parentNode</span>
        <span class="k">return</span> <span class="n">path</span>
        
    <span class="k">def</span> <span class="nf">getNodeAlias</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>        
        <span class="n">alias</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;AttributeAlias&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">alias</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">getNodeIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1">#self.debug(&#39;TaurusDevTree.getNodeIcon(node) not implemented, overrided in subclasses&#39;)</span>
        
        <span class="c1">#self,url = node.parentTree,&#39;&#39;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span><span class="p">,</span><span class="n">url</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="p">),</span><span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIconMap</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span> <span class="n">url</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getIconMap</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">url</span> <span class="o">=</span> <span class="n">v</span>
            <span class="c1">#if name.count(&#39;/&#39;)==2:</span>
                <span class="c1">#if any(a.startswith(name+&#39;/&#39;) for a in getArchivedAttributes()):</span>
                    <span class="c1">#url = wdir(&#39;image/icons/clock.png&#39;)</span>
                <span class="c1">#else:</span>
                    <span class="c1">#url = wdir(&#39;image/equips/icon-%s.gif&#39;%name.split(&#39;/&#39;)[2].split(&#39;-&#39;)[0].lower())</span>
            <span class="c1">#elif name.count(&#39;/&#39;)==3:</span>
                <span class="c1">#url = filterAttributes(name) or wdir(&#39;image/icons/closetab.png&#39;)</span>
            <span class="c1">#else:</span>
                <span class="c1">#url = wdir(&#39;image/equips/icon-%s.gif&#39;%name.lower())</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">url</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">url</span><span class="p">):</span> <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">getNodeDraggable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method will return True only if the selected node belongs to a numeric Tango attribute &quot;&quot;&quot;</span>
        <span class="n">numtypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevDouble</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevFloat</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevLong</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevLong64</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevULong</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevShort</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevUShort</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevBoolean</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="n">drag</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">isAttribute</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;DeviceName&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;/&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">DeviceName</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">name</span>
            <span class="k">if</span> <span class="n">name</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="c1">#A Device Name</span>
                <span class="n">drag</span> <span class="o">=</span> <span class="n">name</span><span class="c1">#+&#39;/state&#39; #False</span>
            <span class="k">elif</span> <span class="n">name</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="c1">#An Attribute Name</span>
                <span class="c1">#dtype = PyTango.AttributeProxy(name).get_config().data_type</span>
                <span class="c1">#if dtype in numtypes: self.debug(&#39;The attribute %s is a Numeric Attribute&#39;%(name))</span>
                <span class="n">drag</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;draggable&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">name</span>
                <span class="c1">#else: drag = False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Node(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">): drag: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">node</span><span class="o">.</span><span class="n">isAttribute</span><span class="p">,</span><span class="n">node</span><span class="o">.</span><span class="n">DeviceName</span><span class="p">,</span><span class="n">drag</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">drag</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">traceback</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">False</span> 
            
    <span class="c1">###########################################################################</span>
    <span class="c1"># Context Menu Actions</span>
    
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">setDefaultPanelClass</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
        <span class="n">TaurusTreeNodeContainer</span><span class="o">.</span><span class="n">_defaultClass</span> <span class="o">=</span> <span class="n">other</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">defaultPanelClass</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">TaurusTreeNodeContainer</span><span class="p">,</span><span class="s1">&#39;_defaultClass&#39;</span><span class="p">):</span> 
            <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.panel</span> <span class="k">import</span> <span class="n">TaurusDevicePanel</span>
            <span class="n">TaurusTreeNodeContainer</span><span class="o">.</span><span class="n">_defaultClass</span> <span class="o">=</span> <span class="n">TaurusDevicePanel</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">TaurusTreeNodeContainer</span><span class="o">.</span><span class="n">_defaultClass</span>
        <span class="k">return</span> <span class="n">obj</span>
            
    <span class="k">def</span> <span class="nf">showPanel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Display widget taurusDevicePanel&#39;&#39;&#39;</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">()</span>
        <span class="n">nameclass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">defaultPanelClass</span><span class="p">()()</span>
        <span class="n">nameclass</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">nameclass</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1">##nameclass.setSpectraAtkMode(True)</span>
        <span class="c1">#Dialog is used to make new floating panels persistent</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nameclass</span><span class="p">,</span><span class="n">TaurusWidget</span><span class="p">):</span>
            <span class="n">PopupDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">showProperties</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Display widget TaurusPropTable&#39;&#39;&#39;</span>
        <span class="kn">import</span> <span class="nn">taurus.qt.qtgui.table</span>
        <span class="n">device</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">()</span>
        <span class="n">nameclass</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">qt</span><span class="o">.</span><span class="n">qtgui</span><span class="o">.</span><span class="n">table</span><span class="o">.</span><span class="n">TaurusPropTable</span><span class="p">()</span>
        <span class="n">nameclass</span><span class="o">.</span><span class="n">setTable</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
        <span class="n">nameclass</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="c1">#Dialog is used to make new floating panels persistent</span>
        <span class="n">PopupDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nameclass</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">addToPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method will send a signal with the current selected node &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSelectedNodes</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeAlias</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In addToPlot(</span><span class="si">%s</span><span class="s1">-&gt;</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">attr</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">addAttrToPlot</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span>
        
    <span class="k">def</span> <span class="nf">addAttrToPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method will send a signal with the given attr name, in a separate method to be called with a pre-filled list  &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;addAttrSelected(QStringList)&quot;</span><span class="p">),</span><span class="n">Qt</span><span class="o">.</span><span class="n">QStringList</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="p">)]))</span>

    <span class="k">def</span> <span class="nf">removeFromPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method will send a signal with the current selected node &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSelectedNodes</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
            <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
            <span class="n">attr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="s1">&#39;AttributeAlias&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">removeAttrFromPlot</span><span class="p">(</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">return</span>
        
    <span class="k">def</span> <span class="nf">removeAttrFromPlot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method will send a signal with the given attr name, in a separate method to be called with a pre-filled list &quot;&quot;&quot;</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;removeAttrSelected(QStringList)&quot;</span><span class="p">),</span><span class="n">Qt</span><span class="o">.</span><span class="n">QStringList</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">attr</span><span class="p">)]))</span>


<span class="c1">###############################################################################</span>
        
<div class="viewcode-block" id="TaurusDevTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree">[docs]</a><span class="k">class</span> <span class="nc">TaurusDevTree</span><span class="p">(</span><span class="n">TaurusTreeNodeContainer</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="p">,</span> <span class="n">TaurusBaseWidget</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    This widget displays a list of servers, devices or instances.</span>
<span class="sd">    To set a new Model use either setModel(filters), addModels(list), setFilters(...) or loadTree(filters)</span>
<span class="sd">    setModel and loadTree are equivalent; adding a new branch to the tree</span>
<span class="sd">    addModels merges the tree with new models</span>
<span class="sd">    setFilters clears previous models and adds new one</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">__pyqtSignals__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;modelChanged(const QString &amp;)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;deviceSelected(QString)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;addAttrSelected(QStringList)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;removeAttrSelected(QStringList)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;refreshTree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nodeFound&quot;</span>
        <span class="p">)</span>
    <span class="n">__properties__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s1">&#39;ModelInConfig&#39;</span><span class="p">,</span>
        <span class="s1">&#39;modifiableByUser&#39;</span><span class="p">,</span>
        <span class="c1">#&#39;useParentModel&#39;,</span>
        <span class="s1">&#39;Filters&#39;</span><span class="p">,</span>
        <span class="s1">&#39;Source&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ShowAlias&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ShowColors&#39;</span><span class="p">,</span>
        <span class="s1">&#39;ShowNotExported&#39;</span><span class="p">,</span>
        <span class="s1">&#39;MaxDevices&#39;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;setTangoHost&quot;</span><span class="p">,</span>
        <span class="c1">#&quot;setModel&quot;,</span>
        <span class="c1">#&quot;setFilters&quot;,</span>
        <span class="s2">&quot;addModels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;setModelCheck&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loadTree&quot;</span><span class="p">,</span> <span class="c1">#Applies regexp filters to database</span>
        <span class="s2">&quot;setTree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;findInTree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;setIcons&quot;</span><span class="p">,</span>
        <span class="s2">&quot;expandAll&quot;</span><span class="p">,</span>
        <span class="s2">&quot;expandNode&quot;</span><span class="p">,</span>
        <span class="s2">&quot;collapseNode&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        
    <span class="n">TRACE_ALL</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">designMode</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;TaurusDevTree&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_useParentModel</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_localModel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call__init__wo_kw</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call__init__</span><span class="p">(</span><span class="n">TaurusBaseWidget</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">designMode</span><span class="o">=</span><span class="n">designMode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setObjectName</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__attr_filter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__expand</span> <span class="o">=</span><span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collapsing_search</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_nameTopItem</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">excludeFromSearch</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1">#This is a list of regular expressions to exclude objects from searches</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span> <span class="o">=</span> <span class="n">CaselessDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_list</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="c1">#NOTE: as several nodes may share the same name this list will be different from item_index.values()!!!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSelectionMode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ExtendedSelection</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">=</span><span class="p">[]</span>

        <span class="c1">#The SingletonWorker Threads are used for expanding nodes and also for loading a new tree; both objects are the same thread, but read from different queues</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__loader</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__expander</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">designMode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Loader</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Expander</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">initConfig</span><span class="p">()</span>
        
        <span class="c1">#Signal</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;itemClicked(QTreeWidgetItem *,int)&quot;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">deviceClicked</span><span class="p">)</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;nodeFound&quot;</span><span class="p">),</span><span class="bp">self</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">SLOT</span><span class="p">(</span><span class="s2">&quot;expandNode&quot;</span><span class="p">))</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">setDragDropMode</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">DragDrop</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModifiableByUser</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModelInConfig</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="c1">#We store Filters instead!</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">()</span><span class="o">.</span><span class="n">setAcceptDrops</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setDragEnabled</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setSupportedMimeTypes</span><span class="p">([</span>
            <span class="n">TAURUS_MODEL_LIST_MIME_TYPE</span><span class="p">,</span> <span class="n">TAURUS_DEV_MIME_TYPE</span><span class="p">,</span> <span class="n">TAURUS_ATTR_MIME_TYPE</span><span class="p">,</span> 
            <span class="n">TAURUS_MODEL_MIME_TYPE</span><span class="p">,</span> <span class="n">TREE_ITEM_MIME_TYPE</span><span class="p">,</span> <span class="s1">&#39;text/plain&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">setTangoHost</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">defineStyle</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Loader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loader</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__loader</span>
        <span class="k">if</span> <span class="n">loader</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loader</span> <span class="o">=</span> <span class="n">SingletonWorker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;TreeLoader&#39;</span><span class="p">,</span>
                                     <span class="n">cursor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__loader</span> <span class="o">=</span> <span class="n">loader</span>
        <span class="k">return</span> <span class="n">loader</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">Expander</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">expander</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__expander</span>
        <span class="k">if</span> <span class="n">expander</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expander</span> <span class="o">=</span> <span class="n">SingletonWorker</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;NodeExpander&#39;</span><span class="p">,</span>
                                       <span class="n">method</span><span class="o">=</span><span class="k">lambda</span> <span class="n">node</span><span class="p">,</span> <span class="n">expand</span> <span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="n">expand</span><span class="p">),</span>
                                       <span class="n">cursor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__expander</span> <span class="o">=</span> <span class="n">expander</span>
        <span class="k">return</span> <span class="n">expander</span>

<div class="viewcode-block" id="TaurusDevTree.getConfig"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getConfig">[docs]</a>    <span class="k">def</span> <span class="nf">getConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span> 
        <span class="n">properties</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.initConfig"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.initConfig">[docs]</a>    <span class="k">def</span> <span class="nf">initConfig</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializing the attributes that will be kept persitent as Qt settings.</span>
<span class="sd">        e.g. for Filters property, the following attributes are created:</span>
<span class="sd">        </span>
<span class="sd">            - self.filters</span>
<span class="sd">            - self._filters</span>
<span class="sd">            - self.setFilters</span>
<span class="sd">            - self.getFilters</span>
<span class="sd">            - self.resetFilters</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">set_property_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Models&#39;</span><span class="p">,</span><span class="s1">&#39;QStringList&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="c1">#setter = self.setFilters,</span>
            <span class="n">setter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addModels</span><span class="p">,</span> <span class="c1">#Not trivial!; it avoids QSettings erasing default model</span>
            <span class="c1">#set_callback=lambda v,s=self:v and s.loadTree(v,clear=True),</span>
            <span class="c1">#reset_callback=lambda s=self:s.setFilters(&#39;&#39;),</span>
            <span class="n">qt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">set_property_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;MaxDevices&#39;</span><span class="p">,</span><span class="s1">&#39;int&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">qt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">set_property_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ShowAlias&#39;</span><span class="p">,</span><span class="s1">&#39;bool&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">qt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">set_property_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ShowNotExported&#39;</span><span class="p">,</span><span class="s1">&#39;bool&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">qt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">properties</span><span class="o">.</span><span class="n">set_property_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;ShowColors&#39;</span><span class="p">,</span><span class="s1">&#39;bool&#39;</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">qt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">config</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>
        <span class="c1">#properties.set_property_methods(self,&#39;Expand&#39;,&#39;int&#39;,default=0)</span>
        
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TaurusDevTree.setDefaultAttrFilter"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setDefaultAttrFilter">[docs]</a>    <span class="k">def</span> <span class="nf">setDefaultAttrFilter</span><span class="p">(</span><span class="n">other</span><span class="p">):</span>
        <span class="n">TaurusDevTree</span><span class="o">.</span><span class="n">_defattrfilter</span> <span class="o">=</span> <span class="nb">staticmethod</span><span class="p">(</span><span class="n">other</span><span class="p">)</span></div>
        
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TaurusDevTree.defaultAttrFilter"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.defaultAttrFilter">[docs]</a>    <span class="k">def</span> <span class="nf">defaultAttrFilter</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">TaurusDevTree</span><span class="p">,</span><span class="s1">&#39;_defattrfilter&#39;</span><span class="p">):</span> <span class="n">TaurusDevTree</span><span class="o">.</span><span class="n">_defattrfilter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">TaurusDevTree</span><span class="o">.</span><span class="n">_defattrfilter</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.setAttrFilter"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setAttrFilter">[docs]</a>    <span class="k">def</span> <span class="nf">setAttrFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_attrfilter</span> <span class="o">=</span> <span class="n">other</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.getAttrFilter"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getAttrFilter">[docs]</a>    <span class="k">def</span> <span class="nf">getAttrFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isCallable</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;_attrfilter&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrfilter</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrfilter</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.matchAttrFilter"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.matchAttrFilter">[docs]</a>    <span class="k">def</span> <span class="nf">matchAttrFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">target</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">printf</span><span class="p">(</span><span class="n">s</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAttrFilter</span><span class="p">()</span> <span class="ow">and</span> <span class="n">isCallable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attrfilter</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attrfilter</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">printf</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">TaurusDevTree</span><span class="o">.</span><span class="n">defaultAttrFilter</span><span class="p">()</span> <span class="ow">and</span> <span class="n">isCallable</span><span class="p">(</span><span class="n">TaurusDevTree</span><span class="o">.</span><span class="n">_defattrfilter</span><span class="p">):</span> <span class="k">return</span> <span class="n">TaurusDevTree</span><span class="o">.</span><span class="n">_defattrfilter</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="n">p</span><span class="o">=</span><span class="n">printf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span></div>
        
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># TaurusBaseWidget over writing methods </span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

<div class="viewcode-block" id="TaurusDevTree.sizeHint"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.sizeHint">[docs]</a>    <span class="k">def</span> <span class="nf">sizeHint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="o">.</span><span class="n">sizeHint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusDevTree.minimumSizeHint"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.minimumSizeHint">[docs]</a>    <span class="k">def</span> <span class="nf">minimumSizeHint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="o">.</span><span class="n">minimumSizeHint</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

    <span class="nd">@classmethod</span>
<div class="viewcode-block" id="TaurusDevTree.getQtDesignerPluginInfo"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getQtDesignerPluginInfo">[docs]</a>    <span class="k">def</span> <span class="nf">getQtDesignerPluginInfo</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">getQtDesignerPluginInfo</span><span class="p">()</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;taurus.qt.qtgui.tree&#39;</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Taurus Views&#39;</span>
        <span class="n">ret</span><span class="p">[</span><span class="s1">&#39;icon&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;:/designer/listview.png&quot;</span>
        <span class="k">return</span> <span class="n">ret</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.defineStyle"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.defineStyle">[docs]</a>    <span class="k">def</span> <span class="nf">defineStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;TaurusDevTree&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setHeaderLabel</span><span class="p">(</span><span class="s1">&#39;Device Browser (right-click on any element to search/show options)&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QRect</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">256</span><span class="p">,</span><span class="mi">192</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionFindInTree</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QAction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">actionFindInTree</span><span class="o">.</span><span class="n">setShortcut</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QKeySequence</span><span class="o">.</span><span class="n">Find</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">actionFindInTree</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;triggered()&quot;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">findDialog</span><span class="p">)</span>
        <span class="c1">#self.connect(self, Qt.SIGNAL(&quot;itemClicked&quot;), self.clickedEvent)</span>
        <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.table.qdictionary</span> <span class="k">import</span> <span class="n">QDictionaryEditor</span><span class="p">,</span><span class="n">QListEditor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;Edit Model Filters&#39;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span><span class="n">QListEditor</span><span class="o">.</span><span class="n">main</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">,</span>
                <span class="n">modal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Edit Model Filters&#39;</span><span class="p">,</span>
                <span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">loadTree</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="c1">#lambda:self.loadTree(</span>
                <span class="c1">#str(Qt.QInputDialog.getText(None,&#39;Set Tree Model&#39;,&#39;Enter a list of regexp separated by comma:&#39;,Qt.QLineEdit.Normal,&#39;,&#39;.join(str(f) for f in self._filters))[0])</span>
                <span class="c1">#or None)</span>
            <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;Edit Tree&#39;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span><span class="n">QDictionaryEditor</span><span class="o">.</span><span class="n">main</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">,</span><span class="n">modal</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Edit Tree&#39;</span><span class="p">,</span><span class="n">callback</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">setTree</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;Expand All&#39;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">expandAll</span><span class="p">()</span>
            <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;Collapse All&#39;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapseNode</span><span class="p">(</span><span class="n">ALL</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">(</span><span class="s1">&#39;Save Config&#39;</span><span class="p">,</span>
            <span class="k">lambda</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">saveConfigFile</span><span class="p">()</span>
            <span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;DeviceMenu&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">DeviceMenu</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DeviceMenu</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;Show Properties&#39;</span><span class="p">:</span><span class="s1">&#39;showProperties&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Refresh Tree&#39;</span><span class="p">:</span><span class="s1">&#39;refreshTree&#39;</span><span class="p">,</span>
            <span class="p">})</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;AttributeMenu&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">AttributeMenu</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">AttributeMenu</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span>  <span class="p">[</span>
            <span class="p">(</span><span class="s1">&#39;Add to trends&#39;</span><span class="p">,</span><span class="s1">&#39;addToPlot&#39;</span><span class="p">),</span>
            <span class="p">(</span><span class="s1">&#39;Remove from trends&#39;</span><span class="p">,</span><span class="s1">&#39;removeFromPlot&#39;</span><span class="p">),</span>
            <span class="p">]</span> <span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AttributeMenu</span><span class="p">]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">PyTangoArchiving.widget.history</span> <span class="k">import</span> <span class="n">show_history</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Adding show_history from archiving...&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">AttributeMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;Show History&#39;</span><span class="p">,</span><span class="n">show_history</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span> <span class="k">pass</span></div>
            
<div class="viewcode-block" id="TaurusDevTree.trace"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.trace">[docs]</a>    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">TRACE_ALL</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getLogLevel</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span><span class="mi">40</span><span class="p">,):</span>
            <span class="nb">print</span> <span class="s1">&#39;TaurusDevTree.</span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getLogLevel</span><span class="p">(),</span><span class="n">msg</span><span class="p">)</span> <span class="c1">#@TODO: use the taurus logger instead! ~~cpascual 20121121</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.setTangoHost"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setTangoHost">[docs]</a>    <span class="k">def</span> <span class="nf">setTangoHost</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tango_host</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">taurus</span><span class="o">.</span><span class="n">Database</span><span class="p">(</span><span class="n">tango_host</span><span class="p">)</span></div>
        
    <span class="c1">#model = Qt.pyqtProperty(&quot;QString&quot;, TaurusBaseWidget.getModel, </span>
                                <span class="c1">#TaurusBaseWidget.setModel, </span>
                                <span class="c1">#TaurusBaseWidget.resetModel)</span>
        
<div class="viewcode-block" id="TaurusDevTree.getModel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getModel">[docs]</a>    <span class="k">def</span> <span class="nf">getModel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span>    </div>
    
<div class="viewcode-block" id="TaurusDevTree.getModelClass"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getModelClass">[docs]</a>    <span class="k">def</span> <span class="nf">getModelClass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">list</span> <span class="c1">#taurus.core.taurusdatabase.TaurusDatabase</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.setModel"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setModel">[docs]</a>    <span class="k">def</span> <span class="nf">setModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">)</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.setModelCheck"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setModelCheck">[docs]</a>    <span class="k">def</span> <span class="nf">setModelCheck</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">model</span><span class="p">):</span>
        <span class="c1"># Called from TaurusBaseWidget.setModel()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;setModelCheck(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)[:</span><span class="mi">80</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTree</span><span class="p">(</span><span class="n">model</span><span class="p">)</span></div>
        
    <span class="nd">@Qt</span><span class="o">.</span><span class="n">pyqtSignature</span><span class="p">(</span><span class="s2">&quot;addModels(QStringList)&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TaurusDevTree.addModels"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.addModels">[docs]</a>    <span class="k">def</span> <span class="nf">addModels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelNames</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Adds models to the existing ones:</span>
<span class="sd">        :param modelNames:  (sequence&lt;str&gt;) the names of the models to be added</span>
<span class="sd">        .. seealso:: :meth:`removeModels`</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In addModels(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">modelNames</span><span class="p">)[:</span><span class="mi">80</span><span class="p">])</span>
        <span class="n">modelNames</span> <span class="o">=</span> <span class="n">split_model_list</span><span class="p">(</span><span class="n">modelNames</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getTangoDict</span><span class="p">(</span><span class="n">modelNames</span><span class="p">),</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">isSequence</span><span class="p">(</span><span class="n">modelNames</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">split_model_list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">)</span><span class="o">+</span><span class="n">modelNames</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">isMap</span><span class="p">(</span><span class="n">modelNames</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">isMap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">modelNames</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="o">=</span> <span class="n">modelNames</span></div>
        
    <span class="c1">############################################################################</span>
    <span class="c1"># Loading/Cleaning the tree</span>

    <span class="c1">#@Qt.pyqtSignature(&quot;loadTree(QString)&quot;)</span>
    <span class="c1">#def loadTree(self,filters,clear=False):</span>
        <span class="c1">#&#39;&#39;&#39;</span>
        <span class="c1">#This method show a list of instances and devices depending on the given servers in QTProperty or in another widget, </span>
        <span class="c1">#this method can be used to connect TauDevTree with another widget such as LineEdit.</span>
        <span class="c1">#&#39;&#39;&#39;</span>
        <span class="c1">#self.trace(&#39;In loadTree(%s)&#39;%str(filters))</span>
        <span class="c1">#if clear: self.setWindowTitle(&#39;TaurusDevTree:%s&#39;%str(filters))</span>
        <span class="c1">#self.setTree(self.getTangoDict(filters),clear=clear,alias=False)</span>
    
<div class="viewcode-block" id="TaurusDevTree.loadTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.loadTree">[docs]</a>    <span class="k">def</span> <span class="nf">loadTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filters</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">isString</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">assert</span> <span class="s1">&#39;{&#39;</span> <span class="ow">in</span> <span class="n">filters</span>
                    <span class="n">filters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">filters</span> <span class="o">=</span> <span class="n">split_model_list</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;loadTree(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">isMap</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span> <span class="ow">or</span> <span class="n">isSequence</span><span class="p">(</span><span class="n">filters</span><span class="p">),</span> <span class="s2">&quot;Filters have to be map, string or list type!&quot;</span>
            <span class="n">properties</span><span class="o">.</span><span class="n">set_property</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Filters&#39;</span><span class="p">,</span><span class="n">filters</span><span class="p">)</span> <span class="c1">#self._filters = filters</span>
            <span class="k">if</span> <span class="n">isSequence</span><span class="p">(</span><span class="n">filters</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;TaurusDevTree:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>
                <span class="n">dct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getTangoDict</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1">#if isMap(filters):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;TaurusDevTree:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">filters</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
                <span class="k">def</span> <span class="nf">expand_dict</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
                    <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="n">expand_dict</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;values&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">(</span><span class="n">v</span><span class="p">,))]</span> 
                <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">get_matching_devices</span><span class="p">([</span><span class="s1">&#39;*</span><span class="si">%s</span><span class="s1">*&#39;</span><span class="o">%</span><span class="n">f</span> <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">else</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">expand_dict</span><span class="p">(</span><span class="n">filters</span><span class="p">)])]</span>
                <span class="k">def</span> <span class="nf">get_devs</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">matchCl</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">t</span><span class="p">))</span>
                <span class="k">def</span> <span class="nf">expand_filter</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">expand_filter</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;values&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">get_devs</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">)</span>
                <span class="n">dct</span> <span class="o">=</span> <span class="n">expand_filter</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
            <span class="c1">#self.Loader.next([self.setTree,dct,True])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setTree</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;TaurusDeviceTree.loadTree(</span><span class="si">%s</span><span class="s1">):</span><span class="se">\n</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()))</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.setTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setTree">[docs]</a>    <span class="k">def</span> <span class="nf">setTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">diction</span><span class="p">,</span><span class="n">clear</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the tree from a dictionary {&#39;Node0.0&#39;:{&#39;Node1.0&#39;:None,&#39;Node1.1&#39;:None}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">K</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">diction</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In setTree(</span><span class="si">%d</span><span class="s1">) ...&#39;</span><span class="o">%</span><span class="n">K</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">diction</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">diction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">if</span> <span class="n">clear</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">:</span> 
            <span class="k">if</span> <span class="ow">not</span> <span class="n">clear</span><span class="p">:</span> <span class="n">diction</span> <span class="o">=</span> <span class="n">djoin</span><span class="p">(</span><span class="n">diction</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span><span class="p">)</span> <span class="c1">#Merging new and old models</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dictionary</span> <span class="o">=</span> <span class="n">diction</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">diction</span><span class="p">):</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">setNodeTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">diction</span><span class="p">,</span><span class="n">alias</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getShowAlias</span><span class="p">()</span> <span class="ow">or</span> <span class="n">K</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">getMaxDevices</span><span class="p">()</span><span class="o">*</span><span class="mi">20</span><span class="p">))</span>
            <span class="c1">#Auto-Expand caused problems when loading filters from QSettings</span>
            <span class="k">if</span> <span class="mi">0</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">item_list</span><span class="p">)</span><span class="o">&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">getMaxDevices</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">expandAll</span><span class="p">(</span><span class="n">queue</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.setNodeTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setNodeTree">[docs]</a>    <span class="k">def</span> <span class="nf">setNodeTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">,</span><span class="n">diction</span><span class="p">,</span><span class="n">alias</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        It has parent as argument to allow itself to be recursive</span>
<span class="sd">        Initializes the node tree from a dictionary {&#39;Node0.0&#39;:{&#39;Node1.0&#39;:None,&#39;Node1.1&#39;:None}}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;In setNodeTree(</span><span class="si">%d</span><span class="s1">,alias=</span><span class="si">%s</span><span class="s1">) ...&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">diction</span><span class="p">),</span><span class="n">alias</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">diction</span><span class="p">,</span><span class="s1">&#39;keys&#39;</span><span class="p">):</span> <span class="n">diction</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">diction</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">diction</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">assert</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">10000000000</span><span class="p">,</span><span class="s1">&#39;TooManyIterations!&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">dev_alias</span> <span class="o">=</span> <span class="n">alias</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">get_alias_for_device</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">text</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> (</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">dev_alias</span><span class="p">)</span> <span class="k">if</span> <span class="n">dev_alias</span> <span class="k">else</span> <span class="n">node</span>
            <span class="k">if</span> <span class="n">diction</span><span class="p">[</span><span class="n">node</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">diction</span><span class="p">[</span><span class="n">node</span><span class="p">]):</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createItem</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">text</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">setNodeTree</span><span class="p">(</span><span class="n">item</span><span class="p">,</span><span class="n">diction</span><span class="p">[</span><span class="n">node</span><span class="p">],</span><span class="n">alias</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createItem</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">text</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.clear"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expander</span><span class="o">.</span><span class="n">getQueue</span><span class="p">()</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expander</span><span class="o">.</span><span class="n">getQueue</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_list</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_list</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidget</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.refreshTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.refreshTree">[docs]</a>    <span class="k">def</span> <span class="nf">refreshTree</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_filters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;refreshTree&quot;</span><span class="p">))</span></div>

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1">## @name Methods for building server/devices/attributes tree</span>
    <span class="c1"># @{</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    
<div class="viewcode-block" id="TaurusDevTree.getTangoDict"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getTangoDict">[docs]</a>    <span class="k">def</span> <span class="nf">getTangoDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filters</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In TaurusDevTree.getTangoDict(</span><span class="si">%s</span><span class="s1">(</span><span class="si">%s</span><span class="s1">))&#39;</span><span class="o">%</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">filters</span><span class="p">),</span><span class="nb">str</span><span class="p">(</span><span class="n">filters</span><span class="p">)[:</span><span class="mi">80</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">filters</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="k">return</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="n">split_model_list</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">get_matching_devices</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="p">[</span><span class="n">t</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">]</span>
        <span class="n">domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">domains</span><span class="p">:</span>
            <span class="n">families</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/&#39;</span><span class="o">%</span><span class="n">d</span><span class="p">))</span>
            <span class="n">result</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">f</span><span class="p">,</span><span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span> <span class="k">if</span> <span class="n">t</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">/</span><span class="si">%s</span><span class="s1">/&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">f</span><span class="p">))))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">families</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.addAttrToDev"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.addAttrToDev">[docs]</a>    <span class="k">def</span> <span class="nf">addAttrToDev</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">my_device</span><span class="p">,</span><span class="n">expert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">allow_types</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This command returns the list of attributes of a given device applying display level and type filters.</span>
<span class="sd">        @argin expert If False only PyTango.DispLevel.OPERATOR attributes are displayed</span>
<span class="sd">        @argin allow_types Only those types included in the list will be displayed (e.g. may be restricted to numeric types only)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">numeric_types</span> <span class="o">=</span> <span class="p">[</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevDouble</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevFloat</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevLong</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevLong64</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevULong</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevShort</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevUShort</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevBoolean</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevState</span><span class="p">]</span>
        <span class="n">allow_types</span> <span class="o">=</span> <span class="n">allow_types</span> <span class="ow">or</span> <span class="p">[</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevString</span><span class="p">]</span><span class="o">+</span><span class="n">numeric_types</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In addAttrToDev(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">my_device</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">proxy</span> <span class="o">=</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">DeviceProxy</span><span class="p">(</span><span class="n">my_device</span><span class="p">)</span>
            <span class="n">timeout</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">get_timeout_millis</span><span class="p">()</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">set_timeout_millis</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">ping</span><span class="p">()</span>
            <span class="n">list_attr</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">attribute_list_query</span><span class="p">()</span>
            <span class="n">proxy</span><span class="o">.</span><span class="n">set_timeout_millis</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">aname</span><span class="p">,</span><span class="n">my_attr</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">a</span><span class="o">.</span><span class="n">name</span><span class="p">,</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">list_attr</span><span class="p">]):</span>
                <span class="k">if</span> <span class="n">allow_types</span> <span class="ow">and</span> <span class="n">my_attr</span><span class="o">.</span><span class="n">data_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">allow_types</span><span class="p">:</span> <span class="k">continue</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">expert</span> <span class="ow">and</span> <span class="n">my_attr</span><span class="o">.</span><span class="n">disp_level</span><span class="o">==</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DispLevel</span><span class="o">.</span><span class="n">EXPERT</span><span class="p">:</span> <span class="k">continue</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">aname</span><span class="o">==</span><span class="n">my_attr</span><span class="o">.</span><span class="n">label</span> <span class="ow">and</span> <span class="n">aname</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">aname</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">my_attr</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
                <span class="n">dct</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">my_device</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="n">PyTango</span><span class="o">.</span><span class="n">DevFailed</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;addAttrToDev(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">my_device</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="n">qmsg</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Error&#39;</span><span class="o">%</span><span class="n">my_device</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> not available&#39;</span><span class="o">%</span><span class="n">my_device</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">qmsg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;addAttrToDev(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">my_device</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
            <span class="n">qmsg</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Critical</span><span class="p">,</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> Error&#39;</span><span class="o">%</span><span class="n">my_device</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span><span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">qmsg</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">dct</span></div>
            
<div class="viewcode-block" id="TaurusDevTree.addAttrToNode"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.addAttrToNode">[docs]</a>    <span class="k">def</span> <span class="nf">addAttrToNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">full</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">node</span> <span class="o">=</span> <span class="n">node</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="n">dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeDeviceName</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In addAttrToNode(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">dev</span><span class="p">)</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addAttrToDev</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>
        <span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">childCount</span><span class="p">())]</span>
        <span class="k">for</span> <span class="n">aname</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">attrs</span><span class="p">):</span>
            <span class="n">tag</span> <span class="o">=</span> <span class="n">aname</span><span class="o">.</span><span class="n">rsplit</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">children</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">full</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">matchAttrFilter</span><span class="p">(</span><span class="n">aname</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">natt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">createItem</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">value</span><span class="o">=</span><span class="n">aname</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">natt</span><span class="o">.</span><span class="n">draggable</span> <span class="o">=</span> <span class="n">aname</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">natt</span><span class="o">.</span><span class="n">isAttribute</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">natt</span><span class="o">.</span><span class="n">DeviceName</span> <span class="o">=</span> <span class="n">dev</span>
                <span class="n">icon</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeIcon</span><span class="p">(</span><span class="n">natt</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">icon</span><span class="p">:</span> <span class="n">natt</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span> 
                <span class="n">alias</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;AttributeAlias&#39;</span><span class="p">,{})</span> <span class="c1">#it gets all aliases for this device attributes</span>
                <span class="k">if</span> <span class="n">alias</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;Got aliases for </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">aname</span><span class="p">,</span><span class="n">alias</span><span class="p">))</span>
                    <span class="p">[</span><span class="nb">setattr</span><span class="p">(</span><span class="n">natt</span><span class="p">,</span><span class="s1">&#39;AttributeAlias&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">alias</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">aname</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="n">natt</span><span class="o">.</span><span class="n">AttributeAlias</span> <span class="o">=</span> <span class="n">aname</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">node</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span></div>
                        
    <span class="c1">###########################################################################</span>
    <span class="c1"># Node getters</span>
    
<div class="viewcode-block" id="TaurusDevTree.getNode"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getNode">[docs]</a>    <span class="k">def</span> <span class="nf">getNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets currrent node or node by name or by regexp &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span> 
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatchingNodes</span><span class="p">(</span><span class="n">target</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.getNodeByName"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getNodeByName">[docs]</a>    <span class="k">def</span> <span class="nf">getNodeByName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="p">[</span><span class="n">key</span><span class="p">]</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.getNodeList"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getNodeList">[docs]</a>    <span class="k">def</span> <span class="nf">getNodeList</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="TaurusDevTree.getMatchingNodes"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getMatchingNodes">[docs]</a>    <span class="k">def</span> <span class="nf">getMatchingNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">regexp</span><span class="p">,</span><span class="n">limit</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">all</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; It returns all nodes matching the given expression. &quot;&quot;&quot;</span>
        <span class="n">result</span><span class="p">,</span><span class="n">regexp</span> <span class="o">=</span> <span class="p">[],</span><span class="nb">str</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span> <span class="ow">or</span> <span class="p">[]</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In TauDevTree.getMatchingNodes(</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span><span class="n">limit</span><span class="p">,</span><span class="nb">all</span><span class="p">,</span><span class="n">exclude</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">node</span><span class="p">]</span>
        <span class="n">regexp</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">extend_regexp</span><span class="p">(</span><span class="n">regexp</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_index</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">nname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">or</span> <span class="n">regexp</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">nname</span><span class="p">))</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="ow">not</span> <span class="n">exclude</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">exclude</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">nname</span><span class="p">))):</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">break</span>
                <span class="k">if</span> <span class="n">limit</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">&gt;=</span><span class="n">limit</span><span class="p">:</span> <span class="k">break</span>
        <span class="k">return</span> <span class="n">result</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.getSelectedNodes"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getSelectedNodes">[docs]</a>    <span class="k">def</span> <span class="nf">getSelectedNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectedItems</span><span class="p">()</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.getAllNodes"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getAllNodes">[docs]</a>    <span class="k">def</span> <span class="nf">getAllNodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list with all node objects. &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">get_child_nodes</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">fun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">fun</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="n">dct</span><span class="o">.</span><span class="n">update</span><span class="p">([(</span><span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="n">node</span><span class="p">)])</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
                <span class="n">get_child_nodes</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span><span class="n">node</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">j</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">dct</span>
        <span class="n">dct</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()):</span>
            <span class="n">get_child_nodes</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dct</span> </div>

<div class="viewcode-block" id="TaurusDevTree.unpackChildren"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.unpackChildren">[docs]</a>    <span class="k">def</span> <span class="nf">unpackChildren</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; removes all nodes from the tree and returns them in a list, used for resorting &quot;&quot;&quot;</span>
        <span class="n">allChildren</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllNodes</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
    
        <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
            <span class="n">allChildren</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">takeChildren</span><span class="p">())</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">():</span> 
            <span class="n">allChildren</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">takeTopLevelItem</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">allChildren</span>    </div>
    
    <span class="c1">## @}</span>
    <span class="c1">########################################################################################################################</span>
            
    <span class="c1">###########################################################################</span>
    <span class="c1"># Expand/Collapse/Search nodes</span>
    
<div class="viewcode-block" id="TaurusDevTree.collapseNode"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.collapseNode">[docs]</a>    <span class="k">def</span> <span class="nf">collapseNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ALL</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">filters</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">fun</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Collapses the whole tree or from a given node.</span>
<span class="sd">        @argin ALL tells whether to collapse from current item or the whole tree</span>
<span class="sd">        @argin filters Allows to set a list of nodes to not be filtered</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">filters</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="n">found</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;In TaurusTree.collapseAll(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">filters</span><span class="p">)</span>
        <span class="n">todelete</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">def</span> <span class="nf">expand_child_nodes</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">bool</span><span class="p">(</span><span class="n">filters</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">fun</span><span class="p">:</span> <span class="n">fun</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span><span class="p">:</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">childCount</span><span class="p">()):</span>
                <span class="n">child</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">expand_child_nodes</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">filters</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;In TaurusTree.collapseAll(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1"> matches!&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
                    <span class="n">child</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">aname</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;[0-9a-zA-Z\-\_]+&#39;</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="c1">#When collapsing all attribute lists are cleaned up</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">aname</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))):</span>
                    <span class="n">todelete</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">node</span><span class="p">,</span><span class="n">child</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span> <span class="n">node</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span>
        <span class="k">if</span> <span class="n">ALL</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()):</span>
                <span class="n">found</span> <span class="o">=</span> <span class="n">expand_child_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItem</span><span class="p">(</span><span class="n">i</span><span class="p">))</span> <span class="ow">or</span> <span class="n">found</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">found</span> <span class="o">=</span> <span class="n">expand_child_nodes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">())</span> <span class="ow">or</span> <span class="n">found</span>
        <span class="k">for</span> <span class="n">node</span><span class="p">,</span><span class="n">child</span> <span class="ow">in</span> <span class="n">todelete</span><span class="p">:</span> <span class="c1">#Pruning attribute nodes</span>
            <span class="n">node</span><span class="o">.</span><span class="n">removeChild</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">child</span>
        <span class="k">return</span> <span class="n">found</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1"># New expand/search methods</span>
            
    <span class="c1">#@Qt.pyqtSignature(&quot;expandNode&quot;)</span>
<div class="viewcode-block" id="TaurusDevTree.expandNode"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.expandNode">[docs]</a>    <span class="k">def</span> <span class="nf">expandNode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">expand</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Needed to do threaded expansion of the tree &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,(</span><span class="n">basestring</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QString</span><span class="p">)):</span> <span class="n">name</span><span class="p">,</span><span class="n">node</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">getNode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="n">expand</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">expand</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.expandAll"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.expandAll">[docs]</a>    <span class="k">def</span> <span class="nf">expandAll</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">queue</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findInTree</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">select</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">queue</span><span class="o">=</span><span class="n">queue</span><span class="p">)</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.findDialog"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.findDialog">[docs]</a>    <span class="k">def</span> <span class="nf">findDialog</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">findInTree</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Search ...&#39;</span><span class="p">,</span><span class="s1">&#39;Write a part of the name&#39;</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QLineEdit</span><span class="o">.</span><span class="n">Normal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span></div>
        
    <span class="nd">@Qt</span><span class="o">.</span><span class="n">pyqtSignature</span><span class="p">(</span><span class="s2">&quot;findInTree(const QString &amp;)&quot;</span><span class="p">)</span>
<div class="viewcode-block" id="TaurusDevTree.findInTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.findInTree">[docs]</a>    <span class="k">def</span> <span class="nf">findInTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">regexp</span><span class="p">,</span><span class="n">collapseAll</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">select</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">queue</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span> <span class="s1">&#39;In TauTree.findInTree(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">regexp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">collapseAll</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="n">collapseAll</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsing_search</span>
        <span class="n">regexp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">regexp</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s1">&#39;__iter__&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="n">x</span><span class="p">])(</span><span class="n">exclude</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">excludeFromSearch</span> <span class="ow">or</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">regexp</span><span class="p">:</span> <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMatchingNodes</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span><span class="nb">all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">150</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="s1">&#39;Device Tree Search&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;Your search matches too many devices (</span><span class="si">%d</span><span class="s1">) and may slow down the application.</span><span class="se">\n</span><span class="s1">Do you want to continue?&#39;</span><span class="o">%</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span>
                    <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Ok</span><span class="o">|</span><span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">Cancel</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Search cancelled by user.&#39;</span><span class="p">)</span>
                    <span class="k">return</span>
            <span class="k">if</span> <span class="n">nodes</span><span class="p">:</span>
                <span class="c1">#It&#39;s good to have first node matched to be selected fast</span>
                <span class="k">if</span> <span class="n">select</span><span class="p">:</span> 
                    <span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">setSelected</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setCurrentItem</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">deviceSelected</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeDeviceName</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="c1">#Searches must not trigger events!</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;The selected node is </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="c1">#Then proceed to expand/close the rest of nodes</span>
                <span class="n">parents</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">parent</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodePath</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="k">if</span> <span class="n">parent</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_list</span><span class="p">:</span>
                    <span class="n">matched</span><span class="p">,</span><span class="n">expanded</span> <span class="o">=</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">,</span><span class="n">item</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">matched</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">expanded</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">queue</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expander</span><span class="o">.</span><span class="n">getQueue</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">item</span><span class="p">,</span><span class="kc">True</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">matched</span> <span class="ow">and</span> <span class="n">expanded</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsing_search</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">queue</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expander</span><span class="o">.</span><span class="n">getQueue</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">item</span><span class="p">,</span><span class="kc">False</span><span class="p">))</span>
                        <span class="k">else</span><span class="p">:</span> <span class="n">item</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">select</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">scrollTo</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">indexFromItem</span><span class="p">(</span><span class="n">nodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">Qt</span><span class="o">.</span><span class="n">QAbstractItemView</span><span class="o">.</span><span class="n">PositionAtTop</span><span class="p">)</span><span class="c1">#Center)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">findInTree(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%d</span><span class="s1"> nodes found in </span><span class="si">%f</span><span class="s1"> s&#39;</span> <span class="o">%</span><span class="p">(</span><span class="n">regexp</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">),</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="n">t0</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">collapseAll</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">queue</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Expander</span><span class="o">.</span><span class="n">getQueue</span><span class="p">()</span><span class="o">.</span><span class="n">put</span><span class="p">((</span><span class="n">item</span><span class="p">,</span><span class="kc">False</span><span class="p">))</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_list</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()]</span>
                    <span class="k">else</span><span class="p">:</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">setExpanded</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_list</span> <span class="k">if</span> <span class="n">item</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;findInTree(</span><span class="si">%s</span><span class="s1">): Node not found&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">regexp</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">queue</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">Expander</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
        <span class="k">except</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span> <span class="s1">&#39;findInTree(</span><span class="si">%s</span><span class="s1">): failed&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">regexp</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span></div>
            
<div class="viewcode-block" id="TaurusDevTree.sortCustom"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.sortCustom">[docs]</a>    <span class="k">def</span> <span class="nf">sortCustom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">order</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">order</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">order</span><span class="p">),</span> <span class="s1">&#39;sortCustom(order) must not be empty&#39;</span>
        <span class="n">allChildren</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">():</span> 
            <span class="n">it</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">takeTopLevelItem</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">allChildren</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">it</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">))]</span><span class="o">=</span><span class="n">it</span>

        <span class="n">sorter</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">k</span><span class="p">,</span><span class="n">ks</span><span class="o">=</span><span class="p">[</span><span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">order</span><span class="p">]:</span> <span class="nb">str</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ks</span><span class="p">)</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">()))</span><span class="o">.</span><span class="n">next</span><span class="p">())</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">c</span><span class="p">,</span><span class="n">it</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">allChildren</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">k</span><span class="p">:</span><span class="n">sorter</span><span class="p">(</span><span class="n">k</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s1">&#39;tree.sortCustom(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1"> inserted at </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">order</span><span class="p">,</span><span class="n">it</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">()))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">insertTopLevelItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topLevelItemCount</span><span class="p">(),</span><span class="n">it</span><span class="p">)</span>
        <span class="k">return</span></div>

    <span class="c1">###########################################################################</span>
    <span class="c1"># Update node colors</span>
    
    <span class="c1">#@Qt.pyqtSignature(&quot;setIcons&quot;)</span>
<div class="viewcode-block" id="TaurusDevTree.setIcons"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setIcons">[docs]</a>    <span class="k">def</span> <span class="nf">setIcons</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dct</span><span class="o">=</span><span class="p">{},</span><span class="n">root_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">regexps</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method change the icons depending of the status of the devices</span>
<span class="sd">        Dict is a dictionary with name of device and colors such as {name_device:color,name_device2:color2}</span>
<span class="sd">        An alternative may be an icon name!</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1">#secs = time.time()</span>
        <span class="c1">#ID = int(100*random.random())</span>
        <span class="n">state2color</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">state</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="n">DEVICE_STATE_PALETTE</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="c1">#quality2color = lambda attr: Qt.QColor(ATTRIBUTE_QUALITY_PALETTE.number(quality))</span>

        <span class="k">def</span> <span class="nf">update_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">dct</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;CustomForeground&#39;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">CustomForeground</span><span class="p">)))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;CustomBackground&#39;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">CustomBackground</span><span class="p">)))</span>            
            <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;StateBackground&#39;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">state2color</span><span class="p">(</span><span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">])))</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;CustomIcon&#39;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">CustomIcon</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#key = str(node.text(0)).split(&#39; &#39;)[0]</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">setStateIcon</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">dct</span> <span class="ow">and</span> <span class="n">dct</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span><span class="nb">dict</span><span class="p">):</span> 
            <span class="n">dct</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">fromkeys</span><span class="p">(</span><span class="n">dct</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>    
        <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getAllNodes</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span><span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">isHidden</span><span class="p">():</span> <span class="k">continue</span>
            <span class="k">if</span> <span class="n">regexps</span><span class="p">:</span>
                <span class="n">matches</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">dct</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">())]</span>
                <span class="k">if</span> <span class="n">matches</span><span class="p">:</span> 
                    <span class="n">update_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">name</span><span class="p">,{</span><span class="n">name</span><span class="p">:</span><span class="n">matches</span><span class="p">[</span><span class="mi">0</span><span class="p">]})</span>
            <span class="k">elif</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dct</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">dct</span><span class="p">:</span>
                <span class="n">update_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">dct</span> <span class="ow">or</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="s1">&#39;&#39;</span><span class="p">})</span>
        <span class="k">return</span></div>

<div class="viewcode-block" id="TaurusDevTree.setStateIcon"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.setStateIcon">[docs]</a>    <span class="k">def</span> <span class="nf">setStateIcon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">child</span><span class="p">,</span><span class="n">color</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">icons_dev_tree</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;In setStateIcon(...): Icons for states not available!&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#00ff00&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;ON,OPEN,EXTRACT&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_GREEN&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#ff0000&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;OFF,FAULT&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_RED&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#ff8c00&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;ALARM&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_ORANGE&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#ffffff&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;CLOSE,INSERT&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_WHITE&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#80a0ff&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;MOVING,RUNNING&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_BLUE&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#ffff00&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;STANDBY&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_YELLOW&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#cccc7a&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;INIT&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_BRAWN&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#ff00ff&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;DISABLE&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_PINK&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">color</span><span class="o">==</span><span class="s2">&quot;#808080f&quot;</span> <span class="ow">or</span> <span class="n">color</span> <span class="ow">in</span> <span class="s1">&#39;UNKNOWN&#39;</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_GREY&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">icon</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QIcon</span><span class="p">(</span><span class="s2">&quot;:/ICON_WHITE&quot;</span><span class="p">)</span>
            <span class="n">child</span><span class="o">.</span><span class="n">setIcon</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">icon</span><span class="p">)</span>        </div>
        
    <span class="c1">############################################################################</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Event methods</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

<div class="viewcode-block" id="TaurusDevTree.deviceClicked"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.deviceClicked">[docs]</a>    <span class="k">def</span> <span class="nf">deviceClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">item</span><span class="p">,</span><span class="n">column</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;In TaurusDevTree.deviceClicked(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">item</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">column</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deviceSelected</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeDeviceName</span><span class="p">())</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.deviceSelected"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.deviceSelected">[docs]</a>    <span class="k">def</span> <span class="nf">deviceSelected</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">device_name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;QSIGNAL: this method is used to emit deviceSelected(QString) signal&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s2">&quot;In TaurusDevTree.deviceSelected(</span><span class="si">%s</span><span class="s2">)&quot;</span><span class="o">%</span><span class="n">device_name</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1">#item = self.currentItem()</span>
            <span class="n">device_name</span> <span class="o">=</span> <span class="n">device_name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeDeviceName</span><span class="p">()</span><span class="c1">#item.text(0)</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">device_name</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">!=</span><span class="mi">2</span><span class="p">:</span> <span class="k">return</span>
            <span class="c1">#Signal</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;TaurusTree emit deviceSelected(</span><span class="si">%s</span><span class="s1">) signal ...&#39;</span><span class="o">%</span><span class="n">device_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;deviceSelected(QString)&quot;</span><span class="p">),</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QString</span><span class="p">(</span><span class="n">device_name</span><span class="p">))</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
            <span class="k">pass</span></div>
            
<div class="viewcode-block" id="TaurusDevTree.getModelMimeData"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.getModelMimeData">[docs]</a>    <span class="k">def</span> <span class="nf">getModelMimeData</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Returns a MimeData object containing the model data. The default implementation </span>
<span class="sd">        fills the `TAURUS_MODEL_MIME_TYPE`. If the widget&#39;s Model class is</span>
<span class="sd">        Attribute or Device, it also fills `TAURUS_ATTR_MIME_TYPE` or</span>
<span class="sd">        `TAURUS_DEV_MIME_TYPE`, respectively</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">mimeData</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMimeData</span><span class="p">()</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span> 
        <span class="n">draggable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeDraggable</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">draggable</span><span class="p">:</span>
            <span class="n">slashes</span> <span class="o">=</span> <span class="n">draggable</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">-</span><span class="n">draggable</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="c1">#mimeData.setData(&#39;application/x-qabstractitemmodeldatalist&#39;,draggable)</span>
            <span class="k">if</span> <span class="n">slashes</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="n">mimeData</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">TAURUS_ATTR_MIME_TYPE</span><span class="p">,</span> <span class="n">draggable</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">slashes</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span> <span class="n">mimeData</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">TAURUS_DEV_MIME_TYPE</span><span class="p">,</span> <span class="n">draggable</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="n">mimeData</span><span class="o">.</span><span class="n">setData</span><span class="p">(</span><span class="n">TAURUS_MODEL_MIME_TYPE</span><span class="p">,</span> <span class="n">draggable</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mimeData</span></div>
            
<div class="viewcode-block" id="TaurusDevTree.checkHeaderClicked"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.checkHeaderClicked">[docs]</a>    <span class="k">def</span> <span class="nf">checkHeaderClicked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerItem</span><span class="p">():</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">showNodeContextMenu</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">event</span><span class="p">)</span></div>
            <span class="c1">#node.ContextMenu = [&#39;Search ...&#39;]            </span>
        
<div class="viewcode-block" id="TaurusDevTree.mouseMoveEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.mouseMoveEvent">[docs]</a>    <span class="k">def</span> <span class="nf">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        copied from TaurusBaseWidget to provide drag events</span>
<span class="sd">        It had to be rewritten as QTreeWidget does not allow drag events</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;In TaurusDevTree.mouseMoveEvent&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dragEnabled</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">event</span><span class="o">.</span><span class="n">buttons</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">LeftButton</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQtClass</span><span class="p">()</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dragStartPosition</span><span class="p">)</span><span class="o">.</span><span class="n">manhattanLength</span><span class="p">()</span>  <span class="o">&lt;</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QApplication</span><span class="o">.</span><span class="n">startDragDistance</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getQtClass</span><span class="p">()</span><span class="o">.</span><span class="n">mouseMoveEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>
        <span class="c1">#The mouseMoveEvent of QTreeWidget do not allow drag, commented</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1">#self.getQtClass().mouseMoveEvent(self, event) #call the superclass</span>
        <span class="n">event</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span> <span class="c1">#we make sure we accept after having called the superclass so that it is not propagated (many default implementations of mouseMoveEvent call event.ignore())</span>
        <span class="n">drag</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QDrag</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">drag</span><span class="o">.</span><span class="n">setMimeData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getModelMimeData</span><span class="p">())</span>
        <span class="n">drag</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CopyAction</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">Qt</span><span class="o">.</span><span class="n">CopyAction</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span></div>
    
<div class="viewcode-block" id="TaurusDevTree.mimeTypes"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.mimeTypes">[docs]</a>    <span class="k">def</span> <span class="nf">mimeTypes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSupportedMimeTypes</span><span class="p">()</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.dropEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.dropEvent">[docs]</a>    <span class="k">def</span> <span class="nf">dropEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;reimplemented to support dropping of modelnames in forms&#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;dropEvent(</span><span class="si">%s</span><span class="s1">): </span><span class="si">%s</span><span class="s1">,</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">event</span><span class="p">,</span><span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">(),</span><span class="n">split_model_list</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">formats</span><span class="p">())))</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">source</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Internal drag/drop not allowed&#39;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">s</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">mimeData</span><span class="p">()</span><span class="o">.</span><span class="n">formats</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">getSupportedMimeTypes</span><span class="p">()):</span>
            <span class="c1">#mtype = self.handleMimeData(event.mimeData(),self.addModels)#lambda m:self.addModels(&#39;^%s$&#39;%m))</span>
            <span class="n">event</span><span class="o">.</span><span class="n">acceptProposedAction</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Invalid model in dropped data&#39;</span><span class="p">)</span></div>
        
    <span class="c1">########################################################################################################################3      </span>
    <span class="c1">## @name Context Menu Actions</span>
    <span class="c1"># @{</span>
        
<div class="viewcode-block" id="TaurusDevTree.contextMenuEvent"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.contextMenuEvent">[docs]</a>    <span class="k">def</span> <span class="nf">contextMenuEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        This function is called when right clicking on TaurusDevTree area. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">currentItem</span><span class="p">()</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">showNodeContextMenu</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="n">event</span><span class="p">)</span>
        <span class="k">return</span></div>
        
<div class="viewcode-block" id="TaurusDevTree.showNodeContextMenu"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTree.html#taurus.qt.qtgui.tree.TaurusDevTree.showNodeContextMenu">[docs]</a>    <span class="k">def</span> <span class="nf">showNodeContextMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">node</span><span class="p">,</span><span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A pop up menu will be shown with the available options. </span>
<span class="sd">        Menus are managed using two tuple lists for each node: node.ContextMenu and node.ExpertMenu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeDraggable</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">globalPos</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;showNodeContextMenu(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">obj</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">itemAt</span><span class="p">(</span><span class="n">position</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerItem</span><span class="p">():</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headerItem</span><span class="p">()</span>
            <span class="c1">#node.ContextMenu = [&#39;Search ...&#39;]</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;ContextMenu&#39;</span><span class="p">):</span>
                <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">=</span><span class="p">[]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Search ...&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="p">]:</span> <span class="c1">##Creating default menu</span>
                <span class="c1"># DEVICE NODE CONTEXT MENU</span>
                <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
                    
                    <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Open Panel&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showPanel</span><span class="p">))</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Show Attributes&quot;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">addAttrToNode</span><span class="p">))</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">getNodeAdmin</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Go to </span><span class="si">%s</span><span class="s2">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeAdmin</span><span class="p">(</span><span class="n">node</span><span class="p">),</span>\
                            <span class="k">lambda</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeAdmin</span><span class="p">(</span><span class="n">node</span><span class="p">):</span> <span class="n">p</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">findInTree</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
                            <span class="p">))</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;ExpertMenu&#39;</span><span class="p">):</span> <span class="nb">setattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;ExpertMenu&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="p">)</span><span class="c1">#[])</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;Show Properties&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">a</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="p">]:</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Show Properties&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">showProperties</span><span class="p">))</span>
                        <span class="k">def</span> <span class="nf">test_device</span><span class="p">():</span>
                            <span class="n">device</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeDeviceName</span><span class="p">())</span>
                            <span class="k">if</span> <span class="n">device</span><span class="p">:</span>
                                <span class="n">comm</span> <span class="o">=</span> <span class="s1">&#39;tg_devtest </span><span class="si">%s</span><span class="s1"> &amp;&#39;</span><span class="o">%</span><span class="n">device</span>
                                <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="n">comm</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;TaurusDevTree.TestDevice: Selected Device is None!&#39;</span><span class="p">)</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Test Device&quot;</span><span class="p">,</span> <span class="n">test_device</span><span class="p">))</span>
                        <span class="n">node</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Show ALL Attributes&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="p">:</span><span class="n">s</span><span class="o">.</span><span class="n">addAttrToNode</span><span class="p">(</span><span class="n">full</span><span class="o">=</span><span class="kc">True</span><span class="p">)))</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>
                    
                <span class="c1"># ATTRIBUTE NODE CONTEXT MENU</span>
                <span class="k">elif</span> <span class="n">obj</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">AttributeMenu</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Adding action </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">):</span>
                            <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">v</span><span class="p">)))</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeAlias</span><span class="p">(</span><span class="n">node</span><span class="p">):</span> <span class="n">v</span><span class="p">(</span><span class="n">s</span><span class="p">)))</span>
                    <span class="c1">#node.ContextMenu.append((&quot;add to Trends&quot;, self.addToPlot))</span>
                    <span class="c1">#node.ContextMenu.append((&quot;remove from Trends&quot;, self.removeFromPlot))</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">))</span>    
                <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;ExpertMenu&#39;</span><span class="p">):</span> 
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;ExpertMenu&#39;</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="p">)</span><span class="c1">#[])</span>
                <span class="c1">#node.ContextMenu.append((&quot;Expand Node&quot;, self.expandNode))</span>
                <span class="c1">#node.ContextMenu.append((&quot;Collapse Node&quot;, self.collapseNode))</span>
                <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">isExpanded</span><span class="p">()</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">childCount</span><span class="p">()</span><span class="o">&lt;</span><span class="mi">10</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">getNodeText</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">j</span><span class="p">))</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">childCount</span><span class="p">())):</span>
                    <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Show Attributes&quot;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">n</span><span class="o">=</span><span class="n">node</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="p">:</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">addAttrToNode</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">child</span><span class="p">(</span><span class="n">j</span><span class="p">))</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">childCount</span><span class="p">())]))</span>
                <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s2">&quot;Search ...&quot;</span><span class="p">,</span>\
                    <span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">findInTree</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QInputDialog</span><span class="o">.</span><span class="n">getText</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;Search ...&#39;</span><span class="p">,</span><span class="s1">&#39;Write a part of the name&#39;</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QLineEdit</span><span class="o">.</span><span class="n">Normal</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span>
                    <span class="p">))</span>
        <span class="c1">#configDialogAction = menu.addAction(&quot;Refresh Tree&quot;)</span>
        <span class="c1">#self.connect(configDialogAction, Qt.SIGNAL(&quot;triggered()&quot;), self.refreshTree)</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;ContextMenu&#39;</span><span class="p">):</span>
            <span class="n">last_was_separator</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">k</span><span class="p">,</span><span class="n">action</span> <span class="o">=</span> <span class="n">t</span>
                    <span class="k">if</span> <span class="n">k</span><span class="p">:</span>
                        <span class="n">configDialogAction</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">action</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">configDialogAction</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;triggered()&quot;</span><span class="p">),</span> <span class="n">action</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span> <span class="n">configDialogAction</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">last_was_separator</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">last_was_separator</span><span class="p">:</span> 
                        <span class="n">menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
                        <span class="n">last_was_separator</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Unable to add Menu Action: </span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span><span class="s1">&#39;ExpertMenu&#39;</span><span class="p">):</span>
            <span class="n">menu</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
            <span class="n">expert</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">addMenu</span><span class="p">(</span><span class="s1">&#39;Expert&#39;</span><span class="p">)</span>
            <span class="c1">#expert.addSeparator()</span>
            <span class="n">last_was_separator</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">ContextMenu</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span> <span class="ow">and</span> <span class="n">node</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">ExpertMenu</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">k</span><span class="p">,</span><span class="n">action</span> <span class="o">=</span> <span class="n">t</span>
                    <span class="k">if</span> <span class="n">k</span><span class="p">:</span>
                        <span class="n">configDialogAction</span> <span class="o">=</span> <span class="n">expert</span><span class="o">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">action</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">configDialogAction</span><span class="p">,</span> <span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;triggered()&quot;</span><span class="p">),</span> <span class="n">action</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span> <span class="n">configDialogAction</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                        <span class="n">last_was_separator</span> <span class="o">=</span> <span class="kc">False</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">last_was_separator</span><span class="p">:</span> 
                        <span class="n">expert</span><span class="o">.</span><span class="n">addSeparator</span><span class="p">()</span>
                        <span class="n">last_was_separator</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span> 
                    <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Unable to add Expert Action: </span><span class="si">%s</span><span class="s1">:</span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>            
        <span class="c1">#menu.addSeparator()</span>
        <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">globalPos</span><span class="p">())</span>
        <span class="k">del</span> <span class="n">menu</span></div></div>


<span class="k">class</span> <span class="nc">PopupDialog</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    This class create the dialog </span>
<span class="sd">    Dialog is used to make new floating panels persistent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="n">target</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QDialog</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">initComponents</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">initComponents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">newWidget</span><span class="p">,</span><span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">widgetLayout</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">widgetLayout</span><span class="o">.</span><span class="n">setContentsMargins</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">widgetLayout</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">newWidget</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">newWidget</span><span class="o">.</span><span class="n">windowTitle</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setModal</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
        
<span class="c1">#####################################################################################</span>
            
<span class="k">class</span> <span class="nc">TaurusTreeNode</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">,</span> <span class="n">TaurusBaseComponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Unused; one day should replace TaurusTreeNodeContainer and all methods moved here.</span>
<span class="sd">    Base class for all Taurus Tree Node Items</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># Write your own code here to define the signals generated by this widget</span>
    <span class="c1">#</span>
    <span class="n">__pyqtSignals__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;modelChanged(const QString &amp;)&quot;</span><span class="p">,)</span>    
    <span class="c1">#__pyqtSignals__ = (&quot;refreshIcon&quot;,)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call__init__wo_kw</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QTreeWidgetItem</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">call__init__</span><span class="p">(</span><span class="n">TaurusBaseComponent</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="c1">#self.defineStyle()</span>
    
    <span class="c1">#def defineStyle(self):</span>
        <span class="c1">#&quot;&quot;&quot; Defines the initial style for the widget &quot;&quot;&quot;</span>
        <span class="c1">##-----------------------------------------------------------------------</span>
        <span class="c1">## Write your own code here to set the initial style of your widget</span>
        <span class="c1">##</span>
        <span class="c1">#self.updateStyle()        </span>
        
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Mandatory methods to be implemented in any subclass of TaurusComponent</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="k">def</span> <span class="nf">getParentTaurusComponent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a parent Taurus component or None if no parent TaurusBaseComponent </span>
<span class="sd">            is found.&quot;&quot;&quot;</span>
        <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentItem</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">p</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">TaurusTreeNode</span><span class="p">):</span>
            <span class="n">p</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parentItem</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">p</span>

    <span class="k">def</span> <span class="nf">updateStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Method called when the component detects an event that triggers a change</span>
<span class="sd">            in the style.&quot;&quot;&quot;</span>
        
        <span class="c1">#if self.scene():</span>
        <span class="c1">#    self.scene().updateSceneItem(self)</span>
            
        <span class="c1">#-----------------------------------------------------------------------</span>
        <span class="c1"># Write your own code here to update your widget style</span>
        
        <span class="c1"># send a repaint in the end</span>
        <span class="c1">#self.repaint()</span>
        <span class="c1">#if self._parent: self._parent.repaint()</span>
        
        <span class="n">state2color</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">state</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="n">DEVICE_STATE_PALETTE</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="n">state</span><span class="p">))</span>
        <span class="n">quality2color</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">attr</span><span class="p">:</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QColor</span><span class="p">(</span><span class="n">ATTRIBUTE_QUALITY_PALETTE</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
        <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">getModelValueObj</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">PyTango</span><span class="o">.</span><span class="n">DevState</span><span class="p">):</span>
            <span class="n">node</span><span class="o">.</span><span class="n">setBackground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">state2color</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span> <span class="c1">#@TODO: node is undefined. Check code</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;quality&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setForeground</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QBrush</span><span class="p">(</span><span class="n">quality2color</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">quality</span><span class="p">)))</span>

    <span class="k">def</span> <span class="nf">isReadOnly</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_name</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">modelName</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

    <span class="k">def</span> <span class="nf">getModelClass</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">taurus</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">taurusdevice</span><span class="o">.</span><span class="n">TaurusDevice</span>
    
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># TaurusBaseComponent over writing</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    
    <span class="c1">#def attach(self):</span>
        <span class="c1">#&quot;&quot;&quot;Attaches the widget to the model&quot;&quot;&quot;</span>
        <span class="c1">#if self.isAttached():</span>
            <span class="c1">#return True</span>
        <span class="c1">##-----------------------------------------------------------------------</span>
        <span class="c1">## Write your own code here before attaching widget to attribute connect </span>
        <span class="c1">## the proper signal so that the first event is correctly received by the</span>
        <span class="c1">## widget</span>
        <span class="c1">##</span>
        <span class="c1">## Typical code is:</span>
        <span class="c1">##self.connect(self, Qt.SIGNAL(&#39;valueChangedDueToEvent(QString)&#39;), </span>
        <span class="c1">##             self.setTextValue)</span>
        <span class="c1">#ret = TaurusBaseWidget.attach(self)</span>
        <span class="c1">## by default enable/disable widget according to attach state</span>
        <span class="c1">#self.setEnabled(ret)</span>
        <span class="c1">#return ret</span>

    <span class="c1">#def detach(self):</span>
        <span class="c1">#&quot;&quot;&quot;Detaches the widget from the model&quot;&quot;&quot;</span>
        <span class="c1">#TaurusBaseWidget.detach(self)</span>

        <span class="c1">##-----------------------------------------------------------------------</span>
        <span class="c1">## Write your own code here after detaching the widget from the model </span>
        <span class="c1">##</span>
        <span class="c1">## Typical code is:</span>
        <span class="c1">##self.emit(Qt.SIGNAL(&#39;valueChangedDueToEvent(QString)&#39;), </span>
        <span class="c1">##          Qt.QString(value_str))</span>
        <span class="c1">##self.disconnect(self, Qt.SIGNAL(&#39;valueChangedDueToEvent(QString)&#39;),</span>
        <span class="c1">##                self.setTextValue)</span>
        <span class="c1">## by default disable widget when dettached</span>
        <span class="c1">#self.setEnabled(False)</span>

    
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># QT properties </span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtProperty</span><span class="p">(</span><span class="s2">&quot;QString&quot;</span><span class="p">,</span> <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">getModel</span><span class="p">,</span> 
                                <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">setModel</span><span class="p">,</span> 
                                <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">resetModel</span><span class="p">)</span>
                                
    <span class="n">useParentModel</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">pyqtProperty</span><span class="p">(</span><span class="s2">&quot;bool&quot;</span><span class="p">,</span>
                                         <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">getUseParentModel</span><span class="p">,</span> 
                                         <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">setUseParentModel</span><span class="p">,</span>
                                         <span class="n">TaurusBaseWidget</span><span class="o">.</span><span class="n">resetUseParentModel</span><span class="p">)</span>

    <span class="c1">#---------------------------------------------------------------------------</span>
    <span class="c1"># Write your own code here for your own widget properties</span>
    
<div class="viewcode-block" id="TaurusDevTreeOptions"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTreeOptions.html#taurus.qt.qtgui.tree.TaurusDevTreeOptions">[docs]</a><span class="k">class</span> <span class="nc">TaurusDevTreeOptions</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class provides a search(QString) signal to be connected to TaurusDevTree.findInTree slot &quot;&quot;&quot;</span>
    <span class="n">__pyqtSignals__</span> <span class="o">=</span> <span class="p">(</span>
      <span class="s2">&quot;search(QString)&quot;</span><span class="p">,</span>
      <span class="s2">&quot;loadTree(QString)&quot;</span><span class="p">,</span>
      <span class="s2">&quot;hideUnexported&quot;</span><span class="p">,</span>
      <span class="s2">&quot;hideUnarchived&quot;</span><span class="p">,</span>
      <span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">icon</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QWidget</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">parent</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QHBoxLayout</span><span class="p">())</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_pixmap</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPixmap</span><span class="p">(</span><span class="n">icon</span> <span class="ow">or</span> <span class="s1">&#39;image/icons/search.png&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QLabel</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="o">.</span><span class="n">setPixmap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pixmap</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_label</span><span class="p">)</span>    
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">_edit</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QLineEdit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QPushButton</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s1">&#39;Search&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edit</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s1">&#39;returnPressed()&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="o">.</span><span class="n">animateClick</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s1">&#39;clicked()&#39;</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">_emitSearch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_edit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_button</span><span class="p">)</span>

<div class="viewcode-block" id="TaurusDevTreeOptions.connectWithTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusDevTreeOptions.html#taurus.qt.qtgui.tree.TaurusDevTreeOptions.connectWithTree">[docs]</a>    <span class="k">def</span> <span class="nf">connectWithTree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tree</span><span class="p">):</span>
        <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;search(QString)&quot;</span><span class="p">),</span><span class="n">tree</span><span class="o">.</span><span class="n">findInTree</span><span class="p">)</span></div>
    
    <span class="k">def</span> <span class="nf">_emitSearch</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_edit</span><span class="o">.</span><span class="n">text</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">text</span><span class="p">:</span> 
            <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="s2">&quot;search(QString)&quot;</span><span class="p">),</span> <span class="n">text</span><span class="p">)</span>
        <span class="k">return</span></div>

<span class="n">SearchEdit</span> <span class="o">=</span> <span class="n">TaurusDevTreeOptions</span>
    
<span class="c1">#####################################################################################</span>
    
<span class="k">class</span> <span class="nc">ServerBrowser</span><span class="p">(</span><span class="n">TaurusDevTree</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class is used only when browsing by Server/Instance instead of Domain/Family/Member scheme &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">getDeviceDict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">filters</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This method build a dictionary of instances and devices depending on the given servers,devices or instances in QTProperty or in another widget</span>
<span class="sd">        --- filters is a string with names of devices/servers such as &quot;LT/VC/ALL,LT02/VC/IP-01&quot; or &quot;modbus,pyplc&quot;</span>
<span class="sd">        --- filters is a list of devices such as [&quot;LT/VC/ALL&quot;,&quot;LT02/VC/IP-01&quot;]</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;In TaurusDevTree.buildDictFromFilters(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">filters</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_filters</span> <span class="o">=</span> <span class="n">filters</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QString</span><span class="p">):</span><span class="c1">#@TODO:QString and QStringList should not be used (They disappear in API2)</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filters</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">QStringList</span><span class="p">):</span> <span class="c1">#@TODO:QString and QStringList should not be used (They disappear in API2)</span>
            <span class="n">filters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span><span class="o">!=</span><span class="nb">type</span><span class="p">([]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;&#39;filters&#39; has to be a string or the list type!&quot;</span><span class="p">)</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">filters</span><span class="p">:</span> <span class="k">return</span> <span class="n">vals</span>
        <span class="k">if</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;In TaurusDevTree.buildDictFromFilters(</span><span class="si">%s</span><span class="s1">): Getting Servers&#39;</span><span class="o">%</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">targets</span><span class="p">,</span><span class="n">addMe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_server_name_list</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">addInstToServ</span> <span class="c1">#Searching servers</span>
        <span class="k">elif</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;In TaurusDevTree.buildDictFromFilters(</span><span class="si">%s</span><span class="s1">): Getting Instances&#39;</span><span class="o">%</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">targets</span><span class="p">,</span><span class="n">addMe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_server_list</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">addDevToInst</span> <span class="c1">#Searching instances</span>
        <span class="k">elif</span> <span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;In TaurusDevTree.buildDictFromFilters(</span><span class="si">%s</span><span class="s1">): Getting Devices&#39;</span><span class="o">%</span><span class="n">filters</span><span class="p">)</span>
            <span class="n">targets</span><span class="p">,</span><span class="n">addMe</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_device_exported</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">),</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">{</span><span class="n">s</span><span class="p">:{}}</span> <span class="c1">#self.addAttrToDev #Searching devices</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;UnknownFilter!: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">filters</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">targets</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filters</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
                <span class="n">exp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="s1">&#39;.*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;*&#39;</span> <span class="ow">in</span> <span class="n">f</span> <span class="ow">and</span> <span class="s1">&#39;.*&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">f</span> <span class="k">else</span> <span class="n">f</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">exp</span><span class="p">,</span><span class="n">t</span><span class="o">.</span><span class="n">lower</span><span class="p">()):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Adding node </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">t</span><span class="p">)</span>
                    <span class="n">vals</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">addMe</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="s1">&#39;Out of TaurusDevTree.getDeviceDict(</span><span class="si">%s</span><span class="s1">)&#39;</span><span class="o">%</span><span class="n">filters</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vals</span>

    <span class="k">def</span> <span class="nf">addInstToServ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">my_server</span><span class="p">):</span>
        <span class="nb">dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">list_inst</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_instances_for_server</span><span class="p">(</span><span class="n">my_server</span><span class="p">)</span>
        <span class="n">lower_list_inst</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">list_inst</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">my_inst</span> <span class="ow">in</span> <span class="n">lower_list_inst</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand</span><span class="p">:</span>
                <span class="nb">dict</span><span class="p">[</span><span class="n">my_inst</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addDevtoInst</span><span class="p">(</span><span class="n">my_inst</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">dict</span><span class="p">[</span><span class="n">my_inst</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="nf">addDevtoInst</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">my_inst</span><span class="p">,</span><span class="n">expand_attrs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">list_dev</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_devices_for_instance</span><span class="p">(</span><span class="n">my_inst</span><span class="p">)</span>
        <span class="n">lower_list_dev</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">list_dev</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">my_dev</span> <span class="ow">in</span> <span class="n">lower_list_dev</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">my_dev</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addAttrToDev</span><span class="p">(</span><span class="n">my_dev</span><span class="p">)</span> <span class="k">if</span> <span class="n">expand_attrs</span> <span class="k">else</span> <span class="p">{</span><span class="n">my_dev</span><span class="p">:{}}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">my_dev</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">d</span>
            
    <span class="k">def</span> <span class="nf">addFamilyToDomain</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">prev</span><span class="p">,</span><span class="n">expand_attrs</span><span class="p">):</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c1">#children = self.get_devices_for_instance(my_inst)</span>
        <span class="n">lower_list_dev</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">list_dev</span><span class="p">]</span> <span class="c1">#@TODO: list_dev is undefined. Check code</span>
        <span class="k">for</span> <span class="n">my_dev</span> <span class="ow">in</span> <span class="n">lower_list_dev</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">my_dev</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">addAttrToDev</span><span class="p">(</span><span class="n">my_dev</span><span class="p">)</span> <span class="k">if</span> <span class="n">expand_attrs</span> <span class="k">else</span> <span class="p">{</span><span class="n">my_dev</span><span class="p">:{}}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">my_dev</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">d</span>
            

    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    <span class="c1"># Methods  for database commands</span>
    <span class="c1">#-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-~-</span>
    
    <span class="k">def</span> <span class="nf">get_instances_for_server</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_name</span><span class="p">):</span>
        <span class="c1">#executable_name = class_name</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_instance_name_list</span><span class="p">(</span><span class="n">server_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">server_name</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="n">instance</span> <span class="k">for</span> <span class="n">instance</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_devices_for_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance_name</span><span class="p">):</span>
        <span class="n">devslist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_device_class_list</span><span class="p">(</span><span class="n">instance_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">dev</span> <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="n">devslist</span> <span class="k">if</span> <span class="s1">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">dev</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dev</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;dserver&#39;</span><span class="p">)]</span>            
            
            
    <span class="c1">##@}</span>
                    
<span class="c1">#####################################################################################</span>

<div class="viewcode-block" id="TaurusSearchTree"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusSearchTree.html#taurus.qt.qtgui.tree.TaurusSearchTree">[docs]</a><span class="k">class</span> <span class="nc">TaurusSearchTree</span><span class="p">(</span><span class="n">TaurusWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Class is a mere wrapper providing a TaurusDevTree connected with an options panel and some optional checkboxes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__pyqtSignals__</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">TaurusWidget</span><span class="p">,</span><span class="s1">&#39;__pyqtSignals__&#39;</span><span class="p">,[]))</span><span class="o">+</span><span class="p">[</span>
        <span class="s2">&quot;search(QString)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;modelChanged(const QString &amp;)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;deviceSelected(QString)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;addAttrSelected(QStringList)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;removeAttrSelected(QStringList)&quot;</span><span class="p">,</span>
        <span class="s2">&quot;refreshTree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nodeFound&quot;</span>
        <span class="p">]</span>
    <span class="vm">__slots__</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;setTangoHost&quot;</span><span class="p">,</span>
        <span class="c1">#&quot;setModel&quot;,</span>
        <span class="s2">&quot;addModels&quot;</span><span class="p">,</span>
        <span class="s2">&quot;setModelCheck&quot;</span><span class="p">,</span>
        <span class="s2">&quot;setTree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;findInTree&quot;</span><span class="p">,</span>
        <span class="s2">&quot;expandAll&quot;</span><span class="p">,</span>
        <span class="s2">&quot;loadTree&quot;</span><span class="p">,</span>
        <span class="p">)</span>        
    
    <span class="nd">@staticmethod</span>
<div class="viewcode-block" id="TaurusSearchTree.method_forwarder"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusSearchTree.html#taurus.qt.qtgui.tree.TaurusSearchTree.method_forwarder">[docs]</a>    <span class="k">def</span> <span class="nf">method_forwarder</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">m</span><span class="p">,</span><span class="n">o</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;method&#39;</span><span class="p">],</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;object&#39;</span><span class="p">]</span>
        <span class="c1">#print &#39;Calling %s.%s&#39;%(o,m)</span>
        <span class="nb">getattr</span><span class="p">(</span><span class="n">o</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span><span class="n">m</span><span class="p">)(</span><span class="n">o</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">)</span></div>

<div class="viewcode-block" id="TaurusSearchTree.defineStyle"><a class="viewcode-back" href="../../../../../devel/api/taurus/qt/qtgui/tree/_TaurusSearchTree.html#taurus.qt.qtgui.tree.TaurusSearchTree.defineStyle">[docs]</a>    <span class="k">def</span> <span class="nf">defineStyle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#print(&#39;In TaurusSearchTree.defineStyle()&#39;)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="s1">&#39;TaurusDevTree&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">QVBoxLayout</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit</span> <span class="o">=</span> <span class="n">TaurusDevTreeOptions</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">TaurusDevTree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">edit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">registerConfigDelegate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span>
        <span class="c1">#Slot forwarding ...</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">TaurusDevTree</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="c1">#if k in [&#39;__init__&#39;,&#39;defineStyle&#39;]: continue</span>
            <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__slots__</span><span class="p">:</span> <span class="k">continue</span>
            <span class="k">try</span><span class="p">:</span> <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="n">partial</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">method_forwarder</span><span class="p">,</span><span class="n">method</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="nb">object</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">))</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s1">&#39;Unable to add slot </span><span class="si">%s</span><span class="s1">: </span><span class="si">%s</span><span class="s1">&#39;</span><span class="o">%</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
        <span class="c1">#Event forwarding ...</span>
        <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">TaurusDevTree</span><span class="o">.</span><span class="n">__pyqtSignals__</span><span class="p">:</span>
            <span class="c1">#Qt.QObject.connect(self,Qt.SIGNAL(&quot;search(QString)&quot;),tree.findInTree)</span>
            <span class="c1">#self.emit(Qt.SIGNAL(&quot;search(QString)&quot;), text)</span>
            <span class="n">Qt</span><span class="o">.</span><span class="n">QObject</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span><span class="k">lambda</span> <span class="n">args</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="n">signal</span><span class="p">:</span><span class="n">f</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">SIGNAL</span><span class="p">(</span><span class="n">s</span><span class="p">),</span><span class="n">args</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">edit</span><span class="o">.</span><span class="n">connectWithTree</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span></div></div>
        

<span class="c1">#####################################################################################</span>

<span class="k">def</span> <span class="nf">taurusDevTreeMain</span><span class="p">():</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">from</span> <span class="nn">taurus.qt.qtgui.application</span> <span class="k">import</span> <span class="n">TaurusApplication</span>
    <span class="kn">from</span> <span class="nn">taurus.core.util</span> <span class="k">import</span> <span class="n">argparse</span>
    
    <span class="k">if</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">Qt</span><span class="o">.</span><span class="n">QApplication</span><span class="p">([])</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c1">#args = app.get_command_line_args()</span>
        <span class="c1">#app = TaurusApplication(sys.argv)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span> <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;database&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">taurus</span><span class="o">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="n">taurus</span><span class="o">.</span><span class="n">Debug</span><span class="p">)</span>
        <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">get_taurus_parser</span><span class="p">()</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">set_usage</span><span class="p">(</span><span class="s2">&quot;%prog [options] devname [attrs]&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">set_description</span><span class="p">(</span><span class="s2">&quot;Taurus Application inspired in Jive and Atk Panel&quot;</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s2">&quot;--config&quot;</span><span class="p">,</span> <span class="s2">&quot;--config-file&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s2">&quot;config_file&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">help</span><span class="o">=</span><span class="s2">&quot;use the given config file for initialization&quot;</span><span class="p">)</span>
        <span class="n">app</span> <span class="o">=</span> <span class="n">TaurusApplication</span><span class="p">(</span><span class="n">cmd_line_parser</span><span class="o">=</span><span class="n">parser</span><span class="p">,</span><span class="n">app_name</span><span class="o">=</span><span class="s2">&quot;TaurusDevicePanel&quot;</span><span class="p">,</span>
                                <span class="n">app_version</span><span class="o">=</span><span class="n">taurus</span><span class="o">.</span><span class="n">Release</span><span class="o">.</span><span class="n">version</span><span class="p">)</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_command_line_args</span><span class="p">()</span>
        <span class="n">options</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">get_command_line_options</span><span class="p">()</span>
        
    <span class="n">form</span> <span class="o">=</span> <span class="n">TaurusSearchTree</span><span class="p">()</span>
    <span class="c1">#try:</span>
        <span class="c1">#if options.tango_host is None:</span>
            <span class="c1">#options.tango_host = taurus.Database().getNormalName()</span>
        <span class="c1">#form.setTangoHost(options.tango_host)</span>
    <span class="c1">#except: pass</span>
    
    <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">m</span><span class="p">):</span> <span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="p">[</span><span class="nb">setattr</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span><span class="n">f</span><span class="p">,</span><span class="n">trace</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;info&#39;</span><span class="p">,</span><span class="s1">&#39;warning&#39;</span><span class="p">,</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="s1">&#39;trace&#39;</span><span class="p">)]</span>
    
    <span class="n">form</span><span class="o">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="n">taurus</span><span class="o">.</span><span class="n">Debug</span><span class="p">)</span>
    <span class="n">form</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">setLogLevel</span><span class="p">(</span><span class="n">taurus</span><span class="o">.</span><span class="n">Debug</span><span class="p">)</span>
    <span class="c1">#set a model list from the command line or launch the chooser  </span>
    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">config_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">form</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">loadConfigFile</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">config_file</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">models</span><span class="o">=</span><span class="n">args</span>
        <span class="n">form</span><span class="o">.</span><span class="n">setModel</span><span class="p">(</span><span class="n">models</span><span class="p">)</span>
    <span class="n">form</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">app</span><span class="o">.</span><span class="n">exec_</span><span class="p">())</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">taurusDevTreeMain</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Except where otherwise noted, content on this site is
licensed under a Creative Commons Attribution 3.0 License.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../../',
            VERSION:'3.7.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>